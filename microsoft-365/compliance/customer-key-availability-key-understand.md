---
title: 了解客户密钥的可用性密钥
ms.author: krowley
author: kccross
manager: laurawi
ms.date: 02/05/2020
audience: ITPro
ms.topic: article
ms.service: O365-seccomp
localization_priority: Normal
search.appverid:
- MET150
description: 了解用于恢复丢失的客户密钥的可用性密钥。
ms.openlocfilehash: bbad6ace0880c142a497bcac3469c579f13c7881
ms.sourcegitcommit: 27b2b2e5c41934b918cac2c171556c45e36661bf
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/19/2021
ms.locfileid: "50907738"
---
# <a name="learn-about-the-availability-key-for-customer-key"></a><span data-ttu-id="bb4e4-103">了解客户密钥的可用性密钥</span><span class="sxs-lookup"><span data-stu-id="bb4e4-103">Learn about the availability key for Customer Key</span></span>

<span data-ttu-id="bb4e4-104">可用性密钥是在您创建数据加密策略时自动生成和预配的根密钥。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-104">The availability key is a root key automatically generated and provisioned when you create a data encryption policy.</span></span> <span data-ttu-id="bb4e4-105">Microsoft 365 存储和保护可用性密钥。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-105">Microsoft 365 stores and protects the availability key.</span></span> <span data-ttu-id="bb4e4-106">可用性密钥在功能上与使用客户密钥进行服务加密的两个根密钥类似。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-106">The availability key is functionally like the two root keys that you supply for service encryption with Customer Key.</span></span> <span data-ttu-id="bb4e4-107">可用性密钥将密钥包装在密钥层次结构中下一层。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-107">The availability key wraps the keys one tier lower in the key hierarchy.</span></span> <span data-ttu-id="bb4e4-108">与你在 Azure 密钥保管库中提供和管理的密钥不同，你无法直接访问可用性密钥。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-108">Unlike the keys that you provide and manage in Azure Key Vault, you can't directly access the availability key.</span></span> <span data-ttu-id="bb4e4-109">Microsoft 365 自动服务以编程方式管理可用性密钥。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-109">Microsoft 365 automated services manage the availability key programatically.</span></span> <span data-ttu-id="bb4e4-110">这些服务启动自动化操作，这些操作从不涉及直接访问可用性密钥。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-110">These services initiate automated operations that never involve direct access to the availability key.</span></span>

<span data-ttu-id="bb4e4-111">可用性密钥的主要用途是提供恢复功能，以从您管理的根密钥意外丢失中恢复。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-111">The primary purpose of the availability key is to provide recovery capability from the unanticipated loss of root keys that you manage.</span></span> <span data-ttu-id="bb4e4-112">丢失可能是由于管理不当或恶意操作导致。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-112">Loss could be a result of mismanagement or malicious action.</span></span> <span data-ttu-id="bb4e4-113">如果你失去对根密钥的控制，请联系 Microsoft 支持部门，Microsoft 将帮助你使用可用性密钥完成恢复过程。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-113">If you lose control of your root keys, contact Microsoft Support and Microsoft will assist you through the process of recovery using the availability key.</span></span> <span data-ttu-id="bb4e4-114">你将使用可用性密钥迁移到新的数据加密策略，并设置新的根密钥。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-114">You'll use the availability key to migrate to a new Data Encryption Policy with new root keys you provision.</span></span>

<span data-ttu-id="bb4e4-115">出于以下三个原因，可用性密钥的存储和控制有意不同于 Azure 密钥保管库密钥：</span><span class="sxs-lookup"><span data-stu-id="bb4e4-115">Storage and control of the availability key are deliberately different from Azure Key Vault keys for three reasons:</span></span>

- <span data-ttu-id="bb4e4-116">如果失去对两个 Azure 密钥保管库密钥的控制，可用性密钥将提供恢复（即"中断式"功能）。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-116">The availability key provides a recovery, "break-glass" capability if control over both Azure Key Vault keys is lost.</span></span>
- <span data-ttu-id="bb4e4-117">逻辑控件和安全存储位置的分离可提供深度防御，并防范从单个攻击或故障点中丢失所有密钥和数据。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-117">The separation of logical controls and secure storage locations provides defense-in-depth and protects against the loss of all keys, and your data, from a single attack or point of failure.</span></span>
- <span data-ttu-id="bb4e4-118">如果 Microsoft 365 服务由于暂时性错误而无法访问 Azure Key Vault 中托管的密钥，可用性密钥将提供高可用性功能。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-118">The availability key provides a high-availability capability if Microsoft 365 services are unable to reach keys hosted in Azure Key Vault due to transient errors.</span></span> <span data-ttu-id="bb4e4-119">此规则仅适用于 Exchange Online 和 Skype for Business 服务加密。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-119">This rule only applies to Exchange Online and Skype for Business service encryption.</span></span> <span data-ttu-id="bb4e4-120">除非明确指示 Microsoft 启动恢复过程，否则 SharePoint Online、OneDrive for Business 和 Teams 文件永远不会使用可用性密钥。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-120">SharePoint Online, OneDrive for Business, and Teams files never use the availability key unless you explicitly instruct Microsoft to initiate the recovery process.</span></span>

<span data-ttu-id="bb4e4-121">共享保护你的数据的责任，使用各种保护和过程进行密钥管理，最终可降低所有密钥 (因此你的) 将永久丢失或销毁的风险。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-121">Sharing the responsibility to protect your data, using a variety of protections and processes for key management, ultimately reduces the risk that all keys (and therefore your data) will be permanently lost or destroyed.</span></span> <span data-ttu-id="bb4e4-122">当你离开服务时，Microsoft 会为您提供对禁用或销毁可用性密钥的唯一授权。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-122">Microsoft provides you with sole authority over the disablement or destruction of the availability key when you leave the service.</span></span> <span data-ttu-id="bb4e4-123">根据设计，Microsoft 中没有人可以访问可用性密钥：它只能通过 Microsoft 365 服务代码访问。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-123">By design, no one at Microsoft has access to the availability key: it is only accessible by Microsoft 365 service code.</span></span>

<span data-ttu-id="bb4e4-124">请参阅 [Microsoft 信任中心](https://www.microsoft.com/trustcenter/Privacy/govt-requests-for-data) ，详细了解如何保护密钥。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-124">See the [Microsoft Trust Center](https://www.microsoft.com/trustcenter/Privacy/govt-requests-for-data) for more information about how we secure keys.</span></span>
  
## <a name="availability-key-uses"></a><span data-ttu-id="bb4e4-125">可用性密钥使用</span><span class="sxs-lookup"><span data-stu-id="bb4e4-125">Availability key uses</span></span>

<span data-ttu-id="bb4e4-126">可用性密钥为以下情形提供恢复功能：外部恶意恶意内部人员窃取密钥保管库的控制权，或意外管理不当导致根密钥丢失的情况。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-126">The availability key provides recovery capability for scenarios in which an external malefactor or malicious insider steals control of your key vault, or when inadvertent mismanagement results in loss of root keys.</span></span> <span data-ttu-id="bb4e4-127">此恢复功能适用于所有与客户密钥兼容的 Microsoft 365 服务。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-127">This recovery capability applies to all Microsoft 365 services compatible with Customer Key.</span></span> <span data-ttu-id="bb4e4-128">各个服务使用可用性密钥的方式不同。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-128">Individual services use the availability key differently.</span></span> <span data-ttu-id="bb4e4-129">Microsoft 365 仅使用如下所述方式的可用性密钥。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-129">Microsoft 365 only uses the availability key in the ways described below.</span></span>

### <a name="exchange-online-and-skype-for-business-uses"></a><span data-ttu-id="bb4e4-130">Exchange Online 和 Skype for Business 使用</span><span class="sxs-lookup"><span data-stu-id="bb4e4-130">Exchange Online and Skype for Business uses</span></span>

<span data-ttu-id="bb4e4-131">除了恢复功能之外，Exchange Online 和 Skype for Business 还使用可用性密钥来确保与访问根密钥的服务相关的暂时性或间歇性操作问题期间的数据可用性。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-131">In addition to the recovery capability, Exchange Online and Skype for Business use the availability key to ensure data availability during transient, or intermittent operational issues, related to the service accessing root keys.</span></span> <span data-ttu-id="bb4e4-132">当服务由于暂时性错误而无法访问 Azure 密钥保管库中的任一客户密钥时，该服务将自动使用可用性密钥。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-132">When the service cannot reach either of your Customer Keys in Azure Key Vault due to transient errors, the service automatically uses the availability key.</span></span> <span data-ttu-id="bb4e4-133">服务 NEVER 直接转到可用性密钥。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-133">The service NEVER goes directly to the availability key.</span></span>

<span data-ttu-id="bb4e4-134">Exchange Online 和 Skype for Business 中的自动系统可能在暂时性错误期间使用可用性密钥来支持自动后端服务，如防病毒、电子数据发现、数据丢失防护、邮箱移动和数据索引。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-134">Automated systems in Exchange Online and Skype for Business may use the availability key during transient errors to support automated back-end services such as anti-virus, e-discovery, data loss prevention, mailbox moves, and data indexing.</span></span>

### <a name="sharepoint-online-onedrive-for-business-and-teams-files-uses"></a><span data-ttu-id="bb4e4-135">SharePoint Online、OneDrive for Business 和 Teams 文件使用</span><span class="sxs-lookup"><span data-stu-id="bb4e4-135">SharePoint Online, OneDrive for Business, and Teams files uses</span></span>

<span data-ttu-id="bb4e4-136">对于 SharePoint Online、OneDrive for Business 和 Teams 文件，在恢复功能之外从不使用可用性密钥，客户必须明确指示 Microsoft 在恢复方案期间启动可用性密钥的使用。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-136">For SharePoint Online, OneDrive for Business, and Teams files, the availability key is NEVER used outside of the recovery capability and customers must explicitly instruct Microsoft to initiate use of the availability key during a recovery scenario.</span></span> <span data-ttu-id="bb4e4-137">自动服务操作仅依赖于 Azure 密钥保管库中的客户密钥。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-137">Automated service operations solely rely on your Customer Keys in Azure Key vault.</span></span> <span data-ttu-id="bb4e4-138">有关密钥层次结构如何用于这些服务的深入信息，请参阅 [SharePoint Online、OneDrive for Business](#how-sharepoint-online-onedrive-for-business-and-teams-files-use-the-availability-key)和 Teams 文件如何使用可用性密钥。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-138">For in-depth information about how the key hierarchy works for these services, see [How SharePoint Online, OneDrive for Business, and Teams files use the availability key](#how-sharepoint-online-onedrive-for-business-and-teams-files-use-the-availability-key).</span></span>

## <a name="availability-key-security"></a><span data-ttu-id="bb4e4-139">可用性密钥安全性</span><span class="sxs-lookup"><span data-stu-id="bb4e4-139">Availability key security</span></span>

<span data-ttu-id="bb4e4-140">Microsoft 通过实例化可用性密钥并采取广泛的措施来保护它，来承担数据保护的责任。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-140">Microsoft shares the responsibility of data protection with you by instantiating the availability key and taking extensive measures to protect it.</span></span> <span data-ttu-id="bb4e4-141">Microsoft 不会将可用性密钥的直接控制公开给客户。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-141">Microsoft does not expose direct control of the availability key to customers.</span></span> <span data-ttu-id="bb4e4-142">例如，你只能滚动 (旋转) 你在 Azure Key Vault 中拥有密钥。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-142">For example, you can only roll (rotate) the keys that you own in Azure Key Vault.</span></span> <span data-ttu-id="bb4e4-143">有关详细信息，请参阅滚动 [或旋转客户密钥或可用性密钥](customer-key-availability-key-roll.md)。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-143">For more information, see [Roll or rotate a customer key or an availability key](customer-key-availability-key-roll.md).</span></span>

### <a name="availability-key-secret-stores"></a><span data-ttu-id="bb4e4-144">可用性密钥密钥存储</span><span class="sxs-lookup"><span data-stu-id="bb4e4-144">Availability key secret stores</span></span>

<span data-ttu-id="bb4e4-145">Microsoft 在访问控制的内部密码存储（如面向客户的 Azure 密钥保管库）中保护可用性密钥。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-145">Microsoft protects availability keys in access-controlled, internal secret stores like the customer-facing Azure Key Vault.</span></span> <span data-ttu-id="bb4e4-146">我们实施访问控制以防止 Microsoft 管理员直接访问其中包含的机密。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-146">We implement access controls to prevent Microsoft administrators from directly accessing the secrets contained within.</span></span> <span data-ttu-id="bb4e4-147">密钥存储操作（包括密钥轮换和删除）通过自动命令执行，这些命令从不涉及直接访问可用性密钥。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-147">Secret Store operations, including key rotation and deletion, occur through automated commands that never involve direct access to the availability key.</span></span> <span data-ttu-id="bb4e4-148">密码存储管理操作仅限于特定工程师，并且需要通过内部工具 Lockbox 进行特权提升。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-148">Secret store management operations are limited to specific engineers and require privilege escalation through an internal tool, Lockbox.</span></span> <span data-ttu-id="bb4e4-149">特权提升需要在授予之前获得经理批准和理由。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-149">Privilege escalation requires manager approval and justification prior to being granted.</span></span> <span data-ttu-id="bb4e4-150">密码箱确保在过期或工程师注销时访问权限与自动访问权限吊销绑定在一起。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-150">Lockbox ensures access is time bound with automatic access revocation upon time expiration or engineer log out.</span></span>

<span data-ttu-id="bb4e4-151">**Exchange Online 和 Skype for Business** 可用性密钥存储在 Exchange Online Active Directory 密码存储中。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-151">**Exchange Online and Skype for Business** availability keys are stored in an Exchange Online Active Directory secret store.</span></span> <span data-ttu-id="bb4e4-152">可用性密钥安全存储在 Active Directory 域控制器内的租户特定容器内。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-152">Availability keys are securely stored inside tenant specific containers within the Active Directory Domain Controller.</span></span> <span data-ttu-id="bb4e4-153">此安全存储位置独立于 SharePoint Online、OneDrive for Business 和 Teams 文件密码存储。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-153">This secure storage location is separate and isolated from the SharePoint Online, OneDrive for Business, and Teams files secret store.</span></span>

<span data-ttu-id="bb4e4-154">**SharePoint Online、OneDrive for Business** 和 Teams 文件可用性密钥存储在服务团队管理的内部密码存储中。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-154">**SharePoint Online, OneDrive for Business, and Teams files** availability keys are stored in an internal secret store managed by the service team.</span></span> <span data-ttu-id="bb4e4-155">此安全密钥存储服务具有前端服务器，应用程序终结点和SQL数据库作为后端。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-155">This secured, secrets storage service has front-end servers with application endpoints and a SQL Database as the back end.</span></span> <span data-ttu-id="bb4e4-156">可用性密钥存储在 SQL 数据库中，并使用密码存储加密密钥包装 (加密) ，密钥使用 AES-256 和 HMAC 的组合对静态可用性密钥进行加密。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-156">Availability keys are stored in the SQL Database and are wrapped (encrypted) by secret store encryption keys that use a combination of AES-256 and HMAC to encrypt the availability key at rest.</span></span> <span data-ttu-id="bb4e4-157">密钥存储加密密钥存储在同一个 SQL 数据库的逻辑隔离组件中，并且使用包含在由 Microsoft 证书颁发机构 (CA) 管理的证书中的 RSA-2048 密钥进一步加密。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-157">The secret store encryption keys are stored in a logically isolated component of the same SQL Database and are further encrypted with RSA-2048 keys contained in certificates managed by the Microsoft certificate authority (CA).</span></span> <span data-ttu-id="bb4e4-158">这些证书存储在对数据库执行操作机密存储前端服务器中。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-158">These certificates are stored in the secret store front-end servers that perform operations against the database.</span></span>

### <a name="defense-in-depth"></a><span data-ttu-id="bb4e4-159">深度防御</span><span class="sxs-lookup"><span data-stu-id="bb4e4-159">Defense-in-depth</span></span>

<span data-ttu-id="bb4e4-160">Microsoft 采用深度防御策略来防止恶意参与者影响存储在 Microsoft 云中的客户数据的机密性、完整性或可用性。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-160">Microsoft employs a defense-in-depth strategy to prevent malicious actors from impacting the confidentiality, integrity, or availability of customer data stored in the Microsoft Cloud.</span></span> <span data-ttu-id="bb4e4-161">实施特定的预防性和检测性控制措施来保护作为总体安全策略一部分的机密存储和可用性密钥。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-161">Specific preventive and detective controls are implemented to protect the secret store and the availability key as part of the overarching security strategy.</span></span>

<span data-ttu-id="bb4e4-162">Microsoft 365 是为了防止误用可用性密钥而构建的。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-162">Microsoft 365 is built to prevent misuse of the availability key.</span></span> <span data-ttu-id="bb4e4-163">应用程序层是可以使用密钥（包括可用性密钥）加密和解密数据的唯一方法。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-163">The application layer is the only method through which keys, including the availability key, can be used to encrypt and decrypt data.</span></span> <span data-ttu-id="bb4e4-164">只有 Microsoft 365 服务代码能够解释和遍历密钥层次结构进行加密和解密活动。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-164">Only Microsoft 365 service code has the ability to interpret and traverse the key hierarchy for encryption and decryption activities.</span></span> <span data-ttu-id="bb4e4-165">客户密钥、可用性密钥、其他分层密钥和客户数据的存储位置之间存在逻辑隔离。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-165">Logical isolation exists between the storage locations of Customer Keys, availability keys, other hierarchical keys, and customer data.</span></span> <span data-ttu-id="bb4e4-166">此隔离在一个或多个位置受到威胁时降低了数据泄露的风险。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-166">This isolation mitigates the risk of data exposure in the event one or more locations are compromised.</span></span> <span data-ttu-id="bb4e4-167">层次结构中的每个层都内置了 24x7 入侵检测功能，以保护存储的数据和机密。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-167">Each layer in the hierarchy has built in 24x7 intrusion detection capabilities to protect data and secrets stored.</span></span>

<span data-ttu-id="bb4e4-168">实施访问控制是为了防止对内部系统（包括可用性密钥密钥存储）进行未经授权的访问。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-168">Access controls are implemented to prevent unauthorized access to internal systems, including availability key secret stores.</span></span> <span data-ttu-id="bb4e4-169">Microsoft 工程师不能直接访问可用性密钥密钥存储。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-169">Microsoft engineers don't have direct access to the availability key secret stores.</span></span> <span data-ttu-id="bb4e4-170">有关访问控制的其他详细信息，请查看 [Microsoft 365 中的管理访问控制](/Office365/securitycompliance/office-365-administrative-access-controls-overview)。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-170">For additional detail on access controls, review [Administrative Access Controls in Microsoft 365](/Office365/securitycompliance/office-365-administrative-access-controls-overview).</span></span>

<span data-ttu-id="bb4e4-171">技术控制可防止 Microsoft 人员登录到高度特权的服务帐户，否则攻击者可能会使用这些帐户来模拟 Microsoft 服务。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-171">Technical controls prevent Microsoft personnel from logging into highly-privileged service accounts, which might otherwise be used by attackers to impersonate Microsoft services.</span></span> <span data-ttu-id="bb4e4-172">例如，这些控件阻止交互式登录。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-172">For example, these controls prevent interactive logon.</span></span>

<span data-ttu-id="bb4e4-173">安全日志记录和监视控件是另一项深度防御措施，用于降低 Microsoft 服务和数据的风险。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-173">Security logging and monitoring controls are another defense-in-depth safeguard implemented that mitigate risk to Microsoft services and your data.</span></span> <span data-ttu-id="bb4e4-174">Microsoft 服务团队已部署可生成警报和审核日志的活动监视解决方案。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-174">Microsoft service teams have deployed active monitoring solutions that generate alerts and audit logs.</span></span> <span data-ttu-id="bb4e4-175">所有服务团队将其日志上载到聚合和处理日志的中央存储库。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-175">All service teams upload their logs to a central repository where the logs are aggregated and processed.</span></span> <span data-ttu-id="bb4e4-176">内部工具会自动检查记录，以确认服务是否以最佳、可恢复和安全状态运行。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-176">Internal tools automatically examine records to confirm that services are functioning in an optimal, resilient, and secure state.</span></span> <span data-ttu-id="bb4e4-177">异常活动将被标记为进一步审查。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-177">Unusual activity is flagged for further review.</span></span>

<span data-ttu-id="bb4e4-178">任何指示潜在违反 Microsoft 安全策略的日志事件会立即引起 Microsoft 安全团队的注意。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-178">Any log event that indicates a potential violation of the Microsoft Security Policy is immediately brought to the attention of Microsoft security teams.</span></span> <span data-ttu-id="bb4e4-179">Microsoft 365 安全中心已配置警报，以检测尝试访问可用性密钥密钥存储。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-179">Microsoft 365 security has configured alerts to detect attempted access to availability key secret stores.</span></span> <span data-ttu-id="bb4e4-180">如果 Microsoft 人员尝试交互式登录服务帐户（访问控制禁止并保护此帐户）也会生成警报。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-180">Alerts are also generated if Microsoft personnel attempt interactive logon to service accounts, which is prohibited and protected by access controls.</span></span> <span data-ttu-id="bb4e4-181">Microsoft 365 安全中心还检测 Microsoft 365 服务与正常基线操作偏差并发出警报。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-181">Microsoft 365 security also detects and alerts upon deviations of the Microsoft 365 service from normal baseline operations.</span></span> <span data-ttu-id="bb4e4-182">试图滥用 Microsoft 365 服务的男性因素将触发警报，从而导致被误用者从 Microsoft 云环境中受到冒犯。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-182">Malefactors attempting to misuse Microsoft 365 services would trigger alerts resulting in the offender's eviction from the Microsoft cloud environment.</span></span>

## <a name="use-the-availability-key-to-recover-from-key-loss"></a><span data-ttu-id="bb4e4-183">使用可用性密钥从密钥丢失中恢复</span><span class="sxs-lookup"><span data-stu-id="bb4e4-183">Use the availability key to recover from key loss</span></span>

<span data-ttu-id="bb4e4-184">如果你失去对客户密钥的控制，可用性密钥将让你能够恢复和重新加密你的数据。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-184">If you lose control of your Customer Keys, the availability key provides you the ability to recover and re-encrypt your data.</span></span>

### <a name="recovery-procedure-for-exchange-online-and-skype-for-business"></a><span data-ttu-id="bb4e4-185">Exchange Online 和 Skype for Business 的恢复过程</span><span class="sxs-lookup"><span data-stu-id="bb4e4-185">Recovery procedure for Exchange Online and Skype for Business</span></span>

<span data-ttu-id="bb4e4-186">如果你失去对客户密钥的控制，可用性密钥将让你恢复数据，并恢复你受到影响的 Microsoft 365 资源。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-186">If you lose control of your Customer Keys, the availability key gives you the capability to recover your data and bring your impacted Microsoft 365 resources back online.</span></span> <span data-ttu-id="bb4e4-187">恢复时，可用性密钥将继续保护数据。在高级别上，若要完全从密钥丢失中恢复，你需要创建新的 DEP，将影响的资源移动到新策略。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-187">The availability key continues to protect your data while you recover.At a high level, to fully recover from key loss, you'll need to create a new DEP and move impacted resources to the new policy.</span></span>

<span data-ttu-id="bb4e4-188">若要使用新的客户密钥加密数据，在 Azure 密钥保管库中创建新密钥，使用新的客户密钥创建新的 DEP，然后将新的 DEP 分配给当前使用以前的 DEP 加密的邮箱，其中密钥丢失或受到威胁。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-188">To encrypt your data with new Customer Keys, create new keys in Azure Key Vault, create a new DEP using the new Customer Keys, then assign the new DEP to the mailboxes currently encrypted with the previous DEP for which the keys were lost or compromised.</span></span>

<span data-ttu-id="bb4e4-189">此重新加密过程最多可能需要 72 小时。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-189">This re-encryption process can take up to 72 hours.</span></span> <span data-ttu-id="bb4e4-190">这是更改 DEP 时的标准持续时间。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-190">This is the standard duration when you change a DEP.</span></span>
  
### <a name="recovery-procedure-for-sharepoint-online-onedrive-for-business-and-teams-files"></a><span data-ttu-id="bb4e4-191">SharePoint Online、OneDrive for Business 和 Teams 文件的恢复过程</span><span class="sxs-lookup"><span data-stu-id="bb4e4-191">Recovery procedure for SharePoint Online, OneDrive for Business, and Teams files</span></span>

<span data-ttu-id="bb4e4-192">对于 SharePoint Online、OneDrive for Business 和 Teams 文件，从不会在恢复功能之外使用可用性密钥。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-192">For SharePoint Online, OneDrive for Business, and Teams files, the availability key is NEVER used outside of the recovery capability.</span></span> <span data-ttu-id="bb4e4-193">您必须明确指示 Microsoft 在恢复方案期间启动可用性密钥的使用。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-193">You must explicitly instruct Microsoft to initiate use of the availability key during a recovery scenario.</span></span> <span data-ttu-id="bb4e4-194">若要启动恢复过程，请与 Microsoft 联系以激活可用性密钥。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-194">To initiate the recovery process, contact Microsoft to activate the availability key.</span></span> <span data-ttu-id="bb4e4-195">激活后，可用性密钥将自动用于解密数据，从而允许您使用与新客户密钥关联的新创建的 DEP 加密数据。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-195">Once activated, the availability key is automatically used to decrypt your data allowing you to encrypt the data with a newly-created DEP associated to new Customer Keys.</span></span>  

<span data-ttu-id="bb4e4-196">此操作与组织中网站的数量成比例。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-196">This operation is proportional to the number of sites in your organization.</span></span> <span data-ttu-id="bb4e4-197">调用 Microsoft 以使用可用性密钥后，你应在大约四小时内完全联机。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-197">Once you call Microsoft to use the availability key, you should be fully online within about four hours.</span></span>

## <a name="how-exchange-online-and-skype-for-business-use-the-availability-key"></a><span data-ttu-id="bb4e4-198">Exchange Online 和 Skype for Business 如何使用可用性密钥</span><span class="sxs-lookup"><span data-stu-id="bb4e4-198">How Exchange Online and Skype for Business use the availability key</span></span>

<span data-ttu-id="bb4e4-199">使用客户密钥创建 DEP 时，Microsoft 365 会生成一个数据加密策略密钥 (DEP 密钥) DEP 关联。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-199">When you create a DEP with Customer Key, Microsoft 365 generates a Data Encryption Policy Key (DEP Key) associated with that DEP.</span></span> <span data-ttu-id="bb4e4-200">该服务对 DEP 密钥进行三次加密：一次与每个客户密钥一起加密，一次使用可用性密钥加密。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-200">The service encrypts the DEP Key three times: once with each of the customer keys and once with the availability key.</span></span> <span data-ttu-id="bb4e4-201">仅存储 DEP 密钥的加密版本，并且只能使用客户密钥或可用性密钥解密 DEP 密钥。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-201">Only the encrypted versions of the DEP Key are stored, and a DEP Key can only be decrypted with the customer keys or the availability key.</span></span> <span data-ttu-id="bb4e4-202">然后，DEP 密钥用于加密邮箱密钥，从而加密各个邮箱。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-202">The DEP Key is then used to encrypt Mailbox Keys, which encrypt individual mailboxes.</span></span>
  
<span data-ttu-id="bb4e4-203">Microsoft 365 遵循此过程在客户使用该服务时解密和提供数据：</span><span class="sxs-lookup"><span data-stu-id="bb4e4-203">Microsoft 365 follows this process to decrypt and provide data when customers are using the service:</span></span>
  
1. <span data-ttu-id="bb4e4-204">使用客户密钥解密 DEP 密钥。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-204">Decrypt the DEP Key using the Customer Key.</span></span>

2. <span data-ttu-id="bb4e4-205">使用解密的 DEP 密钥解密邮箱密钥。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-205">Use the decrypted DEP Key to decrypt a Mailbox Key.</span></span>

3. <span data-ttu-id="bb4e4-206">使用解密的邮箱密钥对邮箱本身进行解密，从而允许您访问邮箱内的数据。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-206">Use the decrypted Mailbox Key to decrypt the mailbox itself, allowing you to access the data within the mailbox.</span></span>

## <a name="how-sharepoint-online-onedrive-for-business-and-teams-files-use-the-availability-key"></a><span data-ttu-id="bb4e4-207">SharePoint Online、OneDrive for Business 和 Teams 文件如何使用可用性密钥</span><span class="sxs-lookup"><span data-stu-id="bb4e4-207">How SharePoint Online, OneDrive for Business, and Teams files use the availability key</span></span>

<span data-ttu-id="bb4e4-208">客户密钥和可用性密钥的 SharePoint Online 和 OneDrive for Business 体系结构和实现不同于 Exchange Online 和 Skype for Business。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-208">The SharePoint Online and OneDrive for Business architecture and implementation for Customer Key and availability key are different from Exchange Online and Skype for Business.</span></span>
  
<span data-ttu-id="bb4e4-209">当组织移动到客户管理的密钥时，Microsoft 365 将创建特定于组织的中间密钥 (TIK) 。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-209">When an organization moves to customer-managed keys, Microsoft 365 creates an organization-specific intermediate key (TIK).</span></span> <span data-ttu-id="bb4e4-210">Microsoft 365 对 TIK 进行两次加密，一次加密每个客户密钥，并存储两个加密版本的 TIK。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-210">Microsoft 365 encrypts the TIK twice, once with each of the customer keys, and stores the two encrypted versions of the TIK.</span></span> <span data-ttu-id="bb4e4-211">仅存储 TIK 的加密版本，并且 TIK 只能使用客户密钥解密。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-211">Only the encrypted versions of the TIK are stored, and a TIK can only be decrypted with the customer keys.</span></span> <span data-ttu-id="bb4e4-212">然后，TIK 用于加密站点密钥，然后用于加密 blob 密钥 (也称为文件区块密钥) 。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-212">The TIK is then used to encrypt site keys, which are then used to encrypt blob keys (also called file chunk keys).</span></span> <span data-ttu-id="bb4e4-213">根据文件大小，该服务可能会将一个文件拆分为多个文件区块，每个文件块中都有一个唯一的密钥。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-213">Depending on file size, the service may split a file into multiple file chunks each with a unique key.</span></span> <span data-ttu-id="bb4e4-214">这些 blob (文件区块) Blob 密钥进行加密，并存储在 Microsoft Azure Blob 存储服务中。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-214">The blobs (file chunks) themselves are encrypted with the blob keys and stored in the Microsoft Azure Blob storage service.</span></span>
  
<span data-ttu-id="bb4e4-215">Microsoft 365 遵循此过程在客户使用该服务时解密并提供客户文件：</span><span class="sxs-lookup"><span data-stu-id="bb4e4-215">Microsoft 365 follows this process to decrypt and provide customer files when customers are using the service:</span></span>

1. <span data-ttu-id="bb4e4-216">使用客户密钥解密 TIK。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-216">Decrypt the TIK using the Customer Key.</span></span>

2. <span data-ttu-id="bb4e4-217">使用解密的 TIK 解密站点密钥。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-217">Use the decrypted TIK to decrypt a site key.</span></span>

3. <span data-ttu-id="bb4e4-218">使用解密的站点密钥解密 blob 密钥。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-218">Use the decrypted site key to decrypt a blob key.</span></span>

4. <span data-ttu-id="bb4e4-219">使用解密的 blob 密钥解密 blob。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-219">Use the decrypted blob key to decrypt the blob.</span></span>

<span data-ttu-id="bb4e4-220">Microsoft 365 通过向 Azure 密钥保管库发出两个稍有偏移的解密请求来解密 TIK。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-220">Microsoft 365 decrypts a TIK by issuing two decryption requests to Azure Key Vault with a slight offset.</span></span> <span data-ttu-id="bb4e4-221">第一个完成的请求将提供结果，同时取消另一个请求。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-221">The first one to finish furnishes the result, canceling the other request.</span></span>
  
<span data-ttu-id="bb4e4-222">如果你失去对客户密钥的访问权限，Microsoft 365 还会使用可用性密钥加密 TIK，并随每个客户密钥加密的 TI 一起存储它。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-222">In case you lose access to your customer keys, Microsoft 365 also encrypts the TIK with an availability key and stores this along with the TIKs encrypted with each customer key.</span></span> <span data-ttu-id="bb4e4-223">使用可用性密钥加密的 TIK 仅在客户恶意或无意丢失对密钥的访问时，调用 Microsoft 加入恢复路径时使用。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-223">The TIK encrypted with the availability key is used only when the customer calls Microsoft to enlist the recovery path when they have lost access to their keys, maliciously or accidentally.</span></span>
  
<span data-ttu-id="bb4e4-224">出于可用性和扩展原因，解密的 TIK 缓存在有时间限制的内存缓存中。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-224">For availability and scale reasons, decrypted TIKs are cached in a time-limited memory cache.</span></span> <span data-ttu-id="bb4e4-225">在 TIK 缓存设置为过期前两小时，Microsoft 365 会尝试解密每个 TIK。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-225">Two hours before a TIK cache is set to expire, Microsoft 365 attempts to decrypt each TIK.</span></span> <span data-ttu-id="bb4e4-226">解密 TIK 可延长缓存的生存期。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-226">Decrypting the TIKs extends the lifetime of the cache.</span></span> <span data-ttu-id="bb4e4-227">如果 TIK 解密失败很长时间，Microsoft 365 将生成警报，在缓存过期之前通知工程人员。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-227">If TIK decryption fails for a significant amount of time, Microsoft 365 generates an alert to notify engineering prior to the cache expiration.</span></span> <span data-ttu-id="bb4e4-228">只有当客户呼叫 Microsoft 时，Microsoft 365 才启动恢复操作，该操作涉及使用存储在 Microsoft 密码存储中的可用性密钥解密 TIK，然后使用解密的 TIK 和一组新的客户提供的 Azure 密钥保管库密钥再次载入租户。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-228">Only if the customer calls Microsoft will Microsoft 365 initiate the recovery operation, which involves decrypting the TIK with the availability key stored in Microsoft's secret store and onboarding the tenant again using the decrypted TIK and a new set of customer-supplied Azure Key Vault keys.</span></span>
  
<span data-ttu-id="bb4e4-229">截至目前，客户密钥已涉及 Azure blob 存储中存储的 SharePoint Online 文件数据的加密和解密链，但不包括存储在 SQL 数据库中的 SharePoint Online 列表项或元数据。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-229">As of today, Customer Key is involved in the encryption and decryption chain of SharePoint Online file data stored in the Azure blob store, but not SharePoint Online list items or metadata stored in the SQL Database.</span></span> <span data-ttu-id="bb4e4-230">除了上述由客户启动的情况外，Microsoft 365 不会将可用性密钥用于 Exchange Online、Skype for Business、SharePoint Online、OneDrive for Business 和 Teams 文件。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-230">Microsoft 365 does not use the availability key for Exchange Online, Skype for Business, SharePoint Online, OneDrive for Business, and Teams files other than the case described above, which is customer-initiated.</span></span> <span data-ttu-id="bb4e4-231">对客户数据的人工访问受客户密码箱保护。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-231">Human access to customer data is protected by Customer Lockbox.</span></span>

## <a name="availability-key-triggers"></a><span data-ttu-id="bb4e4-232">可用性键触发器</span><span class="sxs-lookup"><span data-stu-id="bb4e4-232">Availability key triggers</span></span>

<span data-ttu-id="bb4e4-233">Microsoft 365 仅在特定情况下触发可用性密钥。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-233">Microsoft 365 triggers the availability key only in specific circumstances.</span></span> <span data-ttu-id="bb4e4-234">这些情况因服务不同而不同。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-234">These circumstances differ by service.</span></span>

### <a name="triggers-for-exchange-online-and-skype-for-business"></a><span data-ttu-id="bb4e4-235">Exchange Online 和 Skype for Business 的触发器</span><span class="sxs-lookup"><span data-stu-id="bb4e4-235">Triggers for Exchange Online and Skype for Business</span></span>
  
1. <span data-ttu-id="bb4e4-236">Microsoft 365 读取邮箱分配到的 DEP，以确定 Azure Key Vault 中两个客户密钥的位置。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-236">Microsoft 365 reads the DEP to which the mailbox is assigned in order to determine the location of the two Customer Keys in Azure Key Vault.</span></span>

2. <span data-ttu-id="bb4e4-237">Microsoft 365 从 DEP 随机选择两个客户密钥中的一个，并将请求发送到 Azure Key Vault 以使用客户密钥解包 DEP 密钥。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-237">Microsoft 365 randomly chooses one of the two Customer Keys from the DEP and sends a request to Azure Key Vault to unwrap the DEP key using the Customer Key.</span></span>

3. <span data-ttu-id="bb4e4-238">如果使用客户密钥解包 DEP 密钥的请求失败，Microsoft 365 将向 Azure Key Vault 发送第二个请求，这次指示它使用备用 (第二个) 客户密钥。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-238">If the request to unwrap the DEP key using the Customer Key fails, Microsoft 365 sends a second request to Azure Key Vault, this time instructing it to use the alternate (second) Customer Key.</span></span>

4. <span data-ttu-id="bb4e4-239">如果使用客户密钥解包 DEP 密钥的第二个请求失败，Microsoft 365 将检查这两个请求的结果。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-239">If the second request to unwrap the DEP key using the Customer Key fails, Microsoft 365 examines the results of both requests.</span></span>

    - <span data-ttu-id="bb4e4-240">如果检查确定请求失败，则返回系统错误：</span><span class="sxs-lookup"><span data-stu-id="bb4e4-240">If the examination determines that the requests failed returning a system ERROR:</span></span>

       - <span data-ttu-id="bb4e4-241">Microsoft 365 触发可用性密钥以解密 DEP 密钥。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-241">Microsoft 365 triggers the availability key to decrypt the DEP key.</span></span>

       - <span data-ttu-id="bb4e4-242">然后，Microsoft 365 使用 DEP 密钥解密邮箱密钥并完成用户请求。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-242">Microsoft 365 then uses the DEP key to decrypt the mailbox key and complete the user request.</span></span> 

       - <span data-ttu-id="bb4e4-243">在这种情况下，Azure Key Vault 因暂时性错误无法响应或无法访问。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-243">In this case, Azure Key Vault is either unable to respond or unreachable due to a transient ERROR.</span></span>

    - <span data-ttu-id="bb4e4-244">如果检查确定请求未能返回拒绝访问：</span><span class="sxs-lookup"><span data-stu-id="bb4e4-244">If the examination determines that the requests failed returning ACCESS DENIED:</span></span>

       - <span data-ttu-id="bb4e4-245">这意味着已采取有意、无意或恶意操作，使客户密钥不可用 (例如，在将数据清除过程中作为离开服务服务的一) 。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-245">This means deliberate, inadvertent, or malicious action has been taken to render the customer keys unavailable (for example, during the data purge process as part of leaving the service).</span></span>

       - <span data-ttu-id="bb4e4-246">在这种情况下，可用性密钥将仅用于系统操作，不用于用户操作，用户请求将失败，并且用户会收到错误消息。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-246">In this case, the availability key will be used only for system actions and not for user actions, the user request fails, and the user receives an error message.</span></span>

>[!IMPORTANT]
><span data-ttu-id="bb4e4-247">Microsoft 365 服务代码始终具有有效的登录令牌，用于通过客户数据进行推断以提供增值云服务。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-247">Microsoft 365 service code always has a valid login token for reasoning over customer data to provide value-adding cloud services.</span></span> <span data-ttu-id="bb4e4-248">因此，在删除可用性密钥之前，它可用作由 Exchange Online 和 Skype for Business 启动的操作（或内部操作，如搜索索引创建或移动邮箱）的回退。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-248">Therefore, until the availability key has been deleted, it can be used as a fallback for actions initiated by, or internal to, Exchange Online and Skype for Business such as search index creation or moving mailboxes.</span></span> <span data-ttu-id="bb4e4-249">这适用于对 Azure 密钥保管库的暂时性错误和访问被拒绝请求。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-249">This applies to both transient ERRORS and ACCESS DENIED requests to Azure Key Vault.</span></span>

### <a name="triggers-for-sharepoint-online-onedrive-for-business-and-teams-files"></a><span data-ttu-id="bb4e4-250">SharePoint Online、OneDrive for Business 和 Teams 文件的触发器</span><span class="sxs-lookup"><span data-stu-id="bb4e4-250">Triggers for SharePoint Online, OneDrive for Business, and Teams files</span></span>

<span data-ttu-id="bb4e4-251">对于 SharePoint Online、OneDrive for Business 和 Teams 文件，在恢复功能之外从不使用可用性密钥，客户必须明确指示 Microsoft 在恢复方案期间启动可用性密钥的使用。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-251">For SharePoint Online, OneDrive for Business, and Teams files, the availability key is NEVER used outside of the recovery capability and customers must explicitly instruct Microsoft to initiate use of the availability key during a recovery scenario.</span></span>

## <a name="audit-logs-and-the-availability-key"></a><span data-ttu-id="bb4e4-252">审核日志和可用性密钥</span><span class="sxs-lookup"><span data-stu-id="bb4e4-252">Audit logs and the availability key</span></span>

<span data-ttu-id="bb4e4-253">Microsoft 365 中的自动化系统会在数据流经系统时处理所有数据，以提供云服务，例如防病毒、电子数据发现、数据丢失防护和数据索引。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-253">Automated systems in Microsoft 365 process all data as it flows through the system to provide cloud services, for example, anti-virus, e-discovery, data loss prevention, and data indexing.</span></span> <span data-ttu-id="bb4e4-254">Microsoft 365 不会为此活动生成客户可见的日志。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-254">Microsoft 365 does not generate customer-visible logs for this activity.</span></span> <span data-ttu-id="bb4e4-255">此外，Microsoft 人员不会在这些正常系统操作中访问你的数据。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-255">In addition, Microsoft personnel do not access your data as part of these normal system operations.</span></span>

### <a name="exchange-online-and-skype-for-business-availability-key-logging"></a><span data-ttu-id="bb4e4-256">Exchange Online 和 Skype for Business 可用性密钥日志记录</span><span class="sxs-lookup"><span data-stu-id="bb4e4-256">Exchange Online and Skype for Business availability key logging</span></span>

<span data-ttu-id="bb4e4-257">当 Exchange Online 和 Skype for Business 访问可用性密钥以提供服务时，Microsoft 365 将发布可从安全与合规中心访问的客户可见日志。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-257">When Exchange Online and Skype for Business accesses availability key to provide service, Microsoft 365 publishes customer-visible logs accessible from the Security and Compliance Center.</span></span> <span data-ttu-id="bb4e4-258">每次审核日志使用可用性密钥时，将生成可用性键操作的数据记录。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-258">An audit log record for the availability key operation is generated each time the service uses the availability key.</span></span> <span data-ttu-id="bb4e4-259">使用活动类型为"回退到可用性密钥"的名为"客户密钥服务加密"的新记录类型，管理员可以筛选统一 [审核日志](./search-the-audit-log-in-security-and-compliance.md) 搜索结果以查看可用性密钥记录。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-259">A new record type called "Customer Key Service Encryption" with activity type "Fallback to Availability Key" allows admins to filter [Unified Audit Log](./search-the-audit-log-in-security-and-compliance.md) search results to view availability key records.</span></span>

<span data-ttu-id="bb4e4-260">日志记录包括诸如日期、时间、活动、组织 ID 和数据加密策略 ID 等属性。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-260">Log records include attributes such as date, time, activity, organization ID, and data encryption policy ID.</span></span> <span data-ttu-id="bb4e4-261">该记录作为统一审核日志的一部分提供，可从安全与合规&审核日志搜索"选项卡访问。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-261">The record is available as part of Unified Audit Logs and is accessible from the Security & Compliance Center Audit Log Search tab.</span></span>

![审核日志搜索可用性密钥事件](../media/customerkeyauditlogsearchavailabilitykeyloggingimage.png)

<span data-ttu-id="bb4e4-263">Exchange Online 和 Skype for Business 可用性密钥记录使用 Office 365 [管理活动通用](/office/office-365-management-api/office-365-management-activity-api-schema#common-schema) 架构，并添加了自定义参数：策略 ID、作用域密钥版本 ID 和请求 ID。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-263">Exchange Online and Skype for Business availability key records use the Office 365 Management Activity [common schema](/office/office-365-management-api/office-365-management-activity-api-schema#common-schema) with added custom parameters: Policy Id, Scope Key Version Id, and Request Id.</span></span>

![可用性密钥自定义参数](../media/customerkeyauditlogsearchavailabilitykeyloggingcustomparam.png)

### <a name="sharepoint-online-onedrive-for-business-and-teams-files-availability-key-logging"></a><span data-ttu-id="bb4e4-265">SharePoint Online、OneDrive for Business 和 Teams 文件可用性密钥日志记录</span><span class="sxs-lookup"><span data-stu-id="bb4e4-265">SharePoint Online, OneDrive for Business, and Teams files availability key logging</span></span>

<span data-ttu-id="bb4e4-266">可用性密钥日志记录尚不可用于这些服务。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-266">Availability key logging isn't available yet for these services.</span></span> <span data-ttu-id="bb4e4-267">对于 SharePoint Online、OneDrive for Business 和 Teams 文件，可用性密钥仅在你指示时由 Microsoft 激活，以便进行恢复。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-267">For SharePoint Online, OneDrive for Business, and Teams files, the availability key is only activated by Microsoft, when instructed by you, for recovery purposes.</span></span> <span data-ttu-id="bb4e4-268">因此，你已知道可用性密钥用于这些服务的每一个事件。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-268">As a result, you already know every event in which the availability key is used for these services.</span></span>

## <a name="availability-key-in-the-customer-key-hierarchy"></a><span data-ttu-id="bb4e4-269">客户密钥层次结构中的可用性密钥</span><span class="sxs-lookup"><span data-stu-id="bb4e4-269">Availability key in the Customer Key hierarchy</span></span>
  
<span data-ttu-id="bb4e4-270">Microsoft 365 使用可用性密钥包装为客户密钥服务加密建立的关键层次结构中较低级别的密钥。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-270">Microsoft 365 uses the availability key to wrap the tier of keys lower in the key hierarchy established for Customer Key service encryption.</span></span> <span data-ttu-id="bb4e4-271">服务之间存在不同的密钥层次结构。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-271">Different key hierarchies exist between services.</span></span> <span data-ttu-id="bb4e4-272">密钥算法在每个适用服务的层次结构中的可用性密钥和其他密钥之间也有所不同。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-272">Key algorithms also differ between availability keys and other keys in the hierarchy of each applicable service.</span></span> <span data-ttu-id="bb4e4-273">不同服务使用的可用性密钥算法如下所示：</span><span class="sxs-lookup"><span data-stu-id="bb4e4-273">The availability key algorithms used by the different services are as follows:</span></span>

- <span data-ttu-id="bb4e4-274">Exchange Online 和 Skype for Business 可用性密钥使用 AES-256。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-274">The Exchange Online and Skype for Business availability keys use AES-256.</span></span>

- <span data-ttu-id="bb4e4-275">SharePoint Online、OneDrive for Business 和 Teams 文件可用性密钥使用 RSA-2048。</span><span class="sxs-lookup"><span data-stu-id="bb4e4-275">The SharePoint Online, OneDrive for Business, and Teams files availability keys use RSA-2048.</span></span>

### <a name="encryption-ciphers-used-to-encrypt-keys-for-exchange-online-and-skype-for-business"></a><span data-ttu-id="bb4e4-276">用于加密 Exchange Online 和 Skype for Business 的密钥的加密密码</span><span class="sxs-lookup"><span data-stu-id="bb4e4-276">Encryption ciphers used to encrypt keys for Exchange Online and Skype for Business</span></span>

![Exchange Online 客户密钥的加密密码](../media/customerkeyencryptionhierarchiesexchangeskype.png)

### <a name="encryption-ciphers-used-to-encrypt-keys-for-sharepoint-online-and-onedrive-for-business"></a><span data-ttu-id="bb4e4-278">用于为 SharePoint Online 和 OneDrive for Business 加密密钥的加密密码</span><span class="sxs-lookup"><span data-stu-id="bb4e4-278">Encryption ciphers used to encrypt keys for SharePoint Online and OneDrive for Business</span></span>

![SharePoint Online 客户密钥的加密密码](../media/customerkeyencryptionhierarchiessharepointonedriveteamsfiles.png)

## <a name="related-articles"></a><span data-ttu-id="bb4e4-280">相关文章</span><span class="sxs-lookup"><span data-stu-id="bb4e4-280">Related articles</span></span>

- [<span data-ttu-id="bb4e4-281">使用客户密钥执行服务加密</span><span class="sxs-lookup"><span data-stu-id="bb4e4-281">Service encryption with Customer Key</span></span>](customer-key-overview.md)

- [<span data-ttu-id="bb4e4-282">设置客户密钥</span><span class="sxs-lookup"><span data-stu-id="bb4e4-282">Set up Customer Key</span></span>](customer-key-set-up.md)

- [<span data-ttu-id="bb4e4-283">管理客户密钥</span><span class="sxs-lookup"><span data-stu-id="bb4e4-283">Manage Customer Key</span></span>](customer-key-manage.md)

- [<span data-ttu-id="bb4e4-284">滚动或旋转客户密钥或可用性密钥</span><span class="sxs-lookup"><span data-stu-id="bb4e4-284">Roll or rotate a Customer Key or an availability key</span></span>](customer-key-availability-key-roll.md)