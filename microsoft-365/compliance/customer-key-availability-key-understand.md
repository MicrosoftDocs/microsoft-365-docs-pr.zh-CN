---
title: 了解 Office 365 客户密钥的可用性密钥
ms.author: krowley
author: kccross
manager: laurawi
ms.date: 02/05/2020
audience: ITPro
ms.topic: article
ms.service: O365-seccomp
localization_priority: Normal
search.appverid:
- MET150
description: 了解用于恢复丢失的 Office 365 客户密钥的可用性密钥。
ms.openlocfilehash: 86f602a59f436a6ce42df583c88c0403eb17e5ae
ms.sourcegitcommit: 3dd9944a6070a7f35c4bc2b57df397f844c3fe79
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 02/15/2020
ms.locfileid: "42076941"
---
# <a name="learn-about-the-availability-key-for-office-365-customer-key"></a><span data-ttu-id="fe0bf-103">了解 Office 365 客户密钥的可用性密钥</span><span class="sxs-lookup"><span data-stu-id="fe0bf-103">Learn about the availability key for Office 365 Customer Key</span></span>

<span data-ttu-id="fe0bf-104">可用性密钥是在创建数据加密策略时自动生成和设置的根密钥。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-104">The availability key is a root key automatically generated and provisioned when you create a data encryption policy.</span></span> <span data-ttu-id="fe0bf-105">Office 365 存储和保护可用性密钥。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-105">Office 365 stores and protects the availability key.</span></span> <span data-ttu-id="fe0bf-106">可用性密钥的功能类似于为使用客户密钥的服务加密提供的两个根键。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-106">The availability key is functionally like the two root keys that you supply for service encryption with Customer Key.</span></span> <span data-ttu-id="fe0bf-107">可用性密钥会将键层次结构中的键向下封装一层。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-107">The availability key wraps the keys one tier lower in the key hierarchy.</span></span> <span data-ttu-id="fe0bf-108">与在 Azure Key Vault 中提供和管理的密钥不同，您不能直接访问可用性密钥。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-108">Unlike the keys that you provide and manage in Azure Key Vault, you can't directly access the availability key.</span></span> <span data-ttu-id="fe0bf-109">Office 365 自动化服务使用 PowerShell cmdlet 管理可用性密钥。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-109">Office 365 automated services manage the availability key using PowerShell cmdlets.</span></span> <span data-ttu-id="fe0bf-110">这些 cmdlet 会启动自动化操作，这些操作永远不会涉及直接访问可用性密钥。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-110">These cmdlets initiate automated operations that never involve direct access to the availability key.</span></span>

<span data-ttu-id="fe0bf-111">可用性密钥的主要用途是通过所管理的根密钥的意外丢失来提供恢复功能。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-111">The primary purpose of the availability key is to provide recovery capability from the unanticipated loss of root keys that you manage.</span></span> <span data-ttu-id="fe0bf-112">丢失可能是 mismanagement 或恶意操作的结果。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-112">Loss could be a result of mismanagement or malicious action.</span></span> <span data-ttu-id="fe0bf-113">如果你丢失了对根密钥的控制，请联系 Microsoft 支持部门，Microsoft 将为你提供使用可用性密钥进行恢复的过程。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-113">If you lose control of your root keys, contact Microsoft Support and Microsoft will assist you through the process of recovery using the availability key.</span></span> <span data-ttu-id="fe0bf-114">你将使用可用性密钥迁移到新的数据加密策略，并使用你预配的新根密钥。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-114">You'll use the availability key to migrate to a new Data Encryption Policy with new root keys you provision.</span></span>

<span data-ttu-id="fe0bf-115">由于以下三个原因，可用性密钥的存储和控制特意不同于 Azure 密钥存储库密钥：</span><span class="sxs-lookup"><span data-stu-id="fe0bf-115">Storage and control of the availability key are deliberately different from Azure Key Vault keys for three reasons:</span></span>

- <span data-ttu-id="fe0bf-116">如果对 Azure Key Vault 密钥的控制丢失，则可用性密钥提供恢复 "中断玻璃" 功能。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-116">The availability key provides a recovery, "break-glass" capability if control over both Azure Key Vault keys is lost.</span></span>
- <span data-ttu-id="fe0bf-117">分离逻辑控件和安全存储位置可提供深入防护，防止因单个攻击或故障点而导致丢失所有密钥和数据。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-117">The separation of logical controls and secure storage locations provides defense-in-depth and protects against the loss of all keys, and your data, from a single attack or point of failure.</span></span>
- <span data-ttu-id="fe0bf-118">如果 Office 365 服务由于暂时性错误而无法访问 Azure Key Vault 中托管的密钥，则可用性密钥提供了高可用性功能。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-118">The availability key provides a high-availability capability if Office 365 services are unable to reach keys hosted in Azure Key Vault due to transient errors.</span></span> <span data-ttu-id="fe0bf-119">此规则仅适用于 Exchange Online 和 Skype for Business 服务加密。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-119">This rule only applies to Exchange Online and Skype for Business service encryption.</span></span> <span data-ttu-id="fe0bf-120">SharePoint Online、OneDrive for Business 和团队文件永远不使用可用性密钥，除非您明确指示 Microsoft 启动恢复过程。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-120">SharePoint Online, OneDrive for Business, and Teams files never use the availability key unless you explicitly instruct Microsoft to initiate the recovery process.</span></span>

<span data-ttu-id="fe0bf-121">共享责任若要使用各种保护措施和密钥管理流程来保护数据，最终降低了所有密钥（因而您的数据）将永久丢失或损坏的风险。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-121">Sharing the responsibility to protect your data, using a variety of protections and processes for key management, ultimately reduces the risk that all keys (and therefore your data) will be permanently lost or destroyed.</span></span> <span data-ttu-id="fe0bf-122">当你离开服务时，Microsoft 会为你提供禁用或销毁可用性密钥的唯一权限。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-122">Microsoft provides you with sole authority over the disablement or destruction of the availability key when you leave the service.</span></span> <span data-ttu-id="fe0bf-123">根据设计，Microsoft 没有任何人可以访问可用性密钥：它只能通过 Office 365 服务代码访问。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-123">By design, no one at Microsoft has access to the availability key: it is only accessible by Office 365 service code.</span></span>

<span data-ttu-id="fe0bf-124">有关我们如何保护密钥的详细信息，请参阅[Microsoft 信任中心](https://www.microsoft.com/trustcenter/Privacy/govt-requests-for-data)。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-124">See the [Microsoft Trust Center](https://www.microsoft.com/trustcenter/Privacy/govt-requests-for-data) for more information about how we secure keys.</span></span>
  
## <a name="availability-key-uses"></a><span data-ttu-id="fe0bf-125">可用性密钥使用</span><span class="sxs-lookup"><span data-stu-id="fe0bf-125">Availability key uses</span></span>

<span data-ttu-id="fe0bf-126">可用性密钥为应用场景提供了恢复功能，在这种情况下，在外部 malefactor 或恶意的内部攻击的内部盗取控制密钥存储库，或当无意 mismanagement 导致丢失根密钥时。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-126">The availability key provides recovery capability for scenarios in which an external malefactor or malicious insider steals control of your key vault, or when inadvertent mismanagement results in loss of root keys.</span></span> <span data-ttu-id="fe0bf-127">此恢复功能适用于所有与客户密钥兼容的 Office 365 服务。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-127">This recovery capability applies to all Office 365 services compatible with Customer Key.</span></span> <span data-ttu-id="fe0bf-128">各个服务使用可用性密钥的方式不同。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-128">Individual services use the availability key differently.</span></span> <span data-ttu-id="fe0bf-129">Office 365 仅使用下文所述的方法中的可用性密钥。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-129">Office 365 only uses the availability key in the ways described below.</span></span>

### <a name="exchange-online-and-skype-for-business-uses"></a><span data-ttu-id="fe0bf-130">Exchange Online 和 Skype for Business 使用</span><span class="sxs-lookup"><span data-stu-id="fe0bf-130">Exchange Online and Skype for Business uses</span></span>

<span data-ttu-id="fe0bf-131">除了恢复功能之外，Exchange Online 和 Skype for business 还可以使用可用性密钥确保暂时性的数据可用性，或与访问根键的服务相关的间歇操作问题。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-131">In addition to the recovery capability, Exchange Online and Skype for Business use the availability key to ensure data availability during transient, or intermittent operational issues, related to the service accessing root keys.</span></span> <span data-ttu-id="fe0bf-132">当服务由于暂时性错误而无法到达 Azure Key Vault 中的任何客户密钥时，该服务将自动使用可用性密钥。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-132">When the service cannot reach either of your Customer Keys in Azure Key Vault due to transient errors, the service automatically uses the availability key.</span></span> <span data-ttu-id="fe0bf-133">服务永远不会直接转到可用性密钥。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-133">The service NEVER goes directly to the availability key.</span></span>

<span data-ttu-id="fe0bf-134">Exchange Online 和 Skype for business 中的自动系统可能会在暂时性错误期间使用可用性密钥，以支持自动化后端服务，如防病毒、电子发现、数据丢失防护、邮箱移动和数据索引。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-134">Automated systems in Exchange Online and Skype for Business may use the availability key during transient errors to support automated back-end services such as anti-virus, e-discovery, data loss prevention, mailbox moves, and data indexing.</span></span>

### <a name="sharepointonlineonedriveforbusinessandteamsfiles-uses"></a><span data-ttu-id="fe0bf-135">SharePoint Online、OneDrive for Business 和团队文件使用</span><span class="sxs-lookup"><span data-stu-id="fe0bf-135">SharePoint Online, OneDrive for Business, and Teams files uses</span></span>

<span data-ttu-id="fe0bf-136">对于 SharePoint Online、OneDrive for Business 和团队文件，可用性密钥从不在恢复功能的外部使用，客户必须明确指示 Microsoft 在恢复方案中启动使用可用性密钥。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-136">For SharePoint Online, OneDrive for Business, and Teams files, the availability key is NEVER used outside of the recovery capability and customers must explicitly instruct Microsoft to initiate use of the availability key during a recovery scenario.</span></span> <span data-ttu-id="fe0bf-137">自动化服务操作完全依赖于 Azure Key vault 中的客户密钥。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-137">Automated service operations solely rely on your Customer Keys in Azure Key vault.</span></span> <span data-ttu-id="fe0bf-138">有关关键层次结构如何适用于这些服务的详细信息，请参阅[SharePoint Online、OneDrive For business 和团队文件如何使用可用性密钥](#how-sharepoint-online-onedrive-for-business-and-teams-files-use-the-availability-key)。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-138">For in-depth information about how the key hierarchy works for these services, see [How SharePoint Online, OneDrive for Business, and Teams files use the availability key](#how-sharepoint-online-onedrive-for-business-and-teams-files-use-the-availability-key).</span></span>

## <a name="availability-key-security"></a><span data-ttu-id="fe0bf-139">可用性密钥安全性</span><span class="sxs-lookup"><span data-stu-id="fe0bf-139">Availability key security</span></span>

<span data-ttu-id="fe0bf-140">Microsoft 通过实例化可用性密钥并采取广泛的措施来保护数据保护，从而分担数据保护的责任。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-140">Microsoft shares the responsibility of data protection with you by instantiating the availability key and taking extensive measures to protect it.</span></span> <span data-ttu-id="fe0bf-141">Microsoft 不会向客户公开对可用性密钥的直接控制。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-141">Microsoft does not expose direct control of the availability key to customers.</span></span> <span data-ttu-id="fe0bf-142">例如，您只能在 Azure Key Vault 中滚动（旋转）您拥有的密钥。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-142">For example, you can only roll (rotate) the keys that you own in Azure Key Vault.</span></span> <span data-ttu-id="fe0bf-143">有关详细信息，请参阅[滚动或旋转客户密钥或可用性密钥](customer-key-availability-key-roll.md)。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-143">For more information, see [Roll or rotate a customer key or an availability key](customer-key-availability-key-roll.md).</span></span>

### <a name="availability-key-secret-stores"></a><span data-ttu-id="fe0bf-144">可用性密钥密钥存储</span><span class="sxs-lookup"><span data-stu-id="fe0bf-144">Availability key secret stores</span></span>

<span data-ttu-id="fe0bf-145">Microsoft 在受访问控制的内部密钥存储区（如面向客户的 Azure 密钥存储库）中保护可用性密钥。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-145">Microsoft protects availability keys in access-controlled, internal secret stores like the customer-facing Azure Key Vault.</span></span> <span data-ttu-id="fe0bf-146">我们实现了访问控制，以防止 Microsoft 管理员直接访问中包含的密码。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-146">We implement access controls to prevent Microsoft administrators from directly accessing the secrets contained within.</span></span> <span data-ttu-id="fe0bf-147">秘密存储操作，包括密钥轮换、删除和检索通过永不涉及直接访问可用性密钥的自动化命令进行。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-147">Secret Store operations, including key rotation, deletion, and retrieval occur through automated commands that never involve direct access to the availability key.</span></span> <span data-ttu-id="fe0bf-148">调整这些命令的访问权限仅限于特定的工程师，并需要通过内部工具密码箱进行权限提升。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-148">Access to adjust these commands is limited to specific engineers and requires privilege escalation through an internal tool, Lockbox.</span></span> <span data-ttu-id="fe0bf-149">权限提升要求在授予前的经理批准和理由。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-149">Privilege escalation requires manager approval and justification prior to being granted.</span></span> <span data-ttu-id="fe0bf-150">密码箱可确保在时间到期或工程师注销时，访问时间绑定到自动访问撤销。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-150">Lockbox ensures access is time bound with automatic access revocation upon time expiration or engineer log out.</span></span>

<span data-ttu-id="fe0bf-151">**Exchange Online 和 Skype for** business 可用性密钥存储在 Active Directory 机密存储区中。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-151">**Exchange Online and Skype for Business** availability keys are stored in an Active Directory secret store.</span></span> <span data-ttu-id="fe0bf-152">Exchange Online Active Directory 由路由包含对象、标识和数据的流量和容量林的管理林组成。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-152">Exchange Online Active Directory is comprised of Management forests that route traffic and Capacity forests that contain objects, identities, and data.</span></span> <span data-ttu-id="fe0bf-153">容量林由帐户林和资源林组成。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-153">Capacity forests consist of Account forests and Resource forests.</span></span> <span data-ttu-id="fe0bf-154">帐户林具有彼此同步的多个容量域控制器。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-154">Account forests have multiple Capacity domain controllers that are synced with one another.</span></span> <span data-ttu-id="fe0bf-155">可用性密钥安全存储在这些容量的域控制器中。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-155">Availability keys are securely stored within these Capacity domain controllers.</span></span> <span data-ttu-id="fe0bf-156">此安全存储位置是独立的，并与 SharePoint Online、OneDrive for Business 和团队文件机密存储区隔离。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-156">This secure storage location is separate and isolated from the SharePoint Online, OneDrive for Business, and Teams files secret store.</span></span>

<span data-ttu-id="fe0bf-157">**SharePoint Online、OneDrive For business 和团队文件**可用性密钥存储在由服务团队管理的内部机密存储区中。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-157">**SharePoint Online, OneDrive for Business, and Teams files** availability keys are stored in an internal secret store managed by the service team.</span></span> <span data-ttu-id="fe0bf-158">此安全的机密存储服务具有前端服务器和应用程序终结点，并将 SQL 数据库作为后端。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-158">This secured, secrets storage service has front-end servers with application endpoints and a SQL Database as the back end.</span></span> <span data-ttu-id="fe0bf-159">可用性密钥存储在 SQL 数据库中，并通过使用 AES-256 和 HMAC 组合来加密 rest 上的可用密钥的机密存储加密密钥进行包装（加密）。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-159">Availability keys are stored in the SQL Database and are wrapped (encrypted) by secret store encryption keys that use a combination of AES-256 and HMAC to encrypt the availability key at rest.</span></span> <span data-ttu-id="fe0bf-160">机密存储加密密钥存储在同一 SQL 数据库的逻辑隔离组件中，并使用 Microsoft 证书颁发机构（CA）管理的证书中包含的 RSA-2048 密钥进一步加密。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-160">The secret store encryption keys are stored in a logically isolated component of the same SQL Database and are further encrypted with RSA-2048 keys contained in certificates managed by the Microsoft certificate authority (CA).</span></span> <span data-ttu-id="fe0bf-161">这些证书存储在对数据库执行操作的机密存储前端服务器中。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-161">These certificates are stored in the secret store front-end servers that perform operations against the database.</span></span>

### <a name="defense-in-depth"></a><span data-ttu-id="fe0bf-162">深层纵深防御</span><span class="sxs-lookup"><span data-stu-id="fe0bf-162">Defense-in-depth</span></span>

<span data-ttu-id="fe0bf-163">Microsoft 采用纵深防御策略，以防止恶意参与者影响存储在 Microsoft 云中的客户数据的机密性、完整性或可用性。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-163">Microsoft employs a defense-in-depth strategy to prevent malicious actors from impacting the confidentiality, integrity, or availability of customer data stored in the Microsoft Cloud.</span></span> <span data-ttu-id="fe0bf-164">实施特定的预防和侦探控制，以保护机密存储和可用性密钥作为总体安全策略的一部分。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-164">Specific preventive and detective controls are implemented to protect the secret store and the availability key as part of the overarching security strategy.</span></span>

<span data-ttu-id="fe0bf-165">Office 365 的构建旨在防止对可用性密钥的滥用。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-165">Office 365 is built to prevent misuse of the availability key.</span></span> <span data-ttu-id="fe0bf-166">应用程序层是可用于加密和解密数据的键（包括可用性密钥）的唯一方法。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-166">The application layer is the only method through which keys, including the availability key, can be used to encrypt and decrypt data.</span></span> <span data-ttu-id="fe0bf-167">只有 Office 365 服务代码能够解释和遍历加密和解密活动的关键层次结构。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-167">Only Office 365 service code has the ability to interpret and traverse the key hierarchy for encryption and decryption activities.</span></span> <span data-ttu-id="fe0bf-168">如果恶意 Microsoft 管理员要绕过控件以从机密存储中提取可用性密钥，则密钥将无法访问客户数据。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-168">If a malicious Microsoft administrator were to circumvent controls to extract an availability key from the secret store, the key would be unusable to access customer data.</span></span> <span data-ttu-id="fe0bf-169">客户密钥、可用性密钥、其他分层密钥和客户数据的存储位置之间存在逻辑隔离。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-169">Logical isolation exists between the storage locations of Customer Keys, availability keys, other hierarchical keys, and customer data.</span></span> <span data-ttu-id="fe0bf-170">这种隔离缓解了在一个或多个位置遭到破坏的情况中发生数据泄露的风险。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-170">This isolation mitigates the risk of data exposure in the event one or more locations are compromised.</span></span> <span data-ttu-id="fe0bf-171">层次结构中的每个层都具有内置的全天候入侵检测功能，以保护数据和机密存储。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-171">Each layer in the hierarchy has built in 24x7 intrusion detection capabilities to protect data and secrets stores.</span></span>

<span data-ttu-id="fe0bf-172">实现访问控制可防止对内部系统进行未经授权的访问，包括可用性密钥机密存储。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-172">Access controls are implemented to prevent unauthorized access to internal systems, including availability key secret stores.</span></span> <span data-ttu-id="fe0bf-173">Microsoft 工程师不能直接访问可用性密钥机密存储。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-173">Microsoft engineers don't have direct access to the availability key secret stores.</span></span> <span data-ttu-id="fe0bf-174">有关访问控制的更多详细信息，请参阅[Office 365 中的管理访问控制](https://docs.microsoft.com/Office365/securitycompliance/office-365-administrative-access-controls-overview)。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-174">For additional detail on access controls, review [Administrative Access Controls in Office 365](https://docs.microsoft.com/Office365/securitycompliance/office-365-administrative-access-controls-overview).</span></span>

<span data-ttu-id="fe0bf-175">技术控制可防止 Microsoft 人员登录到高度特权的服务帐户，攻击者可能会使用这些服务帐户来模拟 Office 365 服务。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-175">Technical controls prevent Microsoft personnel from logging into highly-privileged service accounts, which might otherwise be used by attackers to impersonate Office 365 services.</span></span> <span data-ttu-id="fe0bf-176">例如，这些控件将阻止交互式登录。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-176">For example, these controls prevent interactive logon.</span></span>

<span data-ttu-id="fe0bf-177">安全日志记录和监视控件是实施的另一种纵深防御保护，可降低 Microsoft 服务和数据的风险。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-177">Security logging and monitoring controls are another defense-in-depth safeguard implemented that mitigate risk to Microsoft services and your data.</span></span> <span data-ttu-id="fe0bf-178">Microsoft 服务团队部署了可生成警报和审核日志的活动监视解决方案。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-178">Microsoft service teams have deployed active monitoring solutions that generate alerts and audit logs.</span></span> <span data-ttu-id="fe0bf-179">所有服务团队将其日志上传到一个中央存储库，其中的日志进行了聚合和处理。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-179">All service teams upload their logs to a central repository where the logs are aggregated and processed.</span></span> <span data-ttu-id="fe0bf-180">内部工具会自动检查记录，以确认服务是否以最佳、可恢复且安全的状态运行。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-180">Internal tools automatically examine records to confirm that services are functioning in an optimal, resilient, and secure state.</span></span> <span data-ttu-id="fe0bf-181">标记出不正常的活动以供进一步审阅。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-181">Unusual activity is flagged for further review.</span></span>

<span data-ttu-id="fe0bf-182">任何指示潜在的 Microsoft 安全策略冲突的日志事件将立即进入 Microsoft 安全团队的关注。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-182">Any log event that indicates a potential violation of the Microsoft Security Policy is immediately brought to the attention of Microsoft security teams.</span></span> <span data-ttu-id="fe0bf-183">Office 365 安全性已配置警报，以检测对可用性密钥密钥存储的尝试访问权限。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-183">Office 365 security has configured alerts to detect attempted access to availability key secret stores.</span></span> <span data-ttu-id="fe0bf-184">如果 Microsoft 人员尝试以交互方式登录到服务帐户（受访问控制禁止和保护），也会生成警报。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-184">Alerts are also generated if Microsoft personnel attempt interactive logon to service accounts, which is prohibited and protected by access controls.</span></span> <span data-ttu-id="fe0bf-185">Office 365 安全性还检测并通知 Office 365 服务与常规基准操作的偏差。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-185">Office 365 security also detects and alerts upon deviations of the Office 365 service from normal baseline operations.</span></span> <span data-ttu-id="fe0bf-186">尝试滥用 Office 365 服务的 Malefactors 将触发警报，从而导致罪犯从 Microsoft 云环境中逐出。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-186">Malefactors attempting to misuse Office 365 services would trigger alerts resulting in the offender's eviction from the Microsoft cloud environment.</span></span>

## <a name="use-the-availability-key-to-recover-from-key-loss"></a><span data-ttu-id="fe0bf-187">使用可用性密钥从密钥丢失中恢复</span><span class="sxs-lookup"><span data-stu-id="fe0bf-187">Use the availability key to recover from key loss</span></span>

<span data-ttu-id="fe0bf-188">如果您失去了对客户密钥的控制，则可用性密钥使您能够恢复和重新加密数据。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-188">If you lose control of your Customer Keys, the availability key provides you the ability to recover and re-encrypt your data.</span></span>

### <a name="recovery-procedure-for-exchange-online-and-skype-for-business"></a><span data-ttu-id="fe0bf-189">Exchange Online 和 Skype for business 的恢复过程</span><span class="sxs-lookup"><span data-stu-id="fe0bf-189">Recovery procedure for Exchange Online and Skype for Business</span></span>

<span data-ttu-id="fe0bf-190">如果您失去了对客户密钥的控制，可用性密钥使您能够恢复数据，并将受影响的 Office 365 资源恢复为联机状态。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-190">If you lose control of your Customer Keys, the availability key gives you the capability to recover your data and bring your impacted Office 365 resources back online.</span></span> <span data-ttu-id="fe0bf-191">恢复时，可用性密钥将继续保护你的数据。从较高的层次来看，若要从密钥丢失完全恢复，您需要创建一个新的 DEP 并将受影响的资源移动到新策略。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-191">The availability key continues to protect your data while you recover.At a high level, to fully recover from key loss, you'll need to create a new DEP and move impacted resources to the new policy.</span></span>

<span data-ttu-id="fe0bf-192">若要使用新的客户密钥对数据进行加密，请在 Azure Key Vault 中创建新密钥，使用新的客户密钥创建新的 DEP，然后将新的 DEP 分配给当前使用以前的 DEP 加密的邮箱，这些邮箱已丢失或损坏密钥。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-192">To encrypt your data with new Customer Keys, create new keys in Azure Key Vault, create a new DEP using the new Customer Keys, then assign the new DEP to the mailboxes currently encrypted with the previous DEP for which the keys were lost or compromised.</span></span>

<span data-ttu-id="fe0bf-193">此重新加密过程最长可能需要72个小时。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-193">This re-encryption process can take up to 72 hours.</span></span> <span data-ttu-id="fe0bf-194">这是更改 DEP 时的标准持续时间。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-194">This is the standard duration when you change a DEP.</span></span>
  
### <a name="recovery-procedure-for-sharepointonlineonedriveforbusinessandteamsfiles"></a><span data-ttu-id="fe0bf-195">SharePoint Online、OneDrive for Business 和团队文件的恢复过程</span><span class="sxs-lookup"><span data-stu-id="fe0bf-195">Recovery procedure for SharePoint Online, OneDrive for Business, and Teams files</span></span>

<span data-ttu-id="fe0bf-196">对于 SharePoint Online、OneDrive for Business 和团队文件，可用性密钥从不在恢复功能的外部使用。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-196">For SharePoint Online, OneDrive for Business, and Teams files, the availability key is NEVER used outside of the recovery capability.</span></span> <span data-ttu-id="fe0bf-197">您必须明确指示 Microsoft 在恢复方案中启动使用可用性密钥。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-197">You must explicitly instruct Microsoft to initiate use of the availability key during a recovery scenario.</span></span> <span data-ttu-id="fe0bf-198">若要启动恢复过程，请与 Microsoft 联系以激活可用性密钥。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-198">To initiate the recovery process, contact Microsoft to activate the availability key.</span></span> <span data-ttu-id="fe0bf-199">一旦激活，可用性密钥将自动用于解密你的数据，使你能够使用与新的客户密钥关联的新创建的 DEP 对数据进行加密。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-199">Once activated, the availability key is automatically used to decrypt your data allowing you to encrypt the data with a newly-created DEP associated to new Customer Keys.</span></span>  

<span data-ttu-id="fe0bf-200">此操作与组织中的网站数成比例。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-200">This operation is proportional to the number of sites in your organization.</span></span> <span data-ttu-id="fe0bf-201">调用 Microsoft 使用可用性密钥后，应在大约4小时内完全在线。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-201">Once you call Microsoft to use the availability key, you should be fully online within about four hours.</span></span>

## <a name="how-exchange-online-and-skype-for-business-use-the-availability-key"></a><span data-ttu-id="fe0bf-202">Exchange Online 和 Skype for business 如何使用可用性密钥</span><span class="sxs-lookup"><span data-stu-id="fe0bf-202">How Exchange Online and Skype for Business use the availability key</span></span>

<span data-ttu-id="fe0bf-203">当您使用客户密钥创建 DEP 时，Office 365 将生成与该 DEP 相关联的数据加密策略密钥（DEP 密钥）。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-203">When you create a DEP with Customer Key, Office 365 generates a Data Encryption Policy Key (DEP Key) associated with that DEP.</span></span> <span data-ttu-id="fe0bf-204">该服务将 DEP 密钥加密三次：每个客户密钥一次，并使用可用性密钥。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-204">The service encrypts the DEP Key three times: once with each of the customer keys and once with the availability key.</span></span> <span data-ttu-id="fe0bf-205">仅存储加密版本的 DEP 密钥，并且只能使用客户密钥或可用性密钥解密 DEP 密钥。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-205">Only the encrypted versions of the DEP Key are stored, and a DEP Key can only be decrypted with the customer keys or the availability key.</span></span> <span data-ttu-id="fe0bf-206">然后，使用 DEP 密钥加密邮箱密钥，这些邮箱加密单个邮箱。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-206">The DEP Key is then used to encrypt Mailbox Keys, which encrypt individual mailboxes.</span></span>
  
<span data-ttu-id="fe0bf-207">在客户使用该服务时，Office 365 将执行以下过程来解密和提供数据：</span><span class="sxs-lookup"><span data-stu-id="fe0bf-207">Office 365 follows this process to decrypt and provide data when customers are using the service:</span></span>
  
1. <span data-ttu-id="fe0bf-208">使用客户密钥对 DEP 密钥进行解密。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-208">Decrypt the DEP Key using the Customer Key.</span></span>

2. <span data-ttu-id="fe0bf-209">使用解密的 DEP 密钥对邮箱密钥进行解密。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-209">Use the decrypted DEP Key to decrypt a Mailbox Key.</span></span>

3. <span data-ttu-id="fe0bf-210">使用解密邮箱密钥对邮箱本身进行解密，从而允许您访问邮箱中的数据。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-210">Use the decrypted Mailbox Key to decrypt the mailbox itself, allowing you to access the data within the mailbox.</span></span>

<span data-ttu-id="fe0bf-211">Office 365 通过向 Azure Key Vault 发出两个解密请求来解密 DEP 密钥，其中包含轻微偏移量。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-211">Office 365 decrypts a DEP Key by issuing two decryption requests to Azure Key Vault with a slight offset.</span></span> <span data-ttu-id="fe0bf-212">第一个要完成的提供结果，取消了另一个请求。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-212">The first one to finish furnishes the result, canceling the other request.</span></span>

## <a name="how-sharepoint-online-onedrive-for-business-and-teams-files-use-the-availability-key"></a><span data-ttu-id="fe0bf-213">SharePoint Online、OneDrive for Business 和团队文件如何使用可用性密钥</span><span class="sxs-lookup"><span data-stu-id="fe0bf-213">How SharePoint Online, OneDrive for Business, and Teams files use the availability key</span></span>

<span data-ttu-id="fe0bf-214">SharePoint Online 和 OneDrive for business 体系结构以及客户密钥和可用性密钥实现不同于 Exchange Online 和 Skype for business。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-214">The SharePoint Online and OneDrive for Business architecture and implementation for Customer Key and availability key are different from Exchange Online and Skype for Business.</span></span>
  
<span data-ttu-id="fe0bf-215">当组织移动到客户管理的密钥时，Office 365 将创建特定于租户的中间密钥（TIK）。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-215">When an organization moves to customer-managed keys, Office 365 creates a tenant-specific intermediate key (TIK).</span></span> <span data-ttu-id="fe0bf-216">Office 365 将 TIK 加密两次，每个客户密钥一次，并存储 TIK 的两个加密版本。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-216">Office 365 encrypts the TIK twice, once with each of the customer keys, and stores the two encrypted versions of the TIK.</span></span> <span data-ttu-id="fe0bf-217">仅存储 TIK 的加密版本，并且 TIK 只能使用客户密钥进行解密。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-217">Only the encrypted versions of the TIK are stored, and a TIK can only be decrypted with the customer keys.</span></span> <span data-ttu-id="fe0bf-218">然后，TIK 用于对网站密钥进行加密，然后使用这些密钥对 blob 密钥（也称为 "文件块密钥"）进行加密。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-218">The TIK is then used to encrypt site keys, which are then used to encrypt blob keys (also called file chunk keys).</span></span> <span data-ttu-id="fe0bf-219">根据文件大小，服务可能会将文件拆分为多个文件块，每个文件块都有一个唯一键。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-219">Depending on file size, the service may split a file into multiple file chunks each with a unique key.</span></span> <span data-ttu-id="fe0bf-220">Blob （文件区块）本身是使用 blob 密钥加密的，并存储在 Microsoft Azure Blob 存储服务中。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-220">The blobs (file chunks) themselves are encrypted with the blob keys and stored in the Microsoft Azure Blob storage service.</span></span>
  
<span data-ttu-id="fe0bf-221">在客户使用该服务时，Office 365 将执行以下过程来解密和提供客户文件：</span><span class="sxs-lookup"><span data-stu-id="fe0bf-221">Office 365 follows this process to decrypt and provide customer files when customers are using the service:</span></span>

1. <span data-ttu-id="fe0bf-222">使用客户密钥对 TIK 进行解密。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-222">Decrypt the TIK using the Customer Key.</span></span>

2. <span data-ttu-id="fe0bf-223">使用解密的 TIK 解密网站密钥。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-223">Use the decrypted TIK to decrypt a site key.</span></span>

3. <span data-ttu-id="fe0bf-224">使用解密的网站密钥对 blob 密钥进行解密。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-224">Use the decrypted site key to decrypt a blob key.</span></span>

4. <span data-ttu-id="fe0bf-225">使用解密的 blob 密钥对 blob 进行解密。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-225">Use the decrypted blob key to decrypt the blob.</span></span>

<span data-ttu-id="fe0bf-226">Office 365 通过在具有轻微偏移量的 Azure Key Vault 发出两个解密请求来解密 TIK。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-226">Office 365 decrypts a TIK by issuing two decryption requests to Azure Key Vault with a slight offset.</span></span> <span data-ttu-id="fe0bf-227">第一个要完成的提供结果，取消了另一个请求。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-227">The first one to finish furnishes the result, canceling the other request.</span></span>
  
<span data-ttu-id="fe0bf-228">如果你失去了对客户密钥的访问权限，Office 365 还会使用可用性密钥加密 TIK，并将其与使用每个客户密钥加密的 TIKs 存储在一起。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-228">In case you lose access to your customer keys, Office 365 also encrypts the TIK with an availability key and stores this along with the TIKs encrypted with each customer key.</span></span> <span data-ttu-id="fe0bf-229">使用 availability 密钥加密的 TIK 仅当客户在失去对其密钥的访问权限（恶意或意外）时，才将 Microsoft 用于登记恢复路径。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-229">The TIK encrypted with the availability key is used only when the customer calls Microsoft to enlist the recovery path when they have lost access to their keys, maliciously or accidentally.</span></span>
  
<span data-ttu-id="fe0bf-230">出于可用性和扩展原因，解密的 TIKs 缓存在一个时间有限的内存缓存中。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-230">For availability and scale reasons, decrypted TIKs are cached in a time-limited memory cache.</span></span> <span data-ttu-id="fe0bf-231">在 TIK 缓存设置为过期之前的两个小时，Office 365 将尝试对每个 TIK 进行解密。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-231">Two hours before a TIK cache is set to expire, Office 365 attempts to decrypt each TIK.</span></span> <span data-ttu-id="fe0bf-232">对 TIKs 进行解密会延长缓存的生存期。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-232">Decrypting the TIKs extends the lifetime of the cache.</span></span> <span data-ttu-id="fe0bf-233">如果 TIK 解密在很长一段时间后失败，Office 365 将生成一个警报，以在缓存过期之前通知工程。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-233">If TIK decryption fails for a significant amount of time, Office 365 generates an alert to notify engineering prior to the cache expiration.</span></span> <span data-ttu-id="fe0bf-234">仅当客户呼叫 Microsoft 时，Office 365 才会启动恢复操作，这涉及使用存储在 Microsoft 机密存储中的可用性密钥对 TIK 进行解密，并使用解密的 TIK 再次载入租户，并使用一组新的客户提供的 Azure Key Vault 密钥。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-234">Only if the customer calls Microsoft will Office 365 initiate the recovery operation, which involves decrypting the TIK with the availability key stored in Microsoft's secret store and onboarding the tenant again using the decrypted TIK and a new set of customer-supplied Azure Key Vault keys.</span></span>
  
<span data-ttu-id="fe0bf-235">到目前为止，客户密钥包含在 Azure blob 存储中存储的 SharePoint Online 文件数据的加密和解密链中，但不包含在 SQL 数据库中存储的 SharePoint online 列表项或元数据中。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-235">As of today, Customer Key is involved in the encryption and decryption chain of SharePoint Online file data stored in the Azure blob store, but not SharePoint Online list items or metadata stored in the SQL Database.</span></span> <span data-ttu-id="fe0bf-236">除了客户启动的情况之外，Office 365 不使用 Exchange Online、Skype for Business、SharePoint Online、OneDrive for business 和团队文件之外的其他项。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-236">Office 365 does not use the availability key for Exchange Online, Skype for Business, SharePoint Online, OneDrive for Business, and Teams files other than the case described above, which is customer-initiated.</span></span> <span data-ttu-id="fe0bf-237">对客户数据的人对客户数据的访问受客户密码箱保护。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-237">Human access to customer data is protected by Customer Lockbox.</span></span>

## <a name="availability-key-triggers"></a><span data-ttu-id="fe0bf-238">可用性密钥触发器</span><span class="sxs-lookup"><span data-stu-id="fe0bf-238">Availability key triggers</span></span>

<span data-ttu-id="fe0bf-239">Office 365 仅在特定情况下触发可用性密钥。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-239">Office 365 triggers the availability key only in specific circumstances.</span></span> <span data-ttu-id="fe0bf-240">这些情况因服务而异。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-240">These circumstances differ by service.</span></span>

### <a name="triggers-for-exchange-online-and-skype-for-business"></a><span data-ttu-id="fe0bf-241">Exchange Online 和 Skype for business 的触发器</span><span class="sxs-lookup"><span data-stu-id="fe0bf-241">Triggers for Exchange Online and Skype for Business</span></span>
  
1. <span data-ttu-id="fe0bf-242">Office 365 读取邮箱分配到的 DEP，以便确定两个客户密钥在 Azure Key Vault 中的位置。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-242">Office 365 reads the DEP to which the mailbox is assigned in order to determine the location of the two Customer Keys in Azure Key Vault.</span></span>

2. <span data-ttu-id="fe0bf-243">Office 365 从 DEP 中随机选择两个客户密钥中的一个，并向 Azure Key Vault 发送一个请求，以使用客户密钥解包 DEP 密钥。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-243">Office 365 randomly chooses one of the two Customer Keys from the DEP and sends a request to Azure Key Vault to unwrap the DEP key using the Customer Key.</span></span>

3. <span data-ttu-id="fe0bf-244">如果使用客户密钥对对 DEP 密钥进行解包的请求失败，Office 365 将向 Azure Key Vault 发送第二个请求，这次指示它使用备用（第二）客户密钥。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-244">If the request to unwrap the DEP key using the Customer Key fails, Office 365 sends a second request to Azure Key Vault, this time instructing it to use the alternate (second) Customer Key.</span></span>

4. <span data-ttu-id="fe0bf-245">如果使用客户密钥对 DEP 密钥进行解包的第二个请求失败，则 Office 365 会检查这两个请求的结果。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-245">If the second request to unwrap the DEP key using the Customer Key fails, Office 365 examines the results of both requests.</span></span>

    - <span data-ttu-id="fe0bf-246">如果检查确定返回系统错误的请求失败：</span><span class="sxs-lookup"><span data-stu-id="fe0bf-246">If the examination determines that the requests failed returning a system ERROR:</span></span>

       - <span data-ttu-id="fe0bf-247">Office 365 将触发可用性密钥以解密 DEP 密钥。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-247">Office 365 triggers the availability key to decrypt the DEP key.</span></span>

       - <span data-ttu-id="fe0bf-248">然后，Office 365 使用 DEP 密钥来解密邮箱密钥，并完成用户请求。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-248">Office 365 then uses the DEP key to decrypt the mailbox key and complete the user request.</span></span> 

       - <span data-ttu-id="fe0bf-249">在这种情况下，由于暂时性错误，Azure Key Vault 无法响应或无法访问。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-249">In this case, Azure Key Vault is either unable to respond or unreachable due to a transient ERROR.</span></span>

    - <span data-ttu-id="fe0bf-250">如果检查确定访问被拒绝的请求失败：</span><span class="sxs-lookup"><span data-stu-id="fe0bf-250">If the examination determines that the requests failed returning ACCESS DENIED:</span></span>

       - <span data-ttu-id="fe0bf-251">这意味着已采取了故意、无意或恶意操作来呈现客户密钥不可用（例如，在离开服务的过程中，在数据清除过程中）。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-251">This means deliberate, inadvertent, or malicious action has been taken to render the customer keys unavailable (for example, during the data purge process as part of leaving the service).</span></span>

       - <span data-ttu-id="fe0bf-252">在这种情况下，将不会使用可用性密钥，用户请求将失败，并且用户会收到一条错误消息。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-252">In this case, the availability key will not be used, the user request fails, and the user receives an error message.</span></span>

>[!IMPORTANT]
><span data-ttu-id="fe0bf-253">Office 365 服务代码始终具有有效的登录令牌，用于推理客户数据以提供增值云服务。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-253">Office 365 service code always has a valid login token for reasoning over customer data to provide value-adding cloud services.</span></span> <span data-ttu-id="fe0bf-254">因此，在删除可用性密钥之前，可将其用作 Exchange Online 和 Skype for business （如搜索索引创建或移动邮箱）启动的操作的回退。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-254">Therefore, until the availability key has been deleted, it can be used as a fallback for actions initiated by, or internal to, Exchange Online and Skype for Business such as search index creation or moving mailboxes.</span></span> <span data-ttu-id="fe0bf-255">这适用于暂时性错误和访问 Azure Key Vault 拒绝的请求。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-255">This applies to both transient ERRORS and ACCESS DENIED requests to Azure Key Vault.</span></span>

### <a name="triggers-for-sharepoint-online-onedrive-for-business-and-teams-files"></a><span data-ttu-id="fe0bf-256">SharePoint Online、OneDrive for Business 和团队文件的触发器</span><span class="sxs-lookup"><span data-stu-id="fe0bf-256">Triggers for SharePoint Online, OneDrive for Business, and Teams files</span></span>

<span data-ttu-id="fe0bf-257">对于 SharePoint Online、OneDrive for Business 和团队文件，可用性密钥从不在恢复功能的外部使用，客户必须明确指示 Microsoft 在恢复方案中启动使用可用性密钥。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-257">For SharePoint Online, OneDrive for Business, and Teams files, the availability key is NEVER used outside of the recovery capability and customers must explicitly instruct Microsoft to initiate use of the availability key during a recovery scenario.</span></span>

## <a name="audit-logs-and-the-availability-key"></a><span data-ttu-id="fe0bf-258">审核日志和可用性密钥</span><span class="sxs-lookup"><span data-stu-id="fe0bf-258">Audit logs and the availability key</span></span>

<span data-ttu-id="fe0bf-259">Office 365 中的自动化系统处理所有数据在系统中流动，以提供云服务，例如，反病毒、电子发现、数据丢失防护和数据索引。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-259">Automated systems in Office 365 process all data as it flows through the system to provide cloud services, for example, anti-virus, e-discovery, data loss prevention, and data indexing.</span></span> <span data-ttu-id="fe0bf-260">Office 365 不会为此活动生成客户可见的日志。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-260">Office 365 does not generate customer-visible logs for this activity.</span></span> <span data-ttu-id="fe0bf-261">此外，Microsoft 人员不会作为这些正常系统操作的一部分访问你的数据。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-261">In addition, Microsoft personnel do not access your data as part of these normal system operations.</span></span>

### <a name="exchange-online-and-skype-for-business-availability-key-logging"></a><span data-ttu-id="fe0bf-262">Exchange Online 和 Skype for business 可用性密钥日志记录</span><span class="sxs-lookup"><span data-stu-id="fe0bf-262">Exchange Online and Skype for Business availability key logging</span></span>

<span data-ttu-id="fe0bf-263">Exchange Online 和 Skype for business 在暂时性错误期间自动使用可用性密钥。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-263">Exchange Online and Skype for Business automatically use the availability key during transient errors.</span></span> <span data-ttu-id="fe0bf-264">当此回退发生时，Office 365 将发布从安全与合规中心可访问的客户可见日志。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-264">When this fallback occurs, Office 365 publishes customer-visible logs accessible from the Security and Compliance Center.</span></span> <span data-ttu-id="fe0bf-265">每次这些服务使用可用性密钥时，都会生成可用性密钥操作的审核日志记录。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-265">An audit log record for the availability key operation is generated each time these services use the availability key.</span></span> <span data-ttu-id="fe0bf-266">名为 "Customer Key Service Encryption" 的新记录类型，活动类型为 "回退到可用性密钥"，允许管理员筛选[统一审核日志](https://docs.microsoft.com/microsoft-365/compliance/search-the-audit-log-in-security-and-compliance)搜索结果以查看可用性密钥记录。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-266">A new record type called “Customer Key Service Encryption” with activity type "Fallback to Availability Key" allows admins to filter [Unified Audit Log](https://docs.microsoft.com/microsoft-365/compliance/search-the-audit-log-in-security-and-compliance) search results to view availability key records.</span></span> <span data-ttu-id="fe0bf-267">仅当使用 Customer 密钥访问数据而不是 Microsoft 服务管理密钥时，才会生成可用性密钥记录。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-267">The availability key record gets generated only when Customer Key is used to access the data and not for Microsoft service-managed keys.</span></span>

<span data-ttu-id="fe0bf-268">日志记录包括 "日期"、"时间"、"活动"、"组织 ID" 和 "数据加密策略 ID" 等属性。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-268">Log records include attributes such as date, time, activity, organization ID, and data encryption policy ID.</span></span> <span data-ttu-id="fe0bf-269">该记录可作为 Office 365 统一的审核日志的一部分，并可从 Office 365 安全性和合规性中心审核日志搜索选项卡进行访问。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-269">The record is available as part of Office 365 Unified Audit Logs and is accessible from the Office 365 Security and Compliance Center Audit Log Search tab.</span></span>

![审核日志搜索可用性密钥事件](../media/customerkeyauditlogsearchavailabilitykeyloggingimage.png)

<span data-ttu-id="fe0bf-271">Exchange Online 和 Skype for business 可用性密钥记录使用 Office 365 管理活动[常见架构](https://docs.microsoft.com/office/office-365-management-api/office-365-management-activity-api-schema#common-schema)和添加的自定义参数： Policy Id、作用域密钥版本 Id 和请求 Id。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-271">Exchange Online and Skype for Business availability key records use the Office 365 Management Activity [common schema](https://docs.microsoft.com/office/office-365-management-api/office-365-management-activity-api-schema#common-schema) with added custom parameters: Policy Id, Scope Key Version Id, and Request Id.</span></span>

![可用性密钥自定义参数](../media/customerkeyauditlogsearchavailabilitykeyloggingcustomparam.png)

### <a name="sharepoint-online-onedrive-for-business-and-teams-files-availability-key-logging"></a><span data-ttu-id="fe0bf-273">SharePoint Online、OneDrive for Business 和团队文件可用性密钥日志记录</span><span class="sxs-lookup"><span data-stu-id="fe0bf-273">SharePoint Online, OneDrive for Business, and Teams files availability key logging</span></span>

<span data-ttu-id="fe0bf-274">可用性密钥日志记录尚不可用于这些服务。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-274">Availability key logging isn't available yet for these services.</span></span> <span data-ttu-id="fe0bf-275">对于 SharePoint Online、OneDrive for Business 和团队文件，可用性密钥仅在由你指示的情况下由 Microsoft 激活，以供恢复之用。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-275">For SharePoint Online, OneDrive for Business, and Teams files, the availability key is only activated by Microsoft, when instructed by you, for recovery purposes.</span></span> <span data-ttu-id="fe0bf-276">因此，您已经知道可用性密钥可用于这些服务的每个事件。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-276">As a result, you already know every event in which the availability key is used for these services.</span></span>

## <a name="availability-key-in-the-customer-key-hierarchy"></a><span data-ttu-id="fe0bf-277">客户密钥层次结构中的可用性密钥</span><span class="sxs-lookup"><span data-stu-id="fe0bf-277">Availability key in the Customer Key hierarchy</span></span>
  
<span data-ttu-id="fe0bf-278">Office 365 使用可用性密钥包装在为客户密钥服务加密建立的密钥层次结构中较低的密钥层。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-278">Office 365 uses the availability key to wrap the tier of keys lower in the key hierarchy established for Customer Key service encryption.</span></span> <span data-ttu-id="fe0bf-279">服务之间存在不同的密钥层次结构。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-279">Different key hierarchies exist between services.</span></span> <span data-ttu-id="fe0bf-280">每个适用服务的层次结构中的可用性密钥和其他密钥之间的密钥算法也不同。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-280">Key algorithms also differ between availability keys and other keys in the hierarchy of each applicable service.</span></span> <span data-ttu-id="fe0bf-281">不同服务使用的可用性密钥算法如下所示：</span><span class="sxs-lookup"><span data-stu-id="fe0bf-281">The availability key algorithms used by the different services are as follows:</span></span>

- <span data-ttu-id="fe0bf-282">Exchange Online 和 Skype for business 可用性密钥使用 AES-256。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-282">The Exchange Online and Skype for Business availability keys use AES-256.</span></span>

- <span data-ttu-id="fe0bf-283">SharePoint Online、OneDrive for Business 和团队文件可用性密钥使用的是 RSA-2048。</span><span class="sxs-lookup"><span data-stu-id="fe0bf-283">The SharePoint Online, OneDrive for Business, and Teams files availability keys use RSA-2048.</span></span>

### <a name="encryption-ciphers-used-to-encrypt-keys-for-exchange-online-and-skype-for-business"></a><span data-ttu-id="fe0bf-284">用于加密 Exchange Online 和 Skype for business 的密钥的加密密码</span><span class="sxs-lookup"><span data-stu-id="fe0bf-284">Encryption ciphers used to encrypt keys for Exchange Online and Skype for Business</span></span>

![Exchange Online 客户密钥的加密密码](../media/customerkeyencryptionhierarchiesexchangeskype.png)

### <a name="encryption-ciphers-used-to-encrypt-keys-for-sharepoint-online-and-onedrive-for-business"></a><span data-ttu-id="fe0bf-286">用于对 SharePoint Online 和 OneDrive for Business 的密钥进行加密的加密密码</span><span class="sxs-lookup"><span data-stu-id="fe0bf-286">Encryption ciphers used to encrypt keys for SharePoint Online and OneDrive for Business</span></span>

![SharePoint Online 客户密钥的加密密码](../media/customerkeyencryptionhierarchiessharepointonedriveteamsfiles.png)

## <a name="related-articles"></a><span data-ttu-id="fe0bf-288">相关文章</span><span class="sxs-lookup"><span data-stu-id="fe0bf-288">Related articles</span></span>

- [<span data-ttu-id="fe0bf-289">使用 Office 365 的客户密钥进行服务加密</span><span class="sxs-lookup"><span data-stu-id="fe0bf-289">Service encryption with Customer Key for Office 365</span></span>](customer-key-overview.md)

- [<span data-ttu-id="fe0bf-290">设置适用于 Office 的客户密钥365</span><span class="sxs-lookup"><span data-stu-id="fe0bf-290">Set up Customer Key for Office 365</span></span>](customer-key-set-up.md)

- [<span data-ttu-id="fe0bf-291">管理 Office 365 的客户密钥</span><span class="sxs-lookup"><span data-stu-id="fe0bf-291">Manage Customer Key for Office 365</span></span>](customer-key-manage.md)

- [<span data-ttu-id="fe0bf-292">滚动或旋转客户密钥或可用性密钥</span><span class="sxs-lookup"><span data-stu-id="fe0bf-292">Roll or rotate a Customer Key or an availability key</span></span>](customer-key-availability-key-roll.md)
