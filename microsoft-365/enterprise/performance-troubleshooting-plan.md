---
title: Office 365 的性能疑难解答计划
ms.author: kvice
author: kelleyvice-msft
manager: laurawi
ms.date: 5/10/2019
audience: Admin
ms.topic: conceptual
ms.service: o365-administration
localization_priority: Normal
f1.keywords:
- CSH
ms.custom:
- Adm_O365
- seo-marvel-apr2020
search.appverid:
- MET150
- MOE150
- BCS160
ms.assetid: e241e5d9-b1d8-4f1d-a5c8-4106b7325f8c
ms.collection:
- M365-security-compliance
- Ent_O365
description: 本文可以帮助您解决Office 365问题，甚至解决一些最常见的问题。
ms.openlocfilehash: 588a19e86d903a7ab709a7f0d0131da6e2a77f47
ms.sourcegitcommit: 27b2b2e5c41934b918cac2c171556c45e36661bf
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/19/2021
ms.locfileid: "50928232"
---
# <a name="performance-troubleshooting-plan-for-office-365"></a><span data-ttu-id="fea7c-103">Office 365 的性能疑难解答计划</span><span class="sxs-lookup"><span data-stu-id="fea7c-103">Performance troubleshooting plan for Office 365</span></span>

<span data-ttu-id="fea7c-104">是否需要了解识别并修复 SharePoint Online、OneDrive for Business、Exchange Online 或 Skype for Business Online 和客户端计算机之间的延迟、挂起和缓慢性能的步骤？</span><span class="sxs-lookup"><span data-stu-id="fea7c-104">Do you need to know the steps to take to identify and fix lags, hangs, and slow performance between SharePoint Online, OneDrive for Business, Exchange Online, or Skype for Business Online, and your client computer?</span></span> <span data-ttu-id="fea7c-105">在致电支持人员之前，本文可以帮助您Office 365性能问题，甚至解决一些最常见的问题。</span><span class="sxs-lookup"><span data-stu-id="fea7c-105">Before you call support, this article can help you troubleshoot Office 365 performance issues and even fix some of the most common issues.</span></span>

<span data-ttu-id="fea7c-106">本文实际上是一个示例行动计划，可用于捕获有关性能问题的有价值的数据。</span><span class="sxs-lookup"><span data-stu-id="fea7c-106">This article is actually a sample action plan that you can use to capture valuable data about your performance issue as it's happening.</span></span> <span data-ttu-id="fea7c-107">本文中还包括一些首要问题。</span><span class="sxs-lookup"><span data-stu-id="fea7c-107">Some top issues are also included in this article.</span></span>

<span data-ttu-id="fea7c-108">如果你对网络性能很了解，并且想要制定长期计划来监视客户端计算机和 Office 365 之间的性能，请看一下 Office 365 性能调整和疑难解答 - 管理员[和 IT](performance-tuning-using-baselines-and-history.md)Pro。</span><span class="sxs-lookup"><span data-stu-id="fea7c-108">If you're new to network performance and want to make a long term plan to monitor performance between your client machines and Office 365, take a look at [Office 365 performance tuning and troubleshooting - Admin and IT Pro](performance-tuning-using-baselines-and-history.md).</span></span>

## <a name="sample-performance-troubleshooting-action-plan"></a><span data-ttu-id="fea7c-109">性能疑难解答操作计划示例</span><span class="sxs-lookup"><span data-stu-id="fea7c-109">Sample performance troubleshooting action plan</span></span>

<span data-ttu-id="fea7c-110">此行动计划包含两个部分;准备阶段和日志记录阶段。</span><span class="sxs-lookup"><span data-stu-id="fea7c-110">This action plan contains two parts; a preparation phase, and a logging phase.</span></span> <span data-ttu-id="fea7c-111">如果当前存在性能问题，并且需要执行数据收集，可以立即开始使用此计划。</span><span class="sxs-lookup"><span data-stu-id="fea7c-111">If you have a performance problem right now, and you need to do data collection, you can start using this plan right away.</span></span>

### <a name="prepare-the-client-computer"></a><span data-ttu-id="fea7c-112">准备客户端计算机</span><span class="sxs-lookup"><span data-stu-id="fea7c-112">Prepare the client computer</span></span>

- <span data-ttu-id="fea7c-113">查找可重现性能问题的客户端计算机。</span><span class="sxs-lookup"><span data-stu-id="fea7c-113">Find a client computer that can reproduce the performance problem.</span></span> <span data-ttu-id="fea7c-114">此计算机将在疑难解答过程中使用。</span><span class="sxs-lookup"><span data-stu-id="fea7c-114">This computer will be used during the course of troubleshooting.</span></span>
- <span data-ttu-id="fea7c-115">记下导致出现性能问题的步骤，以便准备好进行测试。</span><span class="sxs-lookup"><span data-stu-id="fea7c-115">Write down the steps that cause the performance problem to happen so you're ready when it comes time to test.</span></span>
- <span data-ttu-id="fea7c-116">安装用于收集和记录信息的工具：</span><span class="sxs-lookup"><span data-stu-id="fea7c-116">Install tools for gathering and recording information:</span></span>
  - <span data-ttu-id="fea7c-117">安装 [Netmon 3.4](https://www.microsoft.com/download/details.aspx?id=4865) (或使用等效的网络跟踪工具) 。</span><span class="sxs-lookup"><span data-stu-id="fea7c-117">Install [Netmon 3.4](https://www.microsoft.com/download/details.aspx?id=4865) (or use an equivalent network tracing tool).</span></span>
  - <span data-ttu-id="fea7c-118">安装免费的 BASIC Edition [HTTPWatch](https://www.httpwatch.com/download/) (或使用等效的网络跟踪工具) 。</span><span class="sxs-lookup"><span data-stu-id="fea7c-118">Install the free Basic Edition of [HTTPWatch](https://www.httpwatch.com/download/) (or use an equivalent network Tracing tool).</span></span>
  - <span data-ttu-id="fea7c-119">使用屏幕录制器或运行 (PSR.exe) Vista Windows更高版本随附的步骤录制器，以便记录测试过程中所执行的步骤。</span><span class="sxs-lookup"><span data-stu-id="fea7c-119">Use a screen recorder or run the Steps Recorder (PSR.exe) that comes with Windows Vista and later, in order to keep a record of the steps you take during testing.</span></span>

### <a name="log-the-performance-issue"></a><span data-ttu-id="fea7c-120">记录性能问题</span><span class="sxs-lookup"><span data-stu-id="fea7c-120">Log the performance issue</span></span>

- <span data-ttu-id="fea7c-121">关闭所有多余的 Internet 浏览器。</span><span class="sxs-lookup"><span data-stu-id="fea7c-121">Close all extraneous Internet browsers.</span></span>
- <span data-ttu-id="fea7c-122">启动步骤录制器或其他屏幕录制器。</span><span class="sxs-lookup"><span data-stu-id="fea7c-122">Start the Steps Recorder, or another screen recorder.</span></span>
- <span data-ttu-id="fea7c-123">启动 Netmon 捕获 (或网络跟踪工具) 。</span><span class="sxs-lookup"><span data-stu-id="fea7c-123">Start your Netmon capture (or network tracing tool).</span></span>
- <span data-ttu-id="fea7c-124">通过键入 ipconfig /flushdns，从命令行清除客户端计算机上的 DNS 缓存。</span><span class="sxs-lookup"><span data-stu-id="fea7c-124">Clear your DNS cache on the client computer from the command line by typing ipconfig /flushdns.</span></span>
- <span data-ttu-id="fea7c-125">启动新的浏览器会话并打开 HTTPWatch。</span><span class="sxs-lookup"><span data-stu-id="fea7c-125">Start a new browser session and turn on HTTPWatch.</span></span>
- <span data-ttu-id="fea7c-126">可选：如果要测试Exchange Online，请从 Exchange 管理控制台运行 Office 365 Client Performance Analyzer 工具。</span><span class="sxs-lookup"><span data-stu-id="fea7c-126">Optional: If you are testing Exchange Online, run the Exchange Client Performance Analyzer tool from the Office 365 admin console.</span></span>
- <span data-ttu-id="fea7c-127">重现导致性能问题的确切步骤。</span><span class="sxs-lookup"><span data-stu-id="fea7c-127">Reproduce the exact steps that cause the performance issue.</span></span>
- <span data-ttu-id="fea7c-128">停止 Netmon 或其他工具的跟踪。</span><span class="sxs-lookup"><span data-stu-id="fea7c-128">Stop your Netmon or other tool's trace.</span></span>
- <span data-ttu-id="fea7c-129">在命令行中，键入以下命令，然后按 Enter，Office 365到您的订阅的跟踪路由：</span><span class="sxs-lookup"><span data-stu-id="fea7c-129">At the command line, run a trace route to your Office 365 subscription by typing the following command and then pressing ENTER:</span></span>

  ``` cmd
  tracert <subscriptionname>.onmicrosoft.com
  ```

- <span data-ttu-id="fea7c-130">停止步骤录制器并保存视频。</span><span class="sxs-lookup"><span data-stu-id="fea7c-130">Stop the Steps Recorder and save the video.</span></span> <span data-ttu-id="fea7c-131">请务必包括捕获的日期和时间，以及它是否能证明性能良好。</span><span class="sxs-lookup"><span data-stu-id="fea7c-131">Be sure to include the date and time of the capture and whether it demonstrates good or bad performance.</span></span>
- <span data-ttu-id="fea7c-132">保存跟踪文件。</span><span class="sxs-lookup"><span data-stu-id="fea7c-132">Save the trace files.</span></span> <span data-ttu-id="fea7c-133">同样，请务必包括捕获的日期和时间，以及它是否演示良好或坏的性能。</span><span class="sxs-lookup"><span data-stu-id="fea7c-133">Again, be sure to include the date and time of the capture and whether it demonstrates good or bad performance.</span></span>

<span data-ttu-id="fea7c-134">如果您不熟悉运行本文中提到的工具，请不要担心，因为我们接下来将提供这些步骤。</span><span class="sxs-lookup"><span data-stu-id="fea7c-134">If you're not familiar with running the tools mentioned in this article, don't worry because we provide those steps next.</span></span> <span data-ttu-id="fea7c-135">如果你习惯执行此类网络捕获，可以跳到如何收集基线 [，其中](performance-tuning-using-baselines-and-history.md#how-to-collect-baselines)介绍了筛选和读取日志。</span><span class="sxs-lookup"><span data-stu-id="fea7c-135">If you're accustomed to doing this kind of network capturing, you can skip to [How to collect baselines](performance-tuning-using-baselines-and-history.md#how-to-collect-baselines), which describes filtering and reading the logs.</span></span>

### <a name="flush-the-dns-cache-first"></a><span data-ttu-id="fea7c-136">首先刷新 DNS 缓存</span><span class="sxs-lookup"><span data-stu-id="fea7c-136">Flush the DNS Cache first</span></span>

<span data-ttu-id="fea7c-137">为什么？</span><span class="sxs-lookup"><span data-stu-id="fea7c-137">Why?</span></span> <span data-ttu-id="fea7c-138">通过刷新 DNS 缓存，你使用干净的平板电脑开始测试。</span><span class="sxs-lookup"><span data-stu-id="fea7c-138">By flushing out the DNS cache you're starting your tests with a clean slate.</span></span> <span data-ttu-id="fea7c-139">通过清除缓存，将 DNS 解析程序内容重置为最新条目。</span><span class="sxs-lookup"><span data-stu-id="fea7c-139">By clearing the cache, you're resetting the DNS resolver contents to the most up-to-date entries.</span></span> <span data-ttu-id="fea7c-140">请记住，刷新不会删除 HOSTs 文件条目。</span><span class="sxs-lookup"><span data-stu-id="fea7c-140">Remember that a flush does not remove HOSTs file entries.</span></span> <span data-ttu-id="fea7c-141">如果您大量使用 HOST 文件条目，则应该将那些条目复制到另一个目录中的文件中，然后清空 HOST 文件。</span><span class="sxs-lookup"><span data-stu-id="fea7c-141">If you use HOST file entries extensively, you should copy those entries out to a file in another directory and then empty the HOST file.</span></span>

#### <a name="flush-your-dns-resolver-cache"></a><span data-ttu-id="fea7c-142">刷新 DNS 解析程序缓存</span><span class="sxs-lookup"><span data-stu-id="fea7c-142">Flush your DNS resolver cache</span></span>

1. <span data-ttu-id="fea7c-143">打开命令提示符， ("开始运行 \>  \> **"cmd** 或Windows \> **cmd 键) 。**</span><span class="sxs-lookup"><span data-stu-id="fea7c-143">Open the command prompt, (either **Start** \> **Run** \> **cmd** or **Windows key** \> **cmd**).</span></span>
2. <span data-ttu-id="fea7c-144">键入下面的命令，并按 Enter：</span><span class="sxs-lookup"><span data-stu-id="fea7c-144">Type the following command and press ENTER:</span></span>

    ``` cmd
    ipconfig /flushdns
    ```

## <a name="netmon"></a><span data-ttu-id="fea7c-145">Netmon</span><span class="sxs-lookup"><span data-stu-id="fea7c-145">Netmon</span></span>

<span data-ttu-id="fea7c-146">Microsoft 的网络监控工具 ([Netmon](https://www.microsoft.com/download/details.aspx?id=4865)) 分析数据包（即网络上计算机之间传递的流量）。</span><span class="sxs-lookup"><span data-stu-id="fea7c-146">Microsoft's Network Monitoring tool ([Netmon](https://www.microsoft.com/download/details.aspx?id=4865)) analyzes packets, that is traffic, that passes between computers on networks.</span></span> <span data-ttu-id="fea7c-147">通过使用 Netmon 跟踪 Office 365可以捕获、查看和读取数据包头、标识中间设备、检查网络硬件上的重要设置、查找丢弃的数据包，以及跟踪企业网络中计算机和 Office 365 之间的流量。</span><span class="sxs-lookup"><span data-stu-id="fea7c-147">By using Netmon to trace traffic with Office 365 you can capture, view, and read packet headers, identify intervening devices, check important settings on network hardware, look for dropped packets, and follow the flow of traffic between computers on your corporate network and Office 365.</span></span> <span data-ttu-id="fea7c-148">由于流量的实际正文是加密的，即 (通过 SSL/TLS 在端口 443 上传输，因此无法读取要发送的文件。</span><span class="sxs-lookup"><span data-stu-id="fea7c-148">Because the actual body of the traffic is encrypted, that is, it(travels on port 443 via SSL/TLS, you can't read the files being sent.</span></span> <span data-ttu-id="fea7c-149">相反，您可以获取数据包采用的路径的未筛选跟踪，这可以帮助您跟踪问题行为。</span><span class="sxs-lookup"><span data-stu-id="fea7c-149">Instead, you get an unfiltered trace of the path that the packet takes which can help you track down the problem behavior.</span></span>

<span data-ttu-id="fea7c-150">请确保此时不应用筛选器。</span><span class="sxs-lookup"><span data-stu-id="fea7c-150">Be sure you don't apply a filter at this time.</span></span> <span data-ttu-id="fea7c-151">相反，请运行这些步骤并演示问题，然后再停止跟踪和保存。</span><span class="sxs-lookup"><span data-stu-id="fea7c-151">Instead, run through the steps and demonstrate the problem before stopping the trace and saving.</span></span>

<span data-ttu-id="fea7c-152">安装 Netmon 3.4 后，打开该工具，然后执行以下步骤：</span><span class="sxs-lookup"><span data-stu-id="fea7c-152">After you install Netmon 3.4, open the tool and take these steps:</span></span>

### <a name="take-a-netmon-trace-and-reproduce-the-issue"></a><span data-ttu-id="fea7c-153">进行 Netmon 跟踪并重现问题</span><span class="sxs-lookup"><span data-stu-id="fea7c-153">Take a Netmon trace and reproduce the issue</span></span>

1. <span data-ttu-id="fea7c-154">启动 Netmon 3.4。</span><span class="sxs-lookup"><span data-stu-id="fea7c-154">Launch Netmon 3.4.</span></span>
<span data-ttu-id="fea7c-155">"开始"页上有三个窗格 **：Recent Captures、Select** **Networks** 和 **Getting Started with Microsoft Network Monitor 3.4。请注意**。</span><span class="sxs-lookup"><span data-stu-id="fea7c-155">There are three panes on the **Start** page: **Recent Captures**, **Select Networks**, and the **Getting Started with Microsoft Network Monitor 3.4. Notice**.</span></span> <span data-ttu-id="fea7c-156">"选择网络"面板还将提供可以从中捕获的默认网络的列表。</span><span class="sxs-lookup"><span data-stu-id="fea7c-156">The Select Networks panel will also give you a list of the default networks from which you can capture.</span></span> <span data-ttu-id="fea7c-157">请确保在此处选择了网卡。</span><span class="sxs-lookup"><span data-stu-id="fea7c-157">Be sure that network cards are selected here.</span></span>

2. <span data-ttu-id="fea7c-158">单击 **起始页** 顶部的"新建 **捕获** "。</span><span class="sxs-lookup"><span data-stu-id="fea7c-158">Click **New Capture** at the top of the **Start** page.</span></span> <span data-ttu-id="fea7c-159">这会在"起始页"选项卡 **旁边添加** 名为 **"捕获 1"的新选项卡**。</span><span class="sxs-lookup"><span data-stu-id="fea7c-159">This adds a new tab beside the **Start** page tab called **Capture 1**.</span></span>
<span data-ttu-id="fea7c-160">![Netmon 的用户界面中突出显示了"新建捕获"、"开始"和"停止"按钮。](../media/d4527d84-62ec-4301-82d5-e0166ff71f20.PNG)</span><span class="sxs-lookup"><span data-stu-id="fea7c-160">![Netmon's user interface with the New Capture, Start, and Stop buttons highlighted.](../media/d4527d84-62ec-4301-82d5-e0166ff71f20.PNG)</span></span>

3. <span data-ttu-id="fea7c-161">若要获取简单的捕获 **，请单击工具栏** 上的"开始"。</span><span class="sxs-lookup"><span data-stu-id="fea7c-161">To take a simple capture, click **Start** on the toolbar.</span></span>

4. <span data-ttu-id="fea7c-162">重现出现性能问题的步骤。</span><span class="sxs-lookup"><span data-stu-id="fea7c-162">Reproduce the steps that present a performance issue.</span></span>

5. <span data-ttu-id="fea7c-163">单击 **"停止** \> **文件** \> **另存为"。**</span><span class="sxs-lookup"><span data-stu-id="fea7c-163">Click **Stop** \> **File** \> **Save As**.</span></span> <span data-ttu-id="fea7c-164">请记住将日期和时间与时区一起提供，并提及它是否演示了性能不佳或良好。</span><span class="sxs-lookup"><span data-stu-id="fea7c-164">Remember to give the date and time with the time zone and to mention if it demonstrates bad or good performance.</span></span>

## <a name="httpwatch"></a><span data-ttu-id="fea7c-165">HTTPWatch</span><span class="sxs-lookup"><span data-stu-id="fea7c-165">HTTPWatch</span></span>

<span data-ttu-id="fea7c-166">[HTTPWatch](https://www.httpwatch.com/download/) 提供收费和免费版本。</span><span class="sxs-lookup"><span data-stu-id="fea7c-166">[HTTPWatch](https://www.httpwatch.com/download/) comes in charged, and a free edition.</span></span> <span data-ttu-id="fea7c-167">免费的 Basic Edition 涵盖此测试所需的一切内容。</span><span class="sxs-lookup"><span data-stu-id="fea7c-167">The free Basic Edition covers everything you need for this test.</span></span> <span data-ttu-id="fea7c-168">HTTPWatch 从浏览器窗口监视网络流量和页面加载时间。</span><span class="sxs-lookup"><span data-stu-id="fea7c-168">HTTPWatch monitors network traffic and page load time right from your browser window.</span></span> <span data-ttu-id="fea7c-169">HTTPWatch 是一个插件，Internet Explorer以图形方式描述性能。</span><span class="sxs-lookup"><span data-stu-id="fea7c-169">HTTPWatch is a plug-in to Internet Explorer that graphically describes performance.</span></span> <span data-ttu-id="fea7c-170">分析可以在 HTTPWatch Studio 中保存和查看。</span><span class="sxs-lookup"><span data-stu-id="fea7c-170">The analysis can be saved and viewed in HTTPWatch Studio.</span></span>

> [!NOTE]
> <span data-ttu-id="fea7c-171">如果使用的是其他浏览器（如 Firefox、Google Chrome）或无法安装 Internet Explorer 中的 HTTPWatch，请打开一个新的浏览器窗口，然后按键盘上的 F12。</span><span class="sxs-lookup"><span data-stu-id="fea7c-171">If you use another browser, such as Firefox, Google Chrome, or if you can't install HTTPWatch in Internet Explorer, open a new browser window and press F12 on your keyboard.</span></span> <span data-ttu-id="fea7c-172">您应该在浏览器底部看到"开发人员工具"弹出窗口。</span><span class="sxs-lookup"><span data-stu-id="fea7c-172">You should see the Developer Tool pop-up at the bottom of your browser.</span></span> <span data-ttu-id="fea7c-173">如果使用 Opera，请按 Ctrl+Shift+I for Web Inspector，然后单击"网络"选项卡并完成下面列出的测试。</span><span class="sxs-lookup"><span data-stu-id="fea7c-173">If you use Opera, press CTRL+SHIFT+I for Web Inspector, then click the **Network** tab and complete the testing outlined below.</span></span> <span data-ttu-id="fea7c-174">该信息将略有不同，但加载时间仍将以毫秒为单位显示。</span><span class="sxs-lookup"><span data-stu-id="fea7c-174">The information will be slightly different, but load times will still be displayed in milliseconds.</span></span> <span data-ttu-id="fea7c-175">> HTTPWatch 对于联机页面加载SharePoint问题也非常有用。</span><span class="sxs-lookup"><span data-stu-id="fea7c-175">> HTTPWatch is also very useful for issues with SharePoint Online page load times.</span></span>

### <a name="run-httpwatch-and-reproduce-the-issue"></a><span data-ttu-id="fea7c-176">运行 HTTPWatch 并重现问题</span><span class="sxs-lookup"><span data-stu-id="fea7c-176">Run HTTPWatch and reproduce the issue</span></span>

<span data-ttu-id="fea7c-177">HTTPWatch 是一个浏览器插件，因此对于每个版本的浏览器，在浏览器中公开该工具Internet Explorer。</span><span class="sxs-lookup"><span data-stu-id="fea7c-177">HTTPWatch is a browser plug-in, so exposing the tool in the browser is slightly different for each version of Internet Explorer.</span></span> <span data-ttu-id="fea7c-178">通常，您可以在浏览器的"命令"栏下Internet Explorer HTTPWatch。</span><span class="sxs-lookup"><span data-stu-id="fea7c-178">Typically, you can find HTTPWatch under the Commands bar in the Internet Explorer browser.</span></span> <span data-ttu-id="fea7c-179">如果在浏览器窗口中看不到 HTTPWatch 插件，请通过单击"帮助""关于"来检查浏览器的版本，或在Internet Explorer 的更高版本中，单击齿轮符号和"关于 \> **Internet Explorer"。**</span><span class="sxs-lookup"><span data-stu-id="fea7c-179">If you don't see the HTTPWatch plug-in in your browser window, check the version of your browser by clicking **Help** \> **About**, or in later versions of Internet Explorer, click the gear symbol and **About Internet Explorer**.</span></span> <span data-ttu-id="fea7c-180">若要启动 **命令栏** ，请右键单击命令栏中Internet Explorer然后单击命令 **栏**。</span><span class="sxs-lookup"><span data-stu-id="fea7c-180">To launch the **Commands** bar, right-click the menu bar in Internet Explorer and click **Commands bar**.</span></span>

<span data-ttu-id="fea7c-181">过去，HTTPWatch 已与命令和资源管理器栏关联，因此安装后，如果未立即看到图标 (即使在重新启动) 后也看不到该图标，请检查"工具"和工具栏以查看图标。 </span><span class="sxs-lookup"><span data-stu-id="fea7c-181">In the past, HTTPWatch has been associated with both the Commands and the Explorer bars, so once you install, if you don't immediately see the icon (even after reboot) check **Tools**, and your toolbars for the icon.</span></span> <span data-ttu-id="fea7c-182">请记住，可以自定义工具栏，并可以添加选项。</span><span class="sxs-lookup"><span data-stu-id="fea7c-182">Remember that toolbars can be customized and options can be added to them.</span></span>

![Internet Explorer显示 HTTPWatch 图标的"命令"工具栏。](../media/198590b0-d7b1-4bff-a6ad-e4ec3a1e83df.png)

1. <span data-ttu-id="fea7c-184">在浏览器窗口中Internet Explorer HTTPWatch。</span><span class="sxs-lookup"><span data-stu-id="fea7c-184">Launch HTTPWatch in an Internet Explorer browser window.</span></span> <span data-ttu-id="fea7c-185">它将显示在该窗口底部的浏览器上。</span><span class="sxs-lookup"><span data-stu-id="fea7c-185">It will appear docked to the browser at the bottom of that window.</span></span> <span data-ttu-id="fea7c-186">单击"**记录"。**</span><span class="sxs-lookup"><span data-stu-id="fea7c-186">Click **Record**.</span></span>

2. <span data-ttu-id="fea7c-187">重现性能问题中涉及的确切步骤。</span><span class="sxs-lookup"><span data-stu-id="fea7c-187">Reproduce the exact steps involved in the performance issue.</span></span> <span data-ttu-id="fea7c-188">单击 HTTPWatch **中的"** 停止"按钮。</span><span class="sxs-lookup"><span data-stu-id="fea7c-188">Click the **Stop** button in HTTPWatch.</span></span>

3. <span data-ttu-id="fea7c-189">**保存** HTTPWatch 或 **通过电子邮件发送**。</span><span class="sxs-lookup"><span data-stu-id="fea7c-189">**Save** the HTTPWatch or **Send by Email**.</span></span> <span data-ttu-id="fea7c-190">请记住命名文件，以便它包含日期和时间信息，并指示 Watch 包含性能良好还是性能不佳的演示。</span><span class="sxs-lookup"><span data-stu-id="fea7c-190">Remember to name the file so that it includes date and time information and an indication of whether your Watch contains a demonstration of good or bad performance.</span></span>

![HTTPWatch，显示 Office 365 主页的页面加载的“网络”选项卡。](../media/021a2c64-d581-49fd-adf4-4c364f589d75.PNG)

<span data-ttu-id="fea7c-192">此屏幕截图来自 HTTPWatch Professional版本。</span><span class="sxs-lookup"><span data-stu-id="fea7c-192">This screen shot is from the Professional version of HTTPWatch.</span></span> <span data-ttu-id="fea7c-193">可以在具有最新版本的计算机上打开在基本版本中Professional跟踪，然后从该计算机上读取。</span><span class="sxs-lookup"><span data-stu-id="fea7c-193">You can open traces taken in the Basic Version on a computer with a Professional version and read it there.</span></span> <span data-ttu-id="fea7c-194">通过该方法，跟踪中可能会提供额外信息。</span><span class="sxs-lookup"><span data-stu-id="fea7c-194">Extra information may be available from the trace through that method.</span></span>

## <a name="problem-steps-recorder"></a><span data-ttu-id="fea7c-195">问题步骤记录器</span><span class="sxs-lookup"><span data-stu-id="fea7c-195">Problem Steps Recorder</span></span>

<span data-ttu-id="fea7c-196">步骤录制器PSR.exe记录器，允许您在问题发生时记录问题。</span><span class="sxs-lookup"><span data-stu-id="fea7c-196">Steps Recorder, or PSR.exe, allows you to record issues as they are occurring.</span></span> <span data-ttu-id="fea7c-197">这是一个非常有用的工具，并且运行起来非常简单。</span><span class="sxs-lookup"><span data-stu-id="fea7c-197">It's a very useful tool and very simple to run.</span></span>

### <a name="run-problem-steps-recorder-psrexe-to-record-your-work"></a><span data-ttu-id="fea7c-198">运行问题步骤记录 (PSR.exe) 录制器以记录你的工作</span><span class="sxs-lookup"><span data-stu-id="fea7c-198">Run Problem Steps Recorder (PSR.exe) to record your work</span></span>

1. <span data-ttu-id="fea7c-199">使用"**开始** \> **运行** \> "PSR.exe \> **确定"，** 或者，单击"Windows **键** \> 类型"PSR.exe \> 然后按 Enter。</span><span class="sxs-lookup"><span data-stu-id="fea7c-199">Either use **Start** \> **Run** \> type **PSR.exe** \> **OK**, or, click the **Windows Key** \> type **PSR.exe** \> and then press ENTER.</span></span>

2. <span data-ttu-id="fea7c-200">当小PSR.exe窗口出现时，单击"启动 **记录** "并重现重现性能问题的步骤。</span><span class="sxs-lookup"><span data-stu-id="fea7c-200">When the small PSR.exe window appears, click **Start Record** and reproduce the steps that reproduce the performance issue.</span></span> <span data-ttu-id="fea7c-201">您可通过单击"添加注释"根据需要 **添加注释**。</span><span class="sxs-lookup"><span data-stu-id="fea7c-201">You can add comments as needed, by clicking **Add Comments**.</span></span>

3. <span data-ttu-id="fea7c-202">完成 **这些步骤后** ，单击"停止记录"。</span><span class="sxs-lookup"><span data-stu-id="fea7c-202">Click **Stop Record** when you have completed the steps.</span></span> <span data-ttu-id="fea7c-203">如果性能问题是页面呈现，请等待页面呈现，然后再停止录制。</span><span class="sxs-lookup"><span data-stu-id="fea7c-203">If the performance issue is a page render, wait for the page to render before you stop the recording.</span></span>

4. <span data-ttu-id="fea7c-204">单击“保存”。</span><span class="sxs-lookup"><span data-stu-id="fea7c-204">Click **Save**.</span></span>

![步骤录制器或步骤录制器的PSR.exe。](../media/8542b0aa-a3ff-4718-8dc4-43f5521c6c34.PNG)

<span data-ttu-id="fea7c-206">将记录日期和时间。</span><span class="sxs-lookup"><span data-stu-id="fea7c-206">The date and time is recorded for you.</span></span> <span data-ttu-id="fea7c-207">这会将 PSR 实时链接到 Netmon 跟踪和 HTTPWatch，并帮助进行精确疑难解答。</span><span class="sxs-lookup"><span data-stu-id="fea7c-207">This links your PSR to your Netmon trace and HTTPWatch in time, and helps with precision troubleshooting.</span></span> <span data-ttu-id="fea7c-208">例如，PSR 记录中的日期和时间可以显示 URL 的登录和浏览与部分呈现之间传递的分钟数。</span><span class="sxs-lookup"><span data-stu-id="fea7c-208">The date and time in the PSR record can show that a minute passed between the login and browsing of the URL and the partial render of the admin site, for example.</span></span>

## <a name="read-your-traces"></a><span data-ttu-id="fea7c-209">读取跟踪</span><span class="sxs-lookup"><span data-stu-id="fea7c-209">Read your traces</span></span>

<span data-ttu-id="fea7c-210">无法通过文章来介绍有关网络和性能疑难解答的一切内容。</span><span class="sxs-lookup"><span data-stu-id="fea7c-210">It isn't possible to teach everything about network and performance troubleshooting that someone would need to know via an article.</span></span> <span data-ttu-id="fea7c-211">获得良好的性能需要经验，并且需要了解网络的工作方式和通常执行方式。</span><span class="sxs-lookup"><span data-stu-id="fea7c-211">Getting good at performance takes experience, and knowledge of how your network works and usually performs.</span></span> <span data-ttu-id="fea7c-212">但是，可以向上舍入主要问题列表，并说明工具如何更轻松地消除最常见的问题。</span><span class="sxs-lookup"><span data-stu-id="fea7c-212">But it is possible to round up a list of top issues and show how tools can make it easier for you to eliminate the most common problems.</span></span>

<span data-ttu-id="fea7c-213">如果你想要获得读取 Office 365 网站网络跟踪的技能，没有比定期创建页面加载跟踪并获取读取这些跟踪的经验更好的教师。</span><span class="sxs-lookup"><span data-stu-id="fea7c-213">If you want to pick up skills reading network traces for your Office 365 sites, there is no better teacher than creating traces of page loads regularly and gaining experience reading them.</span></span> <span data-ttu-id="fea7c-214">例如，当您有机会时，加载一个 Office 365 服务并跟踪该过程。</span><span class="sxs-lookup"><span data-stu-id="fea7c-214">For example, when you have a chance, load an Office 365 service and trace the process.</span></span> <span data-ttu-id="fea7c-215">筛选 DNS 流量的跟踪，或搜索 FrameData 以查找您浏览的服务的名称。</span><span class="sxs-lookup"><span data-stu-id="fea7c-215">Filter the trace for DNS traffic, or search the FrameData for the name of the service you browsed.</span></span> <span data-ttu-id="fea7c-216">扫描跟踪，了解服务加载时发生的步骤。</span><span class="sxs-lookup"><span data-stu-id="fea7c-216">Scan the trace to get an idea of the steps that occur when the service loads.</span></span> <span data-ttu-id="fea7c-217">这将帮助你了解正常页面负载应该是什么样，在疑难解答的情况下，尤其是关于性能的情况下，将好与坏的跟踪进行比较可以告诉你很多。</span><span class="sxs-lookup"><span data-stu-id="fea7c-217">This will help you learn what normal page load should look like, and in the case of troubleshooting, particularly around performance, comparing good to bad traces can teach you a lot.</span></span>

<span data-ttu-id="fea7c-218">Netmon 在"显示筛选器"字段中使用 Microsoft Intellisense。</span><span class="sxs-lookup"><span data-stu-id="fea7c-218">Netmon uses Microsoft Intellisense in the Display filter field.</span></span> <span data-ttu-id="fea7c-219">智能感知（或智能代码完成）就是一个技巧，即你在一段时间的键入位置，所有可用选项都显示在下拉选择框中。</span><span class="sxs-lookup"><span data-stu-id="fea7c-219">Intellisense, or intelligent code completion, is that trick where you type in a period and all available options are displayed in a drop-down selection box.</span></span> <span data-ttu-id="fea7c-220">例如，如果您担心 TCP 窗口缩放，您可以通过此方式找到 (筛选器，)  `.protocol.tcp.window < 100` 扩展。</span><span class="sxs-lookup"><span data-stu-id="fea7c-220">If, for example, you are worried about TCP window scaling, you can find your way to a filter (such as  `.protocol.tcp.window < 100`) by this means.</span></span>

![显示"显示筛选器"字段使用智能感知的 Netmon 屏幕截图。](../media/75a56c11-9a60-47ee-a100-aabdfb1ba10f.PNG)

<span data-ttu-id="fea7c-222">Netmon 跟踪中可能有很多流量。</span><span class="sxs-lookup"><span data-stu-id="fea7c-222">Netmon traces can have a lot of traffic in them.</span></span> <span data-ttu-id="fea7c-223">如果你没有阅读它们经验，那么第一次打开跟踪时可能会感到不知所措。</span><span class="sxs-lookup"><span data-stu-id="fea7c-223">If you aren't experienced with reading them, it's likely you will be overwhelmed opening the trace the first time.</span></span> <span data-ttu-id="fea7c-224">首先要执行以下操作：将信号与跟踪中的背景噪音分开。</span><span class="sxs-lookup"><span data-stu-id="fea7c-224">The first thing to do is separate the signal from the background noise in the trace.</span></span> <span data-ttu-id="fea7c-225">你针对Office 365进行了测试，这就是你想要查看的流量。</span><span class="sxs-lookup"><span data-stu-id="fea7c-225">You tested against Office 365, and that's the traffic you want to see.</span></span> <span data-ttu-id="fea7c-226">如果您习惯在跟踪中导航，则您可能不需要此列表。</span><span class="sxs-lookup"><span data-stu-id="fea7c-226">If you are used to navigating through traces, you may not need this list.</span></span>

<span data-ttu-id="fea7c-227">客户端和客户端Office 365流量通过 TLS 传输，这意味着通信正文将在常规 Netmon 跟踪中加密且不可读取。</span><span class="sxs-lookup"><span data-stu-id="fea7c-227">Traffic between your client and Office 365 travels via TLS, which means that the body of the traffic will be encrypted and not readable in a generic Netmon trace.</span></span> <span data-ttu-id="fea7c-228">性能分析不需要知道数据包中信息的具体信息。</span><span class="sxs-lookup"><span data-stu-id="fea7c-228">Your performance analysis doesn't need to know the specifics of the information in the packet.</span></span> <span data-ttu-id="fea7c-229">但是，它非常关注数据包头及其包含的信息。</span><span class="sxs-lookup"><span data-stu-id="fea7c-229">It is, however, very interested in packet headers and the information that they contain.</span></span>

### <a name="tips-to-get-a-good-trace"></a><span data-ttu-id="fea7c-230">使用技巧一个很好的跟踪</span><span class="sxs-lookup"><span data-stu-id="fea7c-230">Tips to get a good trace</span></span>

- <span data-ttu-id="fea7c-231">了解客户端计算机的 IPv4 或 IPv6 地址的值。</span><span class="sxs-lookup"><span data-stu-id="fea7c-231">Know the value of the IPv4 or IPv6 address of your client computer.</span></span> <span data-ttu-id="fea7c-232">可以通过键入 **IPConfig** 然后按 Enter 从命令提示符获取此参数。</span><span class="sxs-lookup"><span data-stu-id="fea7c-232">You can get this from the command prompt by typing **IPConfig** and then pressing ENTER.</span></span> <span data-ttu-id="fea7c-233">通过了解此地址，您可以一目了然地判断跟踪中的流量是否直接涉及客户端计算机。</span><span class="sxs-lookup"><span data-stu-id="fea7c-233">Knowing this address will let you tell at a glance whether the traffic in the trace directly involves your client computer.</span></span> <span data-ttu-id="fea7c-234">如果存在已知代理，则 Ping 它并获取其 IP 地址。</span><span class="sxs-lookup"><span data-stu-id="fea7c-234">If there is a known proxy, ping it and get its IP address as well.</span></span>

- <span data-ttu-id="fea7c-235">刷新 DNS 解析程序缓存，如果可能，请关闭除运行测试的浏览器之外的所有浏览器。</span><span class="sxs-lookup"><span data-stu-id="fea7c-235">Flush your DNS resolver cache and, if possible, close all browsers except the one in which you are running your tests.</span></span> <span data-ttu-id="fea7c-236">例如，如果不支持使用某些基于浏览器的工具查看客户端计算机的桌面，请准备好筛选跟踪。</span><span class="sxs-lookup"><span data-stu-id="fea7c-236">If you are not able to do this, for instance, if support is using some browser-based tool to see your client computer's desktop, be prepared to filter your trace.</span></span>

- <span data-ttu-id="fea7c-237">在繁忙跟踪中，找到Office 365服务。</span><span class="sxs-lookup"><span data-stu-id="fea7c-237">In a busy trace, locate the Office 365 service that you're using.</span></span> <span data-ttu-id="fea7c-238">如果你之前从未或很少看到流量，这是将性能问题与其他网络干扰区分开的有用步骤。</span><span class="sxs-lookup"><span data-stu-id="fea7c-238">If you've never or seldom seen your traffic before, this is a helpful step in separating the performance issue from other network noise.</span></span> <span data-ttu-id="fea7c-239">有一些方法可以执行这一点。</span><span class="sxs-lookup"><span data-stu-id="fea7c-239">There are a few ways to do this.</span></span> <span data-ttu-id="fea7c-240">在测试之前，您可以直接对特定服务的 URL 使用 _ping_ 或 _PsPing_ `ping outlook.office365.com` (，例如 `psping -4 microsoft-my.sharepoint.com:443` ，) 。</span><span class="sxs-lookup"><span data-stu-id="fea7c-240">Directly before your test, you can use _ping_ or _PsPing_ against the URL of the specific service (`ping outlook.office365.com` or `psping -4 microsoft-my.sharepoint.com:443`, for example).</span></span> <span data-ttu-id="fea7c-241">您还可以轻松找到 Netmon 跟踪中的 ping 或 PsPing (其进程名称) 。</span><span class="sxs-lookup"><span data-stu-id="fea7c-241">You can also easily find that ping or PsPing in a Netmon trace (by its process name).</span></span> <span data-ttu-id="fea7c-242">这将为您提供开始查找的位置。</span><span class="sxs-lookup"><span data-stu-id="fea7c-242">That will give you a place to start looking.</span></span>

<span data-ttu-id="fea7c-243">如果您在出现问题时仅使用 Netmon 跟踪，也无用事。</span><span class="sxs-lookup"><span data-stu-id="fea7c-243">If you're only using Netmon tracing at the time of the problem, that's okay too.</span></span> <span data-ttu-id="fea7c-244">若要引导自己，请使用类似 或 `ContainsBin(FrameData, ASCII, "office")` 的筛选器 `ContainsBin(FrameData, ASCII, "outlook")` 。</span><span class="sxs-lookup"><span data-stu-id="fea7c-244">To orient yourself, use a filter like `ContainsBin(FrameData, ASCII, "office")` or `ContainsBin(FrameData, ASCII, "outlook")`.</span></span> <span data-ttu-id="fea7c-245">可以从跟踪文件记录帧编号。</span><span class="sxs-lookup"><span data-stu-id="fea7c-245">You can record your frame number from the trace file.</span></span> <span data-ttu-id="fea7c-246">您可能还想一路向右滚动"框架摘要"窗格并查找"对话 ID"列。</span><span class="sxs-lookup"><span data-stu-id="fea7c-246">You may also want to scroll the _Frame Summary_ pane all the way to the right and look for the Conversation ID column.</span></span> <span data-ttu-id="fea7c-247">有一个数字指示了此特定对话的 ID，稍后还可以单独记录和查看。</span><span class="sxs-lookup"><span data-stu-id="fea7c-247">There is a number indicated there for the ID of this specific conversation that you can also record and look at in isolation later.</span></span> <span data-ttu-id="fea7c-248">在应用任何其他筛选之前，请记住删除此筛选器。</span><span class="sxs-lookup"><span data-stu-id="fea7c-248">Remember to remove this filter before applying any other filtering.</span></span>

> [!TIP]
> <span data-ttu-id="fea7c-249">Netmon 有很多有用的内置筛选器。</span><span class="sxs-lookup"><span data-stu-id="fea7c-249">Netmon has a lot of helpful built-in filters.</span></span> <span data-ttu-id="fea7c-250">尝试" **显示筛选器** "窗格顶部的"加载筛选器 _"_ 按钮。</span><span class="sxs-lookup"><span data-stu-id="fea7c-250">Try the **Load Filter** button at the top of the _Display_ filter pane.</span></span>

![在客户端计算机上的命令行使用 PSPing 查找 IP。](../media/4c43ac67-e28e-4536-842d-7add7aa28847.PNG)

![来自客户端的 Netmon 跟踪，通过筛选器 TCP 显示相同的 PSPing 命令。Flags.Syn == 1。](../media/0ae7ef7d-e003-4d01-a006-dc49bd1fcef2.PNG)

<span data-ttu-id="fea7c-253&quot;>熟悉流量，并了解如何查找所需的信息。</span><span class=&quot;sxs-lookup&quot;><span data-stu-id=&quot;fea7c-253&quot;>Get familiar with your traffic, and learn to locate the information you need.</span></span> <span data-ttu-id=&quot;fea7c-254&quot;>例如，了解如何确定跟踪中的哪个数据包具有对 Office 365 服务的首次引用，例如 (&quot;Outlook") 。</span><span class="sxs-lookup"><span data-stu-id="fea7c-254">For example, learn to determine which packet in the trace has the first reference to the Office 365 service you're using (like "Outlook").</span></span>

<span data-ttu-id="fea7c-255">以 Office 365 Outlook Online 为例，流量开始如下所示：</span><span class="sxs-lookup"><span data-stu-id="fea7c-255">Taking Office 365 Outlook Online as an example, the traffic begins something like this:</span></span>

- <span data-ttu-id="fea7c-256">具有匹配 QueryID outlook.office365.com DNS 标准查询和 DNS 响应。</span><span class="sxs-lookup"><span data-stu-id="fea7c-256">DNS Standard Query and DNS Response for outlook.office365.com with matching QueryIDs.</span></span> <span data-ttu-id="fea7c-257">必须注意此转网的时间偏移量，以及全局 DNS Office 365发送名称解析请求的世界位置。</span><span class="sxs-lookup"><span data-stu-id="fea7c-257">It's important to note the time offset for this turn-around, as well as where in the world the Office 365 Global DNS sends the request for name resolution.</span></span> <span data-ttu-id="fea7c-258">理想情况下，尽可能在本地，而不是全球的一半。</span><span class="sxs-lookup"><span data-stu-id="fea7c-258">Ideally, as locally as possible, rather than halfway across the world.</span></span>

- <span data-ttu-id="fea7c-259">其状态报告已永久移动到 301 (HTTP GET) </span><span class="sxs-lookup"><span data-stu-id="fea7c-259">A HTTP GET Request whose status report Moved Permanently (301)</span></span>

- <span data-ttu-id="fea7c-260">RWS 流量，包括 RWS 连接请求连接回复。</span><span class="sxs-lookup"><span data-stu-id="fea7c-260">RWS Traffic including RWS Connect requests and Connect replies.</span></span> <span data-ttu-id="fea7c-261"> (这是远程 Winsock，可进行连接。) </span><span class="sxs-lookup"><span data-stu-id="fea7c-261">(This is Remote Winsock making a connection for you.)</span></span>

- <span data-ttu-id="fea7c-262">TCP SYN 和 TCP SYN/ACK 对话。</span><span class="sxs-lookup"><span data-stu-id="fea7c-262">A TCP SYN and TCP SYN/ACK conversation.</span></span> <span data-ttu-id="fea7c-263">此对话中的许多设置会影响性能。</span><span class="sxs-lookup"><span data-stu-id="fea7c-263">A lot of the settings in this conversation impact your performance.</span></span>

- <span data-ttu-id="fea7c-264">然后，发生 TLS 握手和 TLS 证书对话的一系列 TLS：TLS 流量。</span><span class="sxs-lookup"><span data-stu-id="fea7c-264">Then a series of TLS:TLS traffic which is where the TLS handshake and TLS certificate conversations take place.</span></span> <span data-ttu-id="fea7c-265"> (记住数据是通过 SSL/TLS.) </span><span class="sxs-lookup"><span data-stu-id="fea7c-265">(Remember the data is encrypted via SSL/TLS.)</span></span>

<span data-ttu-id="fea7c-266">流量的所有部分都很重要且已连接，但跟踪的一小部分包含对于性能疑难解答特别重要的信息，因此我们将重点介绍这些方面。</span><span class="sxs-lookup"><span data-stu-id="fea7c-266">All parts of the traffic are important and connected, but small portions of the trace contain information particularly important in terms of performance troubleshooting, so we'll focus on those areas.</span></span> <span data-ttu-id="fea7c-267">此外，由于我们已在 Microsoft 中执行Office 365性能疑难解答来编译常见问题的十大列表，我们将重点介绍这些问题，以及如何使用下一步必须解决的问题。</span><span class="sxs-lookup"><span data-stu-id="fea7c-267">Also, since we've done enough Office 365 performance troubleshooting at Microsoft to compile a Top Ten list of common problems, we'll focus on those issues and how to use the tools we have to root them out next.</span></span>

<span data-ttu-id="fea7c-268">如果你尚未全部安装它们，下面的矩阵将利用多种工具。</span><span class="sxs-lookup"><span data-stu-id="fea7c-268">If you haven't installed them all ready, the matrix below makes use of several tools.</span></span> <span data-ttu-id="fea7c-269">如果可能。</span><span class="sxs-lookup"><span data-stu-id="fea7c-269">Where possible.</span></span> <span data-ttu-id="fea7c-270">提供了指向安装点的链接。</span><span class="sxs-lookup"><span data-stu-id="fea7c-270">Links are provided to the installation points.</span></span> <span data-ttu-id="fea7c-271">该列表包括常见的网络跟踪工具（如 [Netmon](https://www.microsoft.com/download/details.aspx?id=4865) 和 [Wireshark），](https://www.wireshark.org/)但可使用您习惯以及您习惯筛选网络流量的任何跟踪工具。</span><span class="sxs-lookup"><span data-stu-id="fea7c-271">The list includes common network tracing tools like [Netmon](https://www.microsoft.com/download/details.aspx?id=4865) and [Wireshark](https://www.wireshark.org/), but use any tracing tool you are comfortable with, and in which you're accustomed to filtering network traffic.</span></span> <span data-ttu-id="fea7c-272">在测试时，请记住：</span><span class="sxs-lookup"><span data-stu-id="fea7c-272">When you're testing, remember:</span></span>

- <span data-ttu-id="fea7c-273">*关闭浏览器，并仅运行一个浏览器进行测试*  - 这将减少捕获的总流量。</span><span class="sxs-lookup"><span data-stu-id="fea7c-273">*Close your browsers, and test with only one browser running*  - This will reduce the overall traffic you capture.</span></span> <span data-ttu-id="fea7c-274">它使跟踪变得不太忙。</span><span class="sxs-lookup"><span data-stu-id="fea7c-274">It makes for a less busy trace.</span></span>
- <span data-ttu-id="fea7c-275">*刷新客户端计算机*  上的 DNS 解析程序缓存 - 这会在您开始捕获时为您提供一个干净的平板电脑，以更简洁的跟踪。</span><span class="sxs-lookup"><span data-stu-id="fea7c-275">*Flush your DNS resolver cache on the client computer*  - This will give you a clean slate when you start to take your capture, for a cleaner trace.</span></span>

## <a name="common-issues"></a><span data-ttu-id="fea7c-276">常见问题</span><span class="sxs-lookup"><span data-stu-id="fea7c-276">Common issues</span></span>

<span data-ttu-id="fea7c-277">你可能面临的一些常见问题以及如何在网络跟踪中查找它们。</span><span class="sxs-lookup"><span data-stu-id="fea7c-277">Some common issues you may face and how to find them in your Network trace.</span></span>

### <a name="tcp-windows-scaling"></a><span data-ttu-id="fea7c-278">TCP Windows缩放</span><span class="sxs-lookup"><span data-stu-id="fea7c-278">TCP Windows Scaling</span></span>

<span data-ttu-id="fea7c-279">在 SYN - SYN/ACK 中找到。</span><span class="sxs-lookup"><span data-stu-id="fea7c-279">Found in the SYN - SYN/ACK.</span></span> <span data-ttu-id="fea7c-280">旧版或旧式硬件可能不会利用 TCP 窗口缩放。</span><span class="sxs-lookup"><span data-stu-id="fea7c-280">Legacy or aging hardware may not take advantage of TCP windows scaling.</span></span>  <span data-ttu-id="fea7c-281">如果没有正确的 TCP 窗口缩放设置，TCP 标头中的默认 16 位缓冲区将填充以毫秒为单位。</span><span class="sxs-lookup"><span data-stu-id="fea7c-281">Without proper TCP windows scaling settings, the default 16-bit buffer in TCP headers fills in milliseconds.</span></span>  <span data-ttu-id="fea7c-282">在客户端收到已收到原始数据的确认信息之前，通信无法继续发送，从而导致延迟。</span><span class="sxs-lookup"><span data-stu-id="fea7c-282">Traffic cannot continue to send until the client receives an acknowledgment that the original data has been received, causing delays.</span></span>

#### <a name="tools"></a><span data-ttu-id="fea7c-283">工具</span><span class="sxs-lookup"><span data-stu-id="fea7c-283">Tools</span></span>

- <span data-ttu-id="fea7c-284">Netmon</span><span class="sxs-lookup"><span data-stu-id="fea7c-284">Netmon</span></span>
- <span data-ttu-id="fea7c-285">Wireshark</span><span class="sxs-lookup"><span data-stu-id="fea7c-285">Wireshark</span></span>

#### <a name="what-to-look-for"></a><span data-ttu-id="fea7c-286">要查找什么</span><span class="sxs-lookup"><span data-stu-id="fea7c-286">What to look for</span></span>

<span data-ttu-id="fea7c-287">查找网络跟踪中的 SYN - SYN/ACK 流量。</span><span class="sxs-lookup"><span data-stu-id="fea7c-287">Look for the SYN - SYN/ACK traffic in your network trace.</span></span>  <span data-ttu-id="fea7c-288">在 Netmon 中，使用类似 的筛选器  `tcp.flags.syn == 1` 。</span><span class="sxs-lookup"><span data-stu-id="fea7c-288">In Netmon, use a filter like  `tcp.flags.syn == 1`.</span></span> <span data-ttu-id="fea7c-289">此筛选器在 Wireshark 中相同。</span><span class="sxs-lookup"><span data-stu-id="fea7c-289">This filter is the same in Wireshark.</span></span>

![在 Netmon 或 Wireshark 中筛选这两种工具的 Syn 数据包：TCP。Flags.Syn == 1。](../media/4b9a12a1-c915-43c8-ac2f-a679d0435a29.PNG)

<span data-ttu-id="fea7c-291">请注意，每个 SYN 都有一个源端口 (SrcPort) 号码，该号码在相关 Acknowledgment (SYN/ACK) 的目标端口 (DstPort) 中匹配。</span><span class="sxs-lookup"><span data-stu-id="fea7c-291">Notice that for every SYN there is a source port (SrcPort) number that is matched in the destination port (DstPort) of the related Acknowledgment (SYN/ACK).</span></span>

<span data-ttu-id="fea7c-292">To see the Windows Scaling value that is used by your network connection， expand first the SYN， and then the related SYN/ACK.</span><span class="sxs-lookup"><span data-stu-id="fea7c-292">To see the Windows Scaling value that is used by your network connection, expand first the SYN, and then the related SYN/ACK.</span></span>

![显示如何匹配跟踪中的 SrcPort 与 DstPort 以获得时间增量的图形。](../media/6a4ca573-0253-4fbd-93e8-92821ee1c351.png)

### <a name="tcp-idle-time-settings"></a><span data-ttu-id="fea7c-294">TCP 空闲时间设置</span><span class="sxs-lookup"><span data-stu-id="fea7c-294">TCP Idle Time Settings</span></span>

<span data-ttu-id="fea7c-295">过去，大多数外围网络都配置为使用瞬态连接，这意味着空闲连接通常会终止。</span><span class="sxs-lookup"><span data-stu-id="fea7c-295">Historically, most perimeter networks are configured for transient connections, meaning idle connections are generally terminated.</span></span> <span data-ttu-id="fea7c-296">空闲 TCP 会话可以在大于 100 秒到 300 秒时由代理和防火墙终止。</span><span class="sxs-lookup"><span data-stu-id="fea7c-296">Idle TCP sessions can be terminated by proxies and firewalls at greater than 100 to 300 seconds.</span></span> <span data-ttu-id="fea7c-297">这对于 Outlook是存在问题的，因为它会创建并使用长期连接，无论连接是否空闲。</span><span class="sxs-lookup"><span data-stu-id="fea7c-297">This is problematic for Outlook Online because it creates and uses long-term connections, whether they are idle or not.</span></span>

<span data-ttu-id="fea7c-298">当连接被代理或防火墙设备终止时，客户端不会得到通知，尝试使用 Outlook Online 意味着客户端计算机将反复尝试在新建连接之前破坏连接。</span><span class="sxs-lookup"><span data-stu-id="fea7c-298">When connections are terminated by proxy or firewall devices, the client is not informed, and an attempt to use Outlook Online will mean a client computer will try, repeatedly, to revive the connection before making a new one.</span></span> <span data-ttu-id="fea7c-299">您可能会在页面加载时看到产品挂起、提示或性能变慢。</span><span class="sxs-lookup"><span data-stu-id="fea7c-299">You may see hangs in the product, prompts, or slow performance on page load.</span></span>

#### <a name="tools"></a><span data-ttu-id="fea7c-300">工具</span><span class="sxs-lookup"><span data-stu-id="fea7c-300">Tools</span></span>

- <span data-ttu-id="fea7c-301">Netmon</span><span class="sxs-lookup"><span data-stu-id="fea7c-301">Netmon</span></span>
- <span data-ttu-id="fea7c-302">Wireshark</span><span class="sxs-lookup"><span data-stu-id="fea7c-302">Wireshark</span></span>

#### <a name="what-to-look-for"></a><span data-ttu-id="fea7c-303">要查找什么</span><span class="sxs-lookup"><span data-stu-id="fea7c-303">What to look for</span></span>

<span data-ttu-id="fea7c-304">在 Netmon 中，查看"时间偏移"字段进行往返。</span><span class="sxs-lookup"><span data-stu-id="fea7c-304">In Netmon, look at the Time Offset field for a round-trip.</span></span> <span data-ttu-id="fea7c-305">往返行程是客户端向服务器发送请求和收到回信之间的时间。</span><span class="sxs-lookup"><span data-stu-id="fea7c-305">A round-trip is the time between client sending a request to the server and receiving a response back.</span></span> <span data-ttu-id="fea7c-306">在客户端和出口点之间检查 (点。</span><span class="sxs-lookup"><span data-stu-id="fea7c-306">Check between the Client and the egress point (ex.</span></span> <span data-ttu-id="fea7c-307">客户端 -- \> 代理) 或客户端到 Office 365 (客户端 -- \> Office 365) 。</span><span class="sxs-lookup"><span data-stu-id="fea7c-307">Client --\> Proxy), or the Client to Office 365 (Client --\> Office 365).</span></span> <span data-ttu-id="fea7c-308">您可以在许多类型的数据包中查看此内容。</span><span class="sxs-lookup"><span data-stu-id="fea7c-308">You can see this in many types of packets.</span></span>

<span data-ttu-id="fea7c-309">例如，Netmon 中的筛选器可能看起来像 ，  `.Protocol.IPv4.Address == 10.102.14.112 AND .Protocol.IPv4.Address == 10.201.114.12` 或者，在 Wireshark 中  `ip.addr == 10.102.14.112 &amp;&amp; ip.addr == 10.201.114.12` 。</span><span class="sxs-lookup"><span data-stu-id="fea7c-309">As an example, the filter in Netmon may look like  `.Protocol.IPv4.Address == 10.102.14.112 AND .Protocol.IPv4.Address == 10.201.114.12`, or, in Wireshark,  `ip.addr == 10.102.14.112 &amp;&amp; ip.addr == 10.201.114.12`.</span></span>

> [!TIP]
> <span data-ttu-id="fea7c-310">不知道跟踪中的 IP 地址是否属于 DNS 服务器？</span><span class="sxs-lookup"><span data-stu-id="fea7c-310">Don't know if the IP address in your trace belongs to your DNS server?</span></span> <span data-ttu-id="fea7c-311">请尝试在命令行中查找它。</span><span class="sxs-lookup"><span data-stu-id="fea7c-311">Try looking it up at the command line.</span></span> <span data-ttu-id="fea7c-312">单击 **"** \> **开始运行** \> "并键入 **cmd，** 或按 **Windows 键** \> 并键入 **cmd**。</span><span class="sxs-lookup"><span data-stu-id="fea7c-312">Click **Start** \> **Run** \> and type **cmd**, or press **Windows Key** \> and type **cmd**.</span></span> <span data-ttu-id="fea7c-313">在提示符下，键入  `nslookup <the IP address from the network trace>` 。</span><span class="sxs-lookup"><span data-stu-id="fea7c-313">At the prompt, type  `nslookup <the IP address from the network trace>`.</span></span> <span data-ttu-id="fea7c-314">若要进行测试，请针对您自己的计算机的 IP 地址使用 nslookup。</span><span class="sxs-lookup"><span data-stu-id="fea7c-314">To test, use nslookup against your own computer's IP address.</span></span> <span data-ttu-id="fea7c-315">>查看 Microsoft 的 IP 范围列表，请参阅Office 365 [URL 和 IP 地址范围](./urls-and-ip-address-ranges.md)。</span><span class="sxs-lookup"><span data-stu-id="fea7c-315">> To see a list of Microsoft's IP ranges, see [Office 365 URLs and IP address ranges](./urls-and-ip-address-ranges.md).</span></span>

<span data-ttu-id="fea7c-316">如果出现问题，预计会出现长时间偏移，在此例中为 (Outlook Online) ，尤其是在显示应用程序数据 (的传输的 TLS：TLS 数据包中，例如，在 Netmon 中，可以通过) 查找 `.Protocol.TLS AND Description == "TLS:TLS Rec Layer-1 SSL Application Data"` 应用程序数据包。</span><span class="sxs-lookup"><span data-stu-id="fea7c-316">If there is a problem, expect long Time Offsets to appear, in this case (Outlook Online), particularly in TLS:TLS packets that show the passage of Application Data (for example, in Netmon you can find application data packets via  `.Protocol.TLS AND Description == "TLS:TLS Rec Layer-1 SSL Application Data"`).</span></span> <span data-ttu-id="fea7c-317">在会话期间，你应该会看到一个平稳的进度。</span><span class="sxs-lookup"><span data-stu-id="fea7c-317">You should see a smooth progression in the time across the session.</span></span> <span data-ttu-id="fea7c-318">如果在刷新 Outlook Online 时看到长时间延迟，这可能是由发送的高级别重置导致的。</span><span class="sxs-lookup"><span data-stu-id="fea7c-318">If you see long delays when refreshing your Outlook Online, this could be caused by a high degree of resets being sent.</span></span>

### <a name="latencyround-trip-time"></a><span data-ttu-id="fea7c-319">延迟/往返时间</span><span class="sxs-lookup"><span data-stu-id="fea7c-319">Latency/Round Trip Time</span></span>

<span data-ttu-id="fea7c-320">延迟是一种度量方式，根据许多变量（例如升级分页设备、向网络添加大量用户以及网络连接上的其他任务使用的总带宽百分比）可能会更改很多。</span><span class="sxs-lookup"><span data-stu-id="fea7c-320">Latency is a measure that can change a lot depending on many variables, such upgrading aging devices, adding a large number of users to a network, and the percentage of overall bandwidth consumed by other tasks on a network connection.</span></span>

<span data-ttu-id="fea7c-321">此"网络规划和性能[Office 365"](network-planning-and-performance.md)页中提供了适用于 Office 365 的带宽计算器。</span><span class="sxs-lookup"><span data-stu-id="fea7c-321">There are bandwidth calculators for Office 365 available from this [Network planning and performance tuning for Office 365](network-planning-and-performance.md) page.</span></span>

<span data-ttu-id="fea7c-322">是否需要测量连接速度或 ISP 连接的带宽？</span><span class="sxs-lookup"><span data-stu-id="fea7c-322">Need to measure the speed of your connection, or your ISP connection's bandwidth?</span></span> <span data-ttu-id="fea7c-323">尝试此 (或类似它的站点 [) ：Speedtest Official Site](https://www.speedtest.net/)，或查询你最喜爱的搜索引擎，以查找短语 **"speed test"。**</span><span class="sxs-lookup"><span data-stu-id="fea7c-323">Try this site (or sites like it): [Speedtest Official Site](https://www.speedtest.net/), or query your favorite search engine for the phrase **speed test**.</span></span>

#### <a name="tools"></a><span data-ttu-id="fea7c-324">工具</span><span class="sxs-lookup"><span data-stu-id="fea7c-324">Tools</span></span>

- <span data-ttu-id="fea7c-325">Ping</span><span class="sxs-lookup"><span data-stu-id="fea7c-325">Ping</span></span>
- <span data-ttu-id="fea7c-326">PsPing</span><span class="sxs-lookup"><span data-stu-id="fea7c-326">PsPing</span></span>
- <span data-ttu-id="fea7c-327">Netmon</span><span class="sxs-lookup"><span data-stu-id="fea7c-327">Netmon</span></span>
- <span data-ttu-id="fea7c-328">Wireshark</span><span class="sxs-lookup"><span data-stu-id="fea7c-328">Wireshark</span></span>

#### <a name="what-to-look-for"></a><span data-ttu-id="fea7c-329">要查找什么</span><span class="sxs-lookup"><span data-stu-id="fea7c-329">What to look for</span></span>

<span data-ttu-id="fea7c-330">若要跟踪跟踪中的延迟，您将受益于在跟踪中记录客户端计算机 IP 地址和 DNS 服务器的 IP Office 365。</span><span class="sxs-lookup"><span data-stu-id="fea7c-330">To track latency in a trace, you will benefit from having recorded the client computer IP address and the IP address of the DNS server in Office 365.</span></span> <span data-ttu-id="fea7c-331">这是为了简化跟踪筛选。</span><span class="sxs-lookup"><span data-stu-id="fea7c-331">This is for the purpose of easier trace filtering.</span></span> <span data-ttu-id="fea7c-332">如果通过代理连接，则需要客户端计算机 IP 地址、代理/出口 IP 地址和 Office 365 DNS IP 地址，以便更轻松地工作。</span><span class="sxs-lookup"><span data-stu-id="fea7c-332">If you connect through a proxy, you will need your client computer IP address, the proxy/egress IP address, and the Office 365 DNS IP address, to make the work easier.</span></span>

<span data-ttu-id="fea7c-333">发送到 outlook.office365.com ping 请求将告知您接收请求的数据中心的名称，即使  *ping*  可能无法连接以发送连续的商标 ICMP 数据包。</span><span class="sxs-lookup"><span data-stu-id="fea7c-333">A ping request sent to outlook.office365.com will tell you the name of the datacenter receiving the request, even if ping  *may*  not be able to connect to send the trademark consecutive ICMP packets.</span></span> <span data-ttu-id="fea7c-334">如果使用 PsPing (下载) 的免费工具，并指定端口 (443) 并且可能使用 IPv4 (-4) 您将获得发送数据包的平均往返时间。</span><span class="sxs-lookup"><span data-stu-id="fea7c-334">If you use PsPing (a free tool for download), and specific the port (443) and perhaps to use IPv4 (-4) you will get an average round-trip-time for packets sent.</span></span> <span data-ttu-id="fea7c-335">此操作适用于其他服务中的其他OFFICE 365 URL，例如 `psping -4 yourSite.sharepoint.com:443` 。</span><span class="sxs-lookup"><span data-stu-id="fea7c-335">This will work this for other URLs in the Office 365 services, like `psping -4 yourSite.sharepoint.com:443`.</span></span> <span data-ttu-id="fea7c-336">事实上，您可以指定大量 ping 获取一个较大的样本作为平均值，请尝试类似 这样的示例 `psping -4 -n 20 yourSite-my.sharepoint.com:443` 。</span><span class="sxs-lookup"><span data-stu-id="fea7c-336">In fact, you can specify a number of pings to get a larger sample for your average, try something like `psping -4 -n 20 yourSite-my.sharepoint.com:443`.</span></span>

> [!NOTE]
> <span data-ttu-id="fea7c-337">PsPing 不会发送 ICMP 数据包。</span><span class="sxs-lookup"><span data-stu-id="fea7c-337">PsPing doesn't send ICMP packets.</span></span> <span data-ttu-id="fea7c-338">它通过特定端口对 TCP 数据包执行 ping 操作，因此您可以使用任何一个您认识要打开的端口。</span><span class="sxs-lookup"><span data-stu-id="fea7c-338">It pings with TCP packets over a specific port, so you can use any one you know to be open.</span></span> <span data-ttu-id="fea7c-339">在Office 365 SSL/TLS 的客户端中，尝试将端口 ：443 附加到 PsPing。</span><span class="sxs-lookup"><span data-stu-id="fea7c-339">In Office 365, which uses SSL/TLS, try attaching port :443 to your PsPing.</span></span>

![显示 ping 解析 outlook.office365.com 的屏幕截图，以及 443 执行相同操作但报告平均 RTT 为 6.5 毫秒的 PSPing 的屏幕截图。](../media/c64339f2-2c96-45b8-b168-c2a060430266.PNG)

<span data-ttu-id="fea7c-341">如果在执行网络跟踪时加载Office 365速度较慢的页面，应为 筛选 Netmon 或 Wireshark 跟踪 `DNS` 。</span><span class="sxs-lookup"><span data-stu-id="fea7c-341">If you loaded the slow performing Office 365 page while doing a network trace, you should filter a Netmon or Wireshark trace for `DNS`.</span></span> <span data-ttu-id="fea7c-342">这是我们查找的 IP 之一。</span><span class="sxs-lookup"><span data-stu-id="fea7c-342">This is one of the IPs we're looking for.</span></span>

<span data-ttu-id="fea7c-343">下面是筛选 Netmon 以获取 IP 地址 (并查看 DNS 延迟) 。</span><span class="sxs-lookup"><span data-stu-id="fea7c-343">Here are the steps to take to filter your Netmon to get the IP address (and take a look at DNS Latency).</span></span> <span data-ttu-id="fea7c-344">此示例使用 outlook.office365.com，但也可能使用 SharePoint Online 租户的 URL (hithere.sharepoint.com 例如) 。</span><span class="sxs-lookup"><span data-stu-id="fea7c-344">This example uses outlook.office365.com, but may also use the URL of a SharePoint Online tenant (hithere.sharepoint.com for example).</span></span>

1. <span data-ttu-id="fea7c-345">Ping URL，在结果中记录 ping 请求发送到的 DNS 服务器的名称和 `ping outlook.office365.com` IP 地址。</span><span class="sxs-lookup"><span data-stu-id="fea7c-345">Ping the URL `ping outlook.office365.com` and, in the results, record the name and IP address of the DNS server the ping request was sent to.</span></span>
2. <span data-ttu-id="fea7c-346">网络跟踪打开页面，或执行会给您带来性能问题的操作，或者，如果您在 ping 上看到高延迟，网络本身会跟踪它。</span><span class="sxs-lookup"><span data-stu-id="fea7c-346">Network trace opening the page, or doing the action that gives you the performance problem, or, if you see a high latency on the ping, itself, network trace it.</span></span>
3. <span data-ttu-id="fea7c-347">在 Netmon 中打开跟踪并筛选 DNS (此筛选器也可在 Wireshark 中运行，但区分大小写 `-- dns`) 。</span><span class="sxs-lookup"><span data-stu-id="fea7c-347">Open the trace in Netmon and filter for DNS (this filter also works in Wireshark, but is sensitive to case `-- dns`).</span></span> <span data-ttu-id="fea7c-348">由于从 ping 中知道 DNS 服务器的名称，因此还可以在 Netmon 中更快速进行筛选，如下所示：，在 `DNS AND ContainsBin(FrameData, ASCII, "namnorthwest")` Wireshark dns 中如下所示，frame 包含"namnorthwest"。</span><span class="sxs-lookup"><span data-stu-id="fea7c-348">Since you know the name of the DNS server from your ping you may also filter more speedily in Netmon like this: `DNS AND ContainsBin(FrameData, ASCII, "namnorthwest")`, which looks like this in Wireshark dns and frame contains "namnorthwest".</span></span><br/><span data-ttu-id="fea7c-349">打开响应数据包，在"Netmon **帧详细信息** "窗口中，单击 **"DNS"** 展开以了解更多信息。</span><span class="sxs-lookup"><span data-stu-id="fea7c-349">Open the response packet and, in the Netmon **Frame Details** window, click **DNS** to expand for more information.</span></span> <span data-ttu-id="fea7c-350">在 DNS 信息中，你将找到请求所针对的 DNS 服务器的 IP 地址Office 365。</span><span class="sxs-lookup"><span data-stu-id="fea7c-350">In the DNS information you'll find the IP address of the DNS server the request went to in Office 365.</span></span> <span data-ttu-id="fea7c-351">下一步，你需要此 IP 地址 (PsPing 工具) 。</span><span class="sxs-lookup"><span data-stu-id="fea7c-351">You'll need this IP address for the next step (the PsPing tool).</span></span> <span data-ttu-id="fea7c-352">删除筛选器，右键单击 Netmon 中的 DNS 响应 (**框架摘要** \> **查找** \> **对话 DNS**) 查看并排的 DNS 查询和响应。</span><span class="sxs-lookup"><span data-stu-id="fea7c-352">Remove the filter, right-click on the DNS Response in Netmon (**Frame Summary** \> **Find Conversations** \> **DNS**) to see the DNS Query and Response side-by-side.</span></span>
4. <span data-ttu-id="fea7c-353">在 Netmon 中，还要注意 DNS 请求和响应之间的"时间偏移"列。</span><span class="sxs-lookup"><span data-stu-id="fea7c-353">In Netmon, also note the Time Offset  column between the DNS Request and Response.</span></span> <span data-ttu-id="fea7c-354">下一步，可轻松安装和使用 [PsPing](/sysinternals/downloads/psping) 工具非常方便，因为 ICMP 通常会在防火墙上被阻止，并且 PsPing 可以很轻松地跟踪延迟（以毫秒为单位）。</span><span class="sxs-lookup"><span data-stu-id="fea7c-354">In the next step, the easy-to-install and use [PsPing](/sysinternals/downloads/psping) tool comes in very handy, both because ICMP is often blocked on Firewalls, and because PsPing elegantly tracks latency in milliseconds.</span></span> <span data-ttu-id="fea7c-355">PsPing 完成到地址和端口 (的 TCP 连接，在我们的案例中为开放端口 443) 。</span><span class="sxs-lookup"><span data-stu-id="fea7c-355">PsPing completes a TCP connection to an address and port (in our case open port 443).</span></span>
5. <span data-ttu-id="fea7c-356">安装 PsPing。</span><span class="sxs-lookup"><span data-stu-id="fea7c-356">Install PsPing.</span></span>
6. <span data-ttu-id="fea7c-357">打开命令提示符 ("开始运行"类型 cmd 或 Windows 键类型 cmd) ，将目录更改为安装 PsPing 的目录以运行 \> \> \> PsPing 命令。</span><span class="sxs-lookup"><span data-stu-id="fea7c-357">Open a command prompt (Start \> Run \> type cmd, or Windows Key \> type cmd) and change directory to the directory where you installed PsPing to run the PsPing command.</span></span> <span data-ttu-id="fea7c-358">在我的示例中，你可以看到我在 C 的根上创建一个"Perf"文件夹。您可以执行相同的操作以快速访问。</span><span class="sxs-lookup"><span data-stu-id="fea7c-358">In my examples you can see I made a 'Perf' folder on the root of C. You can do the same for quick access.</span></span>
7. <span data-ttu-id="fea7c-359">键入命令，以便从早期的 Netmon 跟踪中针对 Office 365 DNS 服务器的 IP 地址创建 PsPing，包括端口号（如 `psping -n 20 132.245.24.82:445` ）。</span><span class="sxs-lookup"><span data-stu-id="fea7c-359">Type the command so that you're making your PsPing against the IP address of the Office 365 DNS server from your earlier Netmon trace, including the port number, like `psping -n 20 132.245.24.82:445`.</span></span> <span data-ttu-id="fea7c-360">这将为您提供 20 个 ping 的采样，并计算 PsPing 停止时的平均延迟。</span><span class="sxs-lookup"><span data-stu-id="fea7c-360">This will give you a sampling of 20 pings and average the latency when PsPing stops.</span></span>

<span data-ttu-id="fea7c-361">如果要通过代理服务器Office 365，步骤会有所不同。</span><span class="sxs-lookup"><span data-stu-id="fea7c-361">If you're going to Office 365 through a proxy server, the steps are a little different.</span></span> <span data-ttu-id="fea7c-362">首先，PsPing 进入代理服务器，获取代理/出口和回发的平均延迟值（以毫秒为单位），然后在代理或具有直接 Internet 连接的计算机上运行 PsPing，获取缺少值 (从一个到 Office 365，然后再返回) 。</span><span class="sxs-lookup"><span data-stu-id="fea7c-362">You would first PsPing to your proxy server to get an average latency value in milliseconds to proxy/egress and back, and then either run PsPing on the proxy, or on a computer with a direct Internet connection to get the missing value (the one to Office 365 and back).</span></span>

<span data-ttu-id="fea7c-363">如果选择从代理运行 PsPing，则有两毫秒值：客户端计算机到代理服务器或出口点，以及代理服务器Office 365。</span><span class="sxs-lookup"><span data-stu-id="fea7c-363">If you choose to run PsPing from the proxy, you'll have two millisecond values: Client computer to proxy server or egress point, and proxy server to Office 365.</span></span> <span data-ttu-id="fea7c-364">操作完成！</span><span class="sxs-lookup"><span data-stu-id="fea7c-364">And you're done!</span></span> <span data-ttu-id="fea7c-365">无论如何，请录制值。</span><span class="sxs-lookup"><span data-stu-id="fea7c-365">Well, recording values, anyway.</span></span>

<span data-ttu-id="fea7c-366">如果在与 Internet 有直接连接（即没有代理）的另一台客户端计算机上运行 PsPing，您将具有两毫秒值：客户端计算机到代理服务器或出口点，以及客户端计算机到 Office 365。</span><span class="sxs-lookup"><span data-stu-id="fea7c-366">If you run PsPing on another client computer that has a direct connection to the Internet, that is, without a proxy, you will have two millisecond values: Client computer to proxy server or egress point, and client computer to Office 365.</span></span> <span data-ttu-id="fea7c-367">在这种情况下，从客户端计算机的值减去客户端计算机到代理服务器或出口点的值到 Office 365，你将具有从客户端计算机到代理服务器或出口点、代理服务器或出口点到 Office 365 的 RTT 号码。</span><span class="sxs-lookup"><span data-stu-id="fea7c-367">In this case, subtract the value of client computer to proxy server or egress point from the value of client computer to Office 365, and you will have the RTT numbers from your client computer to the proxy server or egress point, and from proxy server or egress point to Office 365.</span></span>

<span data-ttu-id="fea7c-368">但是，如果可以在直接连接的影响位置找到客户端计算机，或者绕过代理，可以选择查看问题是否从该位置重现开始，然后使用它进行测试。</span><span class="sxs-lookup"><span data-stu-id="fea7c-368">However, if you can find a client computer in the impacted location that is directly connected, or bypasses the proxy, you may choose to see if the issue reproduces there to begin with, and test using it thereafter.</span></span>

<span data-ttu-id="fea7c-369">如在 Netmon 跟踪中所见，如果在任何给定会话中有足够的延迟，这些额外毫秒可能会增加。</span><span class="sxs-lookup"><span data-stu-id="fea7c-369">Latency, as seen in a Netmon trace, those extra milliseconds can add up, if there are enough of them in any given session.</span></span>

![Netmon 中的常规延迟，其中包括添加到“帧摘要”的 Netmon 默认“时间差”列。](../media/7ad17380-8527-4bc2-9b9b-6310cf19ba6b.PNG)

> [!NOTE]
> <span data-ttu-id="fea7c-371">IP 地址可能不同于此处显示的 IP，例如，ping 可能会返回类似于 157.56.0.0/16 或类似的范围。</span><span class="sxs-lookup"><span data-stu-id="fea7c-371">Your IP address may be different than the IPs shown here, for example, your ping may return something more like 157.56.0.0/16 or a similar range.</span></span> <span data-ttu-id="fea7c-372">有关用户使用的范围Office 365，请查看Office 365 URL 和[IP 地址范围](./urls-and-ip-address-ranges.md)。</span><span class="sxs-lookup"><span data-stu-id="fea7c-372">For a list of ranges used by Office 365, check out [Office 365 URLs and IP address ranges](./urls-and-ip-address-ranges.md).</span></span>

<span data-ttu-id="fea7c-373">请记住展开所有节点 (例如，如果要搜索 132.245) 则此节点的顶部有一个按钮。</span><span class="sxs-lookup"><span data-stu-id="fea7c-373">Remember to expand all the nodes (there's a button at the top for this) if you want to search for, for example, 132.245.</span></span>

### <a name="proxy-authentication"></a><span data-ttu-id="fea7c-374">代理身份验证</span><span class="sxs-lookup"><span data-stu-id="fea7c-374">Proxy Authentication</span></span>

<span data-ttu-id="fea7c-375">这仅适用于通过代理服务器的情况。</span><span class="sxs-lookup"><span data-stu-id="fea7c-375">This only applies to you if you're going through a proxy server.</span></span> <span data-ttu-id="fea7c-376">如果没有，可以跳过这些步骤。</span><span class="sxs-lookup"><span data-stu-id="fea7c-376">If not, you can skip these steps.</span></span> <span data-ttu-id="fea7c-377">正常工作时，代理身份验证应一致地以毫秒为单位进行。</span><span class="sxs-lookup"><span data-stu-id="fea7c-377">When working properly, proxy authentication should take place in milliseconds, consistently.</span></span> <span data-ttu-id="fea7c-378">不应在高峰使用时段期间看到间歇性性能不佳 (例如) 。</span><span class="sxs-lookup"><span data-stu-id="fea7c-378">You shouldn't see intermittent bad performance during peak usage periods (for example).</span></span>

<span data-ttu-id="fea7c-379">如果代理身份验证已打开，则每次您与 Office 365建立新的 TCP 连接才能获取信息，您需要在后台传递身份验证过程。</span><span class="sxs-lookup"><span data-stu-id="fea7c-379">If Proxy authentication is on, each time you make a new TCP connection to Office 365 to get information, you need to pass through an authentication process behind the scenes.</span></span> <span data-ttu-id="fea7c-380">因此，例如，在 Outlook Online 中从日历切换到邮件时，您将进行身份验证。</span><span class="sxs-lookup"><span data-stu-id="fea7c-380">So, for example, when switching from Calendar to Mail in Outlook Online, you will authenticate.</span></span> <span data-ttu-id="fea7c-381">在 SharePoint Online 中，如果页面显示来自多个站点或位置的媒体或数据，您将针对呈现数据所需的每个不同 TCP 连接进行身份验证。</span><span class="sxs-lookup"><span data-stu-id="fea7c-381">And in SharePoint Online, if a page displays media or data from multiple sites or locations, you will authenticate for each different TCP connection that is needed in order to render the data.</span></span>

<span data-ttu-id="fea7c-382">在 Outlook Online 中，每当在日历和邮箱之间切换时，可能会遇到加载速度较慢或 SharePoint Online 中页面加载缓慢的问题。</span><span class="sxs-lookup"><span data-stu-id="fea7c-382">In Outlook Online, you may experience slow load times whenever you switch between Calendar and your mailbox, or slow page loads in SharePoint Online.</span></span> <span data-ttu-id="fea7c-383">但是，此处未列出其他症状。</span><span class="sxs-lookup"><span data-stu-id="fea7c-383">However, there are other symptoms not listed here.</span></span>

<span data-ttu-id="fea7c-384">代理身份验证是出口代理服务器上的设置。</span><span class="sxs-lookup"><span data-stu-id="fea7c-384">Proxy authentication is a setting on your egress proxy server.</span></span> <span data-ttu-id="fea7c-385">如果导致与用户产生性能问题Office 365，则必须咨询网络团队。</span><span class="sxs-lookup"><span data-stu-id="fea7c-385">If it is causing a performance issue with Office 365, you must consult your networking team.</span></span>

#### <a name="tools"></a><span data-ttu-id="fea7c-386">工具</span><span class="sxs-lookup"><span data-stu-id="fea7c-386">Tools</span></span>

- <span data-ttu-id="fea7c-387">Netmon</span><span class="sxs-lookup"><span data-stu-id="fea7c-387">Netmon</span></span>
- <span data-ttu-id="fea7c-388">Wireshark</span><span class="sxs-lookup"><span data-stu-id="fea7c-388">Wireshark</span></span>

#### <a name="what-to-look-for"></a><span data-ttu-id="fea7c-389">要查找什么</span><span class="sxs-lookup"><span data-stu-id="fea7c-389">What to look for</span></span>

<span data-ttu-id="fea7c-390">每当必须启动新的 TCP 会话、通常从服务器请求文件或信息或提供信息时，就会进行代理身份验证。</span><span class="sxs-lookup"><span data-stu-id="fea7c-390">Proxy authentication takes place whenever a new TCP session must be spun up, commonly to request files or info from the server, or to supply info.</span></span> <span data-ttu-id="fea7c-391">例如，您可能会看到围绕 HTTP GET 或 HTTP POST 请求的代理身份验证。</span><span class="sxs-lookup"><span data-stu-id="fea7c-391">For example, you may see proxy authentication around HTTP GET or HTTP POST requests.</span></span> <span data-ttu-id="fea7c-392">如果要查看跟踪中对请求进行身份验证的框架，可以将"NTLMSSP 摘要"列添加到 Netmon 并筛选出  `.property.NTLMSSPSummary` 。</span><span class="sxs-lookup"><span data-stu-id="fea7c-392">If you want to see the frames where you are authenticating requests in your trace, add the 'NTLMSSP Summary' column to Netmon and filter for  `.property.NTLMSSPSummary`.</span></span> <span data-ttu-id="fea7c-393">若要了解身份验证所花时间，请添加"时间增量"列。</span><span class="sxs-lookup"><span data-stu-id="fea7c-393">To see how long the authentication is taking, add the Time Delta column.</span></span>

<span data-ttu-id="fea7c-394">若要向 Netmon 添加列：</span><span class="sxs-lookup"><span data-stu-id="fea7c-394">To add a column to Netmon:</span></span>

1. <span data-ttu-id="fea7c-395">右键单击"说明"等 **列**。</span><span class="sxs-lookup"><span data-stu-id="fea7c-395">Right-click on a column such as **Description**.</span></span>
2. <span data-ttu-id="fea7c-396">单击 **"选择列"。**</span><span class="sxs-lookup"><span data-stu-id="fea7c-396">Click **Choose Columns**.</span></span>
3. <span data-ttu-id="fea7c-397">在 _列表中找到"NTLMSSP 摘要__和_ 时间增量"，然后单击"添加 **"。**</span><span class="sxs-lookup"><span data-stu-id="fea7c-397">Locate _NTLMSSP Summary_ and _Time Delta_ in the list and click **Add**.</span></span>
4. <span data-ttu-id="fea7c-398">将新列移动到"说明"列之前或后面，以便可以并排读取它们。</span><span class="sxs-lookup"><span data-stu-id="fea7c-398">Move the new columns into place before or behind the _Description_ column so you can read them side-by-side.</span></span>
5. <span data-ttu-id="fea7c-399">单击“**确定**”。</span><span class="sxs-lookup"><span data-stu-id="fea7c-399">Click **OK**.</span></span>

<span data-ttu-id="fea7c-400">即使您不添加列，Netmon 筛选器也能够正常工作。</span><span class="sxs-lookup"><span data-stu-id="fea7c-400">Even if you don't add the column, the Netmon filter will work.</span></span> <span data-ttu-id="fea7c-401">但是，如果您可以看到您处于身份验证的哪一个阶段，则故障排除将容易得多。</span><span class="sxs-lookup"><span data-stu-id="fea7c-401">But your troubleshooting will be much easier if you can see what stage of authentication you're in.</span></span>

<span data-ttu-id="fea7c-402">在查找代理身份验证实例时，请务必研究存在 NTLM 质询的所有帧，或存在"验证消息"。</span><span class="sxs-lookup"><span data-stu-id="fea7c-402">When looking for instances of Proxy Authentication, be sure to study all frames where there is an NTLM Challenge, or an Authenticate Message is present.</span></span> <span data-ttu-id="fea7c-403">如有必要，右键单击特定的流量部分并查找对话 \> TCP。</span><span class="sxs-lookup"><span data-stu-id="fea7c-403">If necessary, right-click the specific piece of traffic and Find Conversations \> TCP.</span></span> <span data-ttu-id="fea7c-404">请注意这些对话中的"时间增量"值。</span><span class="sxs-lookup"><span data-stu-id="fea7c-404">Be aware of the Time Delta values in these Conversations.</span></span>

![显示代理身份验证的 Netmon 跟踪，按对话进行筛选。](../media/b640f176-0a52-4bbb-972e-60fb3d6aece2.PNG)

<span data-ttu-id="fea7c-406">代理身份验证延迟四秒，如 Wireshark 所见。</span><span class="sxs-lookup"><span data-stu-id="fea7c-406">A four second delay in proxy authentication as seen in Wireshark.</span></span> <span data-ttu-id="fea7c-407">通过 **右键单击** 帧详细信息中同名的字段并选择"添加为列"，可获取上一个显示框架列的时间增量。</span><span class="sxs-lookup"><span data-stu-id="fea7c-407">The **Time delta from previous displayed frame** column was made via right-clicking the field of the same name in the frame details and selecting Add as Column.</span></span>  <br/> <span data-ttu-id="fea7c-408">![在 Wireshark 中，可以通过右键单击帧详细信息中同名的字段并选择"添加为列"来设置"来自上一显示帧的时间增量"列。](../media/f5b7bde4-8067-4ee0-bc7f-e9062ce1ba6f.PNG)</span><span class="sxs-lookup"><span data-stu-id="fea7c-408">![In Wireshark, the 'Time delta from previous displayed frame' column can be made via right-clicking the field of the same name in the frame details and selecting Add as Column.](../media/f5b7bde4-8067-4ee0-bc7f-e9062ce1ba6f.PNG)</span></span>

### <a name="dns-performance"></a><span data-ttu-id="fea7c-409">DNS 性能</span><span class="sxs-lookup"><span data-stu-id="fea7c-409">DNS Performance</span></span>

<span data-ttu-id="fea7c-410">名称解析在尽可能接近客户端国家/地区时效果最好且最快速。</span><span class="sxs-lookup"><span data-stu-id="fea7c-410">Name resolution works best and most quickly when it takes place as close to the client's country as possible.</span></span>

<span data-ttu-id="fea7c-411">如果 DNS 名称解析正在被注意到，它可以在页面加载中添加秒数。</span><span class="sxs-lookup"><span data-stu-id="fea7c-411">If DNS name resolution is taking place overseas, it can add seconds to page loads.</span></span> <span data-ttu-id="fea7c-412">理想情况下，名称解析在 100 毫秒内发生。</span><span class="sxs-lookup"><span data-stu-id="fea7c-412">Ideally, name resolution happens in under 100ms.</span></span> <span data-ttu-id="fea7c-413">如果没有，应执行进一步调查。</span><span class="sxs-lookup"><span data-stu-id="fea7c-413">If not, you should do further investigation.</span></span>

> [!TIP]
> <span data-ttu-id="fea7c-414">不确定客户端连接在客户端连接Office 365？</span><span class="sxs-lookup"><span data-stu-id="fea7c-414">Not sure how Client Connectivity works in Office 365?</span></span> <span data-ttu-id="fea7c-415">请在此处查看客户端连接参考 [文档](/previous-versions//dn741250(v=technet.10))。</span><span class="sxs-lookup"><span data-stu-id="fea7c-415">Take a look at the Client Connectivity Reference document [here](/previous-versions//dn741250(v=technet.10)).</span></span>

#### <a name="tools"></a><span data-ttu-id="fea7c-416">工具</span><span class="sxs-lookup"><span data-stu-id="fea7c-416">Tools</span></span>

- <span data-ttu-id="fea7c-417">Netmon</span><span class="sxs-lookup"><span data-stu-id="fea7c-417">Netmon</span></span>
- <span data-ttu-id="fea7c-418">Wireshark</span><span class="sxs-lookup"><span data-stu-id="fea7c-418">Wireshark</span></span>
- <span data-ttu-id="fea7c-419">PsPing</span><span class="sxs-lookup"><span data-stu-id="fea7c-419">PsPing</span></span>

#### <a name="what-to-look-for"></a><span data-ttu-id="fea7c-420">要查找什么</span><span class="sxs-lookup"><span data-stu-id="fea7c-420">What to look for</span></span>

<span data-ttu-id="fea7c-421">分析 DNS 性能通常是网络跟踪的另一项作业。</span><span class="sxs-lookup"><span data-stu-id="fea7c-421">Analyzing DNS performance is typically another job for a network trace.</span></span> <span data-ttu-id="fea7c-422">但是，PsPing 还有助于发现可能的原因。</span><span class="sxs-lookup"><span data-stu-id="fea7c-422">However, PsPing is also helpful in ruling in, or out, a possible cause.</span></span>

<span data-ttu-id="fea7c-423">DNS 流量基于 TCP 和 UDP 请求，响应会使用 ID 进行明确标记，这有助于将特定请求与特定响应匹配。</span><span class="sxs-lookup"><span data-stu-id="fea7c-423">DNS traffic is based on TCP and UDP requests and responses are clearly marked with an ID that will help to match a specific request with its specific response.</span></span> <span data-ttu-id="fea7c-424">例如，当 SharePoint Online 在网页上使用网络名称或 URL 时，你将看到 DNS 流量。</span><span class="sxs-lookup"><span data-stu-id="fea7c-424">You'll see DNS traffic when, for example, SharePoint Online uses a network name or URL on a web page.</span></span> <span data-ttu-id="fea7c-425">根据经验，大多数流量（传输区域时除外）通过 UDP 运行。</span><span class="sxs-lookup"><span data-stu-id="fea7c-425">As a rule of thumb, most of this traffic, except when transferring Zones, runs over UDP.</span></span>

<span data-ttu-id="fea7c-426">在 Netmon 和 Wireshark 中，让你查看 DNS 流量的最基本筛选器就是 `dns` 。</span><span class="sxs-lookup"><span data-stu-id="fea7c-426">In both Netmon and Wireshark, the most basic filter that will let you look at DNS traffic is simply `dns`.</span></span> <span data-ttu-id="fea7c-427">指定筛选器时，请务必使用小写。</span><span class="sxs-lookup"><span data-stu-id="fea7c-427">Be sure to use lower case when specifying the filter.</span></span> <span data-ttu-id="fea7c-428">请记住，在开始在客户端计算机上重现该问题之前刷新 DNS 解析程序缓存。</span><span class="sxs-lookup"><span data-stu-id="fea7c-428">Remember to flush your DNS resolver cache before you begin to reproduce the issue on your client computer.</span></span> <span data-ttu-id="fea7c-429">例如，如果主页的 SharePoint Online 页面加载速度较慢，应关闭所有浏览器、打开新浏览器、开始跟踪、刷新 DNS 解析程序缓存并浏览到 SharePoint Online 网站。</span><span class="sxs-lookup"><span data-stu-id="fea7c-429">For example, if you have a slow SharePoint Online page load for the Home page, you should close all browsers, open a new browser, start tracing, flush your DNS resolver cache, and browse to your SharePoint Online site.</span></span> <span data-ttu-id="fea7c-430">解析整个页面后，应停止并保存跟踪。</span><span class="sxs-lookup"><span data-stu-id="fea7c-430">Once the entire page resolves, you should stop and save the trace.</span></span>

![在 Netmon 中，DNS 的基本筛选器是 DNS。](../media/1bebc118-ca13-45f3-803f-ab73e7af401d.png)

<span data-ttu-id="fea7c-432">你想要查看此处的时间偏移。</span><span class="sxs-lookup"><span data-stu-id="fea7c-432">You want to look at the time offset here.</span></span> <span data-ttu-id="fea7c-433">并且，将"时间增量"列添加到 Netmon 中可能会很有帮助，您可以通过完成以下步骤来这样做：</span><span class="sxs-lookup"><span data-stu-id="fea7c-433">And it may be helpful to add the **Time Delta** column to Netmon which you can do by completing these steps:</span></span>

1. <span data-ttu-id="fea7c-434">右键单击"说明"等 **列**。</span><span class="sxs-lookup"><span data-stu-id="fea7c-434">Right-click on a column such as **Description**.</span></span>
2. <span data-ttu-id="fea7c-435">单击 **"选择列"。**</span><span class="sxs-lookup"><span data-stu-id="fea7c-435">Click **Choose Columns**.</span></span>
3. <span data-ttu-id="fea7c-436">在 _列表中找到"时间_ 增量"，然后单击"添加 **"。**</span><span class="sxs-lookup"><span data-stu-id="fea7c-436">Locate _Time Delta_ in the list and click **Add**.</span></span>
4. <span data-ttu-id="fea7c-437">将新列移动到"说明"列之前或后面，以便可以并排读取它们。</span><span class="sxs-lookup"><span data-stu-id="fea7c-437">Move the new column into place before or behind the _Description_ column so you can read them side-by-side.</span></span>
5. <span data-ttu-id="fea7c-438">单击“**确定**”。</span><span class="sxs-lookup"><span data-stu-id="fea7c-438">Click **OK**.</span></span>

<span data-ttu-id="fea7c-439">如果发现感兴趣的查询，请考虑通过右键单击帧详细信息面板中的该查询来隔离它，选择"**查找对话** \> **DNS"。**</span><span class="sxs-lookup"><span data-stu-id="fea7c-439">If you find a query of interest, consider isolating it by right-clicking that query in the frame details panel, choosing **Find Conversations** \> **DNS**.</span></span> <span data-ttu-id="fea7c-440">请注意，"网络对话"面板直接跳转到其 UDP 流量日志中的特定对话。</span><span class="sxs-lookup"><span data-stu-id="fea7c-440">Notice that the Network Conversations panel jumps right to the specific conversation in its log of UDP traffic.</span></span>

![Netmon 跟踪Outlook DNS 筛选的联机负载，然后使用"查找对话"和"DNS"缩小结果范围。](../media/763cf20e-7b48-4a37-9449-c9978cfe118b.PNG)

<span data-ttu-id="fea7c-442">在 Wireshark 中，您可以为 DNS 时间创建列。</span><span class="sxs-lookup"><span data-stu-id="fea7c-442">In Wireshark you can make a column for DNS time.</span></span> <span data-ttu-id="fea7c-443">在 Wireshark (跟踪信息或) 跟踪记录，并按 筛选，或者更 `dns` 有用。 `dns.time`</span><span class="sxs-lookup"><span data-stu-id="fea7c-443">Take your trace (or open a trace) in Wireshark and filter by `dns`, or, more helpfully,  `dns.time`.</span></span> <span data-ttu-id="fea7c-444">单击任何 DNS 查询，在显示详细信息的面板中展开  `Domain Name System (response)` 详细信息。</span><span class="sxs-lookup"><span data-stu-id="fea7c-444">Click on any DNS query, and, in the panel showing details, expand the  `Domain Name System (response)` details.</span></span> <span data-ttu-id="fea7c-445">你将看到一个时间字段 (例如， `[Time: 0.001111100 seconds]` 。</span><span class="sxs-lookup"><span data-stu-id="fea7c-445">You'll see a field for time (for example, `[Time: 0.001111100 seconds]`.</span></span> <span data-ttu-id="fea7c-446">右键单击此时间，然后选择 **"应用为列"。**</span><span class="sxs-lookup"><span data-stu-id="fea7c-446">Right-click this time and select **Apply as Column**.</span></span> <span data-ttu-id="fea7c-447">这将为您提供一 **个"时间** "列，以便更快速地对跟踪进行排序。</span><span class="sxs-lookup"><span data-stu-id="fea7c-447">This will give you a **Time** column for quicker sorting of your trace.</span></span> <span data-ttu-id="fea7c-448">单击新列以按降序值排序，以查看解析哪个 DNS 呼叫需要最长的时间。</span><span class="sxs-lookup"><span data-stu-id="fea7c-448">Click on the new column to sort by descending values to see which DNS call took the longest to resolve.</span></span>

[<span data-ttu-id="fea7c-449">按照 dns.time（小写）在 Wireshark 中筛选的 SharePoint Online 的浏览，其中包含将详细信息插入到某个列以及按升序进行排序的时间。</span><span class="sxs-lookup"><span data-stu-id="fea7c-449">A browse of SharePoint Online filtered in Wireshark by (lowercase) dns.time, with the time from the details made into a column and sorted ascending.</span></span>](../media/1439dcc2-12ff-4ee2-9ef3-1484cf79c384.PNG)

<span data-ttu-id="fea7c-450">如果要对 DNS 解析时间进行更多调查，请尝试对 TCP 服务使用的 DNS 端口执行 PsPing (例如  `psping <IP address of DNS server>:53` ，) 。</span><span class="sxs-lookup"><span data-stu-id="fea7c-450">If you would like to do more investigation of the DNS resolution time, try a PsPing against the DNS port used by TCP (for example,  `psping <IP address of DNS server>:53`) .</span></span> <span data-ttu-id="fea7c-451">是否仍看到性能问题？</span><span class="sxs-lookup"><span data-stu-id="fea7c-451">Do you still see a performance issue?</span></span> <span data-ttu-id="fea7c-452">如果这样做，则问题更有可能是更广泛的网络问题，而不是要解决的特定 DNS 应用程序的问题。</span><span class="sxs-lookup"><span data-stu-id="fea7c-452">If you do, then the problem is more likely to be a broader network issue than an issue of specific the DNS application you're hitting to do resolution.</span></span> <span data-ttu-id="fea7c-453">还值得一提的是，ping to outlook.office365.com 将告诉您 Outlook Online 的 DNS 名称解析 (例如，outlook-namnorthwest.office365.com) 。</span><span class="sxs-lookup"><span data-stu-id="fea7c-453">It's also worth mentioning, again, that a ping to outlook.office365.com will tell you where DNS name resolution for Outlook Online is taking place (for example, outlook-namnorthwest.office365.com).</span></span>

<span data-ttu-id="fea7c-454">如果问题看起来特定于 DNS，可能需要联系 IT 部门来查看 DNS 配置和 DNS 转发器，以进一步调查此问题。</span><span class="sxs-lookup"><span data-stu-id="fea7c-454">If the issue looks to be DNS specific, it may be necessary to contact your IT department to look at DNS configurations and DNS Forwarders to further investigate this issue.</span></span>

### <a name="proxy-scalability"></a><span data-ttu-id="fea7c-455">代理可伸缩性</span><span class="sxs-lookup"><span data-stu-id="fea7c-455">Proxy Scalability</span></span>

<span data-ttu-id="fea7c-456">Outlook Online 等Office 365向客户端授予多个长期连接。</span><span class="sxs-lookup"><span data-stu-id="fea7c-456">Services like Outlook Online in Office 365 grant clients multiple long-term connections.</span></span> <span data-ttu-id="fea7c-457">因此，每个用户可能使用需要更长时间的更多连接。</span><span class="sxs-lookup"><span data-stu-id="fea7c-457">Therefore, each user may use more connections that require a longer life.</span></span>

#### <a name="tools"></a><span data-ttu-id="fea7c-458">工具</span><span class="sxs-lookup"><span data-stu-id="fea7c-458">Tools</span></span>

<span data-ttu-id="fea7c-459">数学</span><span class="sxs-lookup"><span data-stu-id="fea7c-459">Math</span></span>

#### <a name="what-to-look-for"></a><span data-ttu-id="fea7c-460">要查找什么</span><span class="sxs-lookup"><span data-stu-id="fea7c-460">What to look for</span></span>

<span data-ttu-id="fea7c-461">没有特定于此的网络跟踪或疑难解答工具。</span><span class="sxs-lookup"><span data-stu-id="fea7c-461">There is no network trace or troubleshooting tool specific to this.</span></span> <span data-ttu-id="fea7c-462">相反，它基于给定限制和其他变量的带宽计算。</span><span class="sxs-lookup"><span data-stu-id="fea7c-462">Instead, it's based upon bandwidth calculations given limitations and other variables.</span></span>

### <a name="tcp-max-segment-size"></a><span data-ttu-id="fea7c-463">TCP 最大段大小</span><span class="sxs-lookup"><span data-stu-id="fea7c-463">TCP Max Segment Size</span></span>

<span data-ttu-id="fea7c-464">在 SYN - SYN/ACK 中找到。</span><span class="sxs-lookup"><span data-stu-id="fea7c-464">Found in the SYN - SYN/ACK.</span></span>  <span data-ttu-id="fea7c-465">执行此检查将检查您执行的任何性能网络跟踪，以确保 TCP 数据包配置为包含可能的最大数据量。</span><span class="sxs-lookup"><span data-stu-id="fea7c-465">Do this check in any performance network trace you've taken to ensure that TCP packets are configured to carry the maximum amount of data possible.</span></span>

<span data-ttu-id="fea7c-466">目标是查看 1460 字节的 MSS 以传输数据。</span><span class="sxs-lookup"><span data-stu-id="fea7c-466">The goal is to see a MSS of 1460 bytes for transmission of data.</span></span> <span data-ttu-id="fea7c-467">如果你使用的是代理，或者使用的是 NAT，请记住从客户端运行此测试以从客户端到代理/出口/NAT，以及从代理/出口/NAT 到 Office 365以获得最佳结果！</span><span class="sxs-lookup"><span data-stu-id="fea7c-467">If you're behind a proxy, or you are using a NAT, remember to run this test from client to proxy/egress/NAT, and from proxy/egress/NAT to Office 365 for best results!</span></span> <span data-ttu-id="fea7c-468">这些会话是不同的 TCP 会话。</span><span class="sxs-lookup"><span data-stu-id="fea7c-468">These are different TCP sessions.</span></span>

#### <a name="tools"></a><span data-ttu-id="fea7c-469">工具</span><span class="sxs-lookup"><span data-stu-id="fea7c-469">Tools</span></span>

<span data-ttu-id="fea7c-470">Netmon</span><span class="sxs-lookup"><span data-stu-id="fea7c-470">Netmon</span></span>

#### <a name="what-to-look-for"></a><span data-ttu-id="fea7c-471">要查找什么</span><span class="sxs-lookup"><span data-stu-id="fea7c-471">What to look for</span></span>

<span data-ttu-id="fea7c-472">TCP 最大段大小 (MSS) 是网络跟踪中三向握手的另一个参数，这意味着你将在 SYN - SYN/ACK 数据包中找到所需的数据。</span><span class="sxs-lookup"><span data-stu-id="fea7c-472">TCP Max Segment Size (MSS) is another parameter of the three-way handshake in your network trace, that means you'll find the data you need in the SYN - SYN/ACK packet.</span></span> <span data-ttu-id="fea7c-473">MSS 实际上非常易于查看。</span><span class="sxs-lookup"><span data-stu-id="fea7c-473">MSS is actually pretty simple to see.</span></span>

<span data-ttu-id="fea7c-474">打开您拥有的任何性能网络跟踪，并查找您想知道或演示性能问题的连接。</span><span class="sxs-lookup"><span data-stu-id="fea7c-474">Open any performance network trace you have and find the connection you're curious about, or that demonstrates the performance problem.</span></span>

> [!NOTE]
> <span data-ttu-id="fea7c-475">如果正在查看跟踪并需要查找与对话相关的流量，请按客户端的 IP 或代理服务器或出口点的 IP 进行筛选，或同时进行这两项操作。</span><span class="sxs-lookup"><span data-stu-id="fea7c-475">If you are looking at a trace and need to find the traffic relevant to your conversation, filter by the IP of the Client, or the IP of the proxy server or egress point, or both.</span></span> <span data-ttu-id="fea7c-476">直接执行时，您需要 ping 要测试的 URL，以在跟踪中Office 365 IP 地址，并按其进行筛选。</span><span class="sxs-lookup"><span data-stu-id="fea7c-476">Going directly, you will need to ping the URL that you're testing for the IP address of Office 365 in the trace, and filter by it.</span></span>

<span data-ttu-id="fea7c-477">查看跟踪第二手？</span><span class="sxs-lookup"><span data-stu-id="fea7c-477">Looking at the trace second-hand?</span></span> <span data-ttu-id="fea7c-478">尝试使用筛选器来引导自己。</span><span class="sxs-lookup"><span data-stu-id="fea7c-478">Try using filters to orient yourself.</span></span> <span data-ttu-id="fea7c-479">在 Netmon 中，基于 URL 运行搜索，例如 ， `Containsbin(framedata, ascii, "sphybridExample")` 记下帧号。</span><span class="sxs-lookup"><span data-stu-id="fea7c-479">In Netmon, run a search based on the URL, such as `Containsbin(framedata, ascii, "sphybridExample")`, take note of the frame number.</span></span>

<span data-ttu-id="fea7c-480">在 Wireshark 中，使用类似 这样的  `frame contains "sphybridExample"` 。</span><span class="sxs-lookup"><span data-stu-id="fea7c-480">In Wireshark use something like  `frame contains "sphybridExample"`.</span></span> <span data-ttu-id="fea7c-481">如果你注意到你已找到 Remote Winsock (RWS) 流量 (它可能显示为 Wireshark) 中的 [PSH， ACK]，请记住，RWS 连接可以在相关的 SYN - SYN/AKS 之前不久看到，如前面所述。</span><span class="sxs-lookup"><span data-stu-id="fea7c-481">If you notice that you've found Remote Winsock (RWS) traffic (it may appear as a [PSH, ACK] in Wireshark), remember that RWS connects can be seen shortly before relevant SYN - SYN/ACKs, as discussed earlier.</span></span>

<span data-ttu-id="fea7c-482">此时，你可以记录帧编号，删除筛选器，单击 Netmon 的"网络对话"窗口中的"所有流量"，查看最近的 SYN。</span><span class="sxs-lookup"><span data-stu-id="fea7c-482">At this point, you can record the frame number, drop the filter, click **All Traffic** in the Network Conversations window in Netmon to look at the nearest SYN.</span></span>

<span data-ttu-id="fea7c-483">重要的是，如果您在跟踪时未收到任何 IP 地址信息，在跟踪 (的一部分（例如) ）中查找 URL 将为您提供要筛选的 IP 地址。 `sphybridExample-my.sharepoint.com`</span><span class="sxs-lookup"><span data-stu-id="fea7c-483">Importantly, if you didn't receive any of the IP address information at the time of the trace, finding your URL in the trace (part of `sphybridExample-my.sharepoint.com`, for example), will give you IP addresses to filter by.</span></span>

<span data-ttu-id="fea7c-484">在跟踪中查找你感兴趣的连接。</span><span class="sxs-lookup"><span data-stu-id="fea7c-484">Locate the connection in the trace that you're interested in seeing.</span></span> <span data-ttu-id="fea7c-485">为此，可以扫描跟踪、按 IP 地址筛选，或者使用 Netmon 中的"网络对话"窗口选择特定的对话 ID。</span><span class="sxs-lookup"><span data-stu-id="fea7c-485">You may do this by either scanning the trace, by filtering by IP addresses, or by selecting specific Conversation IDs using the Network Conversations window in Netmon.</span></span> <span data-ttu-id="fea7c-486">找到 SYN 数据包后，展开"帧详细信息"面板中 Netmon (中的 TCP) 或 Wireshark) 中的传输控制协议 (。</span><span class="sxs-lookup"><span data-stu-id="fea7c-486">Once you've found the SYN packet, expand TCP (in Netmon), or Transmission Control Protocol (in Wireshark) in the Frame Details panel.</span></span> <span data-ttu-id="fea7c-487">展开"TCP 选项"和"MaxSegmentSize"。</span><span class="sxs-lookup"><span data-stu-id="fea7c-487">Expand TCP Options and MaxSegmentSize.</span></span> <span data-ttu-id="fea7c-488">找到相关的 SYN-ACK 帧并展开 TCP 选项和 MaxSegmentSize。</span><span class="sxs-lookup"><span data-stu-id="fea7c-488">Locate the related SYN-ACK frame and Expand TCP Options and MaxSegmentSize.</span></span> <span data-ttu-id="fea7c-489">两个值中较小的值将是"最大段大小"。</span><span class="sxs-lookup"><span data-stu-id="fea7c-489">The smaller of the two values will be your Maximum Segment Size.</span></span> <span data-ttu-id="fea7c-490">在此图中，我使用了名为 TCP 疑难解答的 Netmon 中的内置 Column。</span><span class="sxs-lookup"><span data-stu-id="fea7c-490">In this picture, I make use of the built-in Column in Netmon called TCP Troubleshoot.</span></span>

![使用内置列在 Netmon 中筛选的网络跟踪。](../media/e073df13-71f8-497a-83b4-bb9f70bd9833.PNG)

<span data-ttu-id="fea7c-492">内置列位于"框架详细信息 **"面板的顶部** 。</span><span class="sxs-lookup"><span data-stu-id="fea7c-492">The built-in column is at the top of the **Frame Details** panel.</span></span> <span data-ttu-id="fea7c-493"> (若要切换回正常视图，请再次单击"列"，然后选择"时区 **.)**</span><span class="sxs-lookup"><span data-stu-id="fea7c-493">(To switch back to your normal view, click **Columns** again, and then choose **Time Zone**.)</span></span>

![查找“TCP 疑难解答”选项（在“帧摘要”上方）的“列”下拉列表的位置。](../media/64fd4baa-a872-4f07-b959-752d7d37fd62.PNG)

<span data-ttu-id="fea7c-495">下面是 Wireshark 中的筛选跟踪。</span><span class="sxs-lookup"><span data-stu-id="fea7c-495">Here's a filtered trace in Wireshark.</span></span> <span data-ttu-id="fea7c-496">存在特定于 MSS 值或 `tcp.options.mss` () 。</span><span class="sxs-lookup"><span data-stu-id="fea7c-496">There is a filter specific to the MSS value ( `tcp.options.mss`).</span></span> <span data-ttu-id="fea7c-497">SYN、SYN/ACK、ACK 握手的帧链接在 Wireshark 的底部，相当于帧详细信息 (因此帧 47 ACK、指向 46 SYN/ACK 的链接、指向 43 SYN) 的链接可简化此类工作。</span><span class="sxs-lookup"><span data-stu-id="fea7c-497">The frames of a SYN, SYN/ACK, ACK handshake are linked at the bottom of the Wireshark equivalent to Frame Details (so frame 47 ACK, links to 46 SYN/ACK, links to 43 SYN) to make this kind of work easier.</span></span>

![在 Wireshark 中按 tcp.options.mss 筛选出的最大线段 (MSS) 。](../media/51e278db-801b-48bc-9b68-87cf92f03fd6.PNG)

<span data-ttu-id="fea7c-499">如果你需要检查选择性确认 (此矩阵中的下一主题) ，请不要关闭跟踪！</span><span class="sxs-lookup"><span data-stu-id="fea7c-499">If you need to check **Selective Acknowledgment** (next topic in this matrix), don't close your trace!</span></span>

### <a name="selective-acknowledgment"></a><span data-ttu-id="fea7c-500">选择性确认</span><span class="sxs-lookup"><span data-stu-id="fea7c-500">Selective Acknowledgment</span></span>

<span data-ttu-id="fea7c-501">在 SYN - SYN/ACK 中找到。</span><span class="sxs-lookup"><span data-stu-id="fea7c-501">Found in the SYN - SYN/ACK.</span></span> <span data-ttu-id="fea7c-502">必须在 SYN 和 SYN/ACK 中报告为"允许"。</span><span class="sxs-lookup"><span data-stu-id="fea7c-502">Must be reported as Permitted in both SYN and SYN/ACK.</span></span> <span data-ttu-id="fea7c-503">SELECTIVE Acknowledgment (使用) 在数据包丢失时可以更加流畅地重新传输数据。</span><span class="sxs-lookup"><span data-stu-id="fea7c-503">Selective Acknowledgment (SACK) allows for smoother retransmission of data when a packet or packets go missing.</span></span> <span data-ttu-id="fea7c-504">设备可以禁用此功能，这可能会导致性能问题。</span><span class="sxs-lookup"><span data-stu-id="fea7c-504">Devices can disable this feature, which can lead to performance problems.</span></span>

<span data-ttu-id="fea7c-505">如果你使用的是代理，或者使用的是 NAT，请记住从客户端运行此测试以从客户端到代理/出口/NAT，以及从代理/出口/NAT 到 Office 365以获得最佳结果！</span><span class="sxs-lookup"><span data-stu-id="fea7c-505">If you're behind a proxy, or you are using a NAT, remember to run this test from client to proxy/egress/NAT, and from proxy/egress/NAT to Office 365 for best results!</span></span> <span data-ttu-id="fea7c-506">这些会话是不同的 TCP 会话。</span><span class="sxs-lookup"><span data-stu-id="fea7c-506">These are different TCP sessions.</span></span>

#### <a name="tools"></a><span data-ttu-id="fea7c-507">工具</span><span class="sxs-lookup"><span data-stu-id="fea7c-507">Tools</span></span>

<span data-ttu-id="fea7c-508">Netmon</span><span class="sxs-lookup"><span data-stu-id="fea7c-508">Netmon</span></span>

#### <a name="what-to-look-for"></a><span data-ttu-id="fea7c-509">要查找什么</span><span class="sxs-lookup"><span data-stu-id="fea7c-509">What to look for</span></span>

<span data-ttu-id="fea7c-510">SELECTIVE Acknowledgment (函数) 是 SYN-SYN/ACK 握手中的另一个参数。</span><span class="sxs-lookup"><span data-stu-id="fea7c-510">Selective Acknowledgment (SACK) is another parameter in the SYN-SYN/ACK handshake.</span></span> <span data-ttu-id="fea7c-511">可以通过多种方式筛选跟踪 SYN - SYN/ACK。</span><span class="sxs-lookup"><span data-stu-id="fea7c-511">You can filter your trace for SYN - SYN/ACK many ways.</span></span>

<span data-ttu-id="fea7c-512">通过扫描跟踪、按 IP 地址筛选或通过使用 Netmon 中的"网络对话"窗口单击对话 ID，在跟踪中查找你感兴趣的连接。</span><span class="sxs-lookup"><span data-stu-id="fea7c-512">Locate the connection in the trace that you're interested in seeing either by scanning the trace, filtering by IP addresses, or by clicking a Conversation ID using the Network Conversations window in Netmon.</span></span> <span data-ttu-id="fea7c-513">找到 SYN 数据包后，在 Netmon 中展开 TCP，或在 Frame Details 部分展开 Wireshark 中的传输控制协议。</span><span class="sxs-lookup"><span data-stu-id="fea7c-513">Once you've found the SYN packet, expand TCP in Netmon, or Transmission Control Protocol in Wireshark in the Frame Details section.</span></span> <span data-ttu-id="fea7c-514">展开"TCP 选项"，然后展开"计划"。</span><span class="sxs-lookup"><span data-stu-id="fea7c-514">Expand TCP Options and then SACK.</span></span> <span data-ttu-id="fea7c-515">找到相关的 SYN-ACK 帧和"展开 TCP 选项"及其"显示"字段。</span><span class="sxs-lookup"><span data-stu-id="fea7c-515">Locate the related SYN-ACK frame and Expand TCP Options and its SACK field.</span></span> <span data-ttu-id="fea7c-516">确保 SYN 和 SYN/ACK 中均允许使用一个功能区。</span><span class="sxs-lookup"><span data-stu-id="fea7c-516">Make certain SACK is permitted in both SYN and SYN/ACK.</span></span> <span data-ttu-id="fea7c-517">下面是 NETmon 和 Wireshark 中的一些值。</span><span class="sxs-lookup"><span data-stu-id="fea7c-517">Here are SACK values as seen in both Netmon and Wireshark.</span></span>

![tcp.flags.syn == 1 (在 Netmon 中) 的 SELECTIVE 协议。](../media/216f556f-5031-4ed2-b066-a0d9b3251fa2.PNG)

![如在 Wireshark 中所见，SACK 含有筛选器 tcp.flags.syn == 1。](../media/0a6e26e5-43dc-403b-adc9-3349a55f4e4b.PNG)

### <a name="dns-geolocation"></a><span data-ttu-id="fea7c-520">DNS 地理位置</span><span class="sxs-lookup"><span data-stu-id="fea7c-520">DNS Geolocation</span></span>

<span data-ttu-id="fea7c-521">世界上的Office 365解析 DNS 呼叫将影响连接速度。</span><span class="sxs-lookup"><span data-stu-id="fea7c-521">Where in the world Office 365 tries to resolve your DNS call effects your connection speed.</span></span>

<span data-ttu-id="fea7c-522">在 Outlook Online 中，完成第一次 DNS 查找后，该 DNS 的位置将用于连接到最近的数据中心。</span><span class="sxs-lookup"><span data-stu-id="fea7c-522">In Outlook Online, after the first DNS lookup is completed, the location of that DNS will be used to connect to your nearest datacenter.</span></span> <span data-ttu-id="fea7c-523">你将连接到 Outlook Online CAS 服务器，该服务器将使用主干网络连接到存储数据的数据中心 (dC) 。</span><span class="sxs-lookup"><span data-stu-id="fea7c-523">You will be connected to an Outlook Online CAS server, which will use the backbone network to connect to the datacenter (dC) where your data is stored.</span></span> <span data-ttu-id="fea7c-524">这速度更快。</span><span class="sxs-lookup"><span data-stu-id="fea7c-524">This is faster.</span></span>

<span data-ttu-id="fea7c-525">当访问 SharePoint Online 时，旅行中的用户将被定向到其活动数据中心，即其位置基于其 SPO 租户的主页的 dC (因此，如果用户位于美国，则使用美国 dC) 。</span><span class="sxs-lookup"><span data-stu-id="fea7c-525">When accessing SharePoint Online, a user traveling abroad will be directed to their active datacenter -- that's the dC whose location is based on their SPO tenant's home-base (so, a dC in the USA if the user if USA-based).</span></span>

<span data-ttu-id="fea7c-526">Lync Online 一次具有多个 dC 中的活动节点。</span><span class="sxs-lookup"><span data-stu-id="fea7c-526">Lync online has active nodes in more than one dC at a time.</span></span> <span data-ttu-id="fea7c-527">向 Lync Online 实例发送请求时，Microsoft DNS 将确定请求的源位置，并返回最近的 Lync Online 活动区域 dC 中的 IP 地址。</span><span class="sxs-lookup"><span data-stu-id="fea7c-527">When requests are sent for Lync online instances, Microsoft's DNS will determine where in the world the request came from, and return IP addresses from the nearest regional dC where Lync online is active.</span></span>

> [!TIP]
> <span data-ttu-id="fea7c-528">需要了解有关客户端如何连接到客户端Office 365？</span><span class="sxs-lookup"><span data-stu-id="fea7c-528">Need to know more about how clients connect to Office 365?</span></span> <span data-ttu-id="fea7c-529">请看一下客户端 [连接](/previous-versions//dn741250(v=technet.10)) 参考文章 (及其有用的图形) 。</span><span class="sxs-lookup"><span data-stu-id="fea7c-529">Take a look at the [Client Connectivity](/previous-versions//dn741250(v=technet.10)) reference article (and its helpful graphics).</span></span>

#### <a name="tools"></a><span data-ttu-id="fea7c-530">工具</span><span class="sxs-lookup"><span data-stu-id="fea7c-530">Tools</span></span>

- <span data-ttu-id="fea7c-531">Ping</span><span class="sxs-lookup"><span data-stu-id="fea7c-531">Ping</span></span>
- <span data-ttu-id="fea7c-532">PsPing</span><span class="sxs-lookup"><span data-stu-id="fea7c-532">PsPing</span></span>

#### <a name="what-to-look-for"></a><span data-ttu-id="fea7c-533">要查找什么</span><span class="sxs-lookup"><span data-stu-id="fea7c-533">What to look for</span></span>

<span data-ttu-id="fea7c-534">在大多数情况下，从客户端的 DNS 服务器到 Microsoft DNS 服务器的名称解析请求应该会导致 Microsoft DNS 返回区域数据中心的 IP 地址 (dC) 。</span><span class="sxs-lookup"><span data-stu-id="fea7c-534">Requests for name resolution from the client's DNS servers to Microsoft's DNS servers should in most cases result in Microsoft DNS returning the IP address of a regional datacenter (dC).</span></span> <span data-ttu-id="fea7c-535">这对你意味着什么？</span><span class="sxs-lookup"><span data-stu-id="fea7c-535">What does this mean for you?</span></span> <span data-ttu-id="fea7c-536">如果你的总部位于印度孟加拉，但正在美国出差，当浏览器向 Outlook Online 提出请求时，Microsoft 的 DNS 服务器应该将 IP 地址提交到美国的数据中心（一个区域数据中心）。</span><span class="sxs-lookup"><span data-stu-id="fea7c-536">If your headquarters are in Bangalore, India, but you are traveling in the United States, when your browser makes a request for Outlook Online, Microsoft's DNS servers should hand you IP addresses to datacenters in the United States -- a regional datacenter.</span></span> <span data-ttu-id="fea7c-537">如果需要邮件从Outlook，该数据将在数据中心之间通过 Microsoft 的快速主干网传输。</span><span class="sxs-lookup"><span data-stu-id="fea7c-537">If mail is needed from Outlook, that data will travel across Microsoft's quick backbone network between the datacenters.</span></span>

<span data-ttu-id="fea7c-538">当名称解析尽可能接近用户位置时，DNS 运行速度最快。</span><span class="sxs-lookup"><span data-stu-id="fea7c-538">DNS works fastest when name resolution is done as close to the user location as possible.</span></span> <span data-ttu-id="fea7c-539">如果你在欧洲，你想要转到欧洲 Microsoft DNS，最好 (欧洲) 数据中心。</span><span class="sxs-lookup"><span data-stu-id="fea7c-539">If you're in Europe, you want to go to a Microsoft DNS in Europe, and (ideally) deal with a datacenter in Europe.</span></span> <span data-ttu-id="fea7c-540">从欧洲客户端到美国的 DNS 和数据中心的性能将变慢。</span><span class="sxs-lookup"><span data-stu-id="fea7c-540">Performance from a client in Europe going to DNS and a datacenter in America will be slower.</span></span>

<span data-ttu-id="fea7c-541">针对用户 outlook.office365.com Ping 工具，以确定 DNS 请求的路由位置。</span><span class="sxs-lookup"><span data-stu-id="fea7c-541">Run the Ping tool against outlook.office365.com to determine where in the world your DNS request is being routed.</span></span> <span data-ttu-id="fea7c-542">如果您在欧洲，您应看到来自类似 outlook-emeawest.office365.com 的答复。</span><span class="sxs-lookup"><span data-stu-id="fea7c-542">If you are in Europe, you should see a reply from something like outlook-emeawest.office365.com.</span></span> <span data-ttu-id="fea7c-543">在美洲，预计会 outlook-namnorthwest.office365.com。</span><span class="sxs-lookup"><span data-stu-id="fea7c-543">In the Americas, expect something like outlook-namnorthwest.office365.com.</span></span>

<span data-ttu-id="fea7c-544">打开客户端计算机上的命令提示符， (Start Run cmd 或 Windows \> \> 键 \> 类型 cmd) 。</span><span class="sxs-lookup"><span data-stu-id="fea7c-544">Open the command prompt on the client computer (via Start \> Run \> cmd or Windows key \> type cmd).</span></span> <span data-ttu-id="fea7c-545">键入 ping outlook.office365.com 并按 Enter。</span><span class="sxs-lookup"><span data-stu-id="fea7c-545">Type ping outlook.office365.com and press ENTER.</span></span> <span data-ttu-id="fea7c-546">请记住，如果要通过 IPv4 指定 ping，则指定 -4。</span><span class="sxs-lookup"><span data-stu-id="fea7c-546">Remember, to specify -4 if you want to specify to ping via IPv4.</span></span> <span data-ttu-id="fea7c-547">您可能无法从 ICMP 数据包获得答复，但您应该会看到请求路由到的 DNS 的名称。</span><span class="sxs-lookup"><span data-stu-id="fea7c-547">You may fail to get a reply from the ICMP packets, but you should see the name of the DNS to which the request was routed.</span></span> <span data-ttu-id="fea7c-548">如果您想要查看此连接的延迟数字，请尝试 PsPing 到 ping 返回的服务器的 IP 地址。</span><span class="sxs-lookup"><span data-stu-id="fea7c-548">If you want to see the latency numbers for this connection try PsPing to the IP address of the server that is returned by ping.</span></span>

![显示 Outlook-namnorthwest 中的解决方案的 outlook.office365.com 的 Ping。](../media/06c944d5-6159-43ec-aa31-757770695e8b.PNG)

![PSPing to the IP address returned by the ping to outlook.office365.com showing average 28 millisecond latency.](../media/f2b25a75-1a87-4479-b8a7-fa4375683507.PNG)

### <a name="office-365-application-troubleshooting"></a><span data-ttu-id="fea7c-551">Office 365应用程序疑难解答</span><span class="sxs-lookup"><span data-stu-id="fea7c-551">Office 365 Application Troubleshooting</span></span>

#### <a name="tools"></a><span data-ttu-id="fea7c-552">工具</span><span class="sxs-lookup"><span data-stu-id="fea7c-552">Tools</span></span>

- <span data-ttu-id="fea7c-553">Netmon</span><span class="sxs-lookup"><span data-stu-id="fea7c-553">Netmon</span></span>
- <span data-ttu-id="fea7c-554">HTTPWatch</span><span class="sxs-lookup"><span data-stu-id="fea7c-554">HTTPWatch</span></span>
- <span data-ttu-id="fea7c-555">浏览器中的 F12 控制台</span><span class="sxs-lookup"><span data-stu-id="fea7c-555">F12 Console in the browser</span></span>

<span data-ttu-id="fea7c-556">本网络专用文章中不介绍特定于应用程序的疑难解答中使用的工具。</span><span class="sxs-lookup"><span data-stu-id="fea7c-556">We don't cover tools used in application-specific troubleshooting in this network-specific article.</span></span> <span data-ttu-id="fea7c-557">但是，你将找到可在 *此页面*[使用的资源](https://support.office.com/article/Network-planning-and-performance-tuning-for-Office-365-e5f1228c-da3c-4654-bf16-d163daee8848)。</span><span class="sxs-lookup"><span data-stu-id="fea7c-557">But you'll find resources you  *can*  use [on this page](https://support.office.com/article/Network-planning-and-performance-tuning-for-Office-365-e5f1228c-da3c-4654-bf16-d163daee8848).</span></span>

## <a name="related-topics"></a><span data-ttu-id="fea7c-558">相关主题</span><span class="sxs-lookup"><span data-stu-id="fea7c-558">Related Topics</span></span>

[<span data-ttu-id="fea7c-559">管理 Office 365 终结点</span><span class="sxs-lookup"><span data-stu-id="fea7c-559">Managing Office 365 endpoints</span></span>](https://support.office.com/article/99cab9d4-ef59-4207-9f2b-3728eb46bf9a)

[<span data-ttu-id="fea7c-560">Office 365 终结点 FAQ</span><span class="sxs-lookup"><span data-stu-id="fea7c-560">Office 365 endpoints FAQ</span></span>](https://support.office.com/article/d4088321-1c89-4b96-9c99-54c75cae2e6d)