---
title: 使用邮件流规则阻止带有可执行附件的邮件
f1.keywords:
- NOCSH
ms.author: chrisda
author: chrisda
manager: dansimp
ms.date: ''
audience: ITPro
ms.topic: how-to
localization_priority: Normal
ms.assetid: c4fb4a86-b772-49d0-8773-e8ee897e175d
ms.custom:
- seo-marvel-apr2020
description: 管理员可以了解如何创建邮件流规则 (传输规则) 包含可执行附件的邮件。
ms.technology: mdo
ms.prod: m365-security
ms.openlocfilehash: 012557b2e0e34cdafd33c2d4a8291283dbd5e35c
ms.sourcegitcommit: 956176ed7c8b8427fdc655abcd1709d86da9447e
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/23/2021
ms.locfileid: "51056179"
---
# <a name="use-mail-flow-rules-to-block-messages-with-executable-attachments-in-eop"></a><span data-ttu-id="f6e44-103">在 EOP 中使用邮件流规则阻止带可执行附件的邮件</span><span class="sxs-lookup"><span data-stu-id="f6e44-103">Use mail flow rules to block messages with executable attachments in EOP</span></span>

[!INCLUDE [Microsoft 365 Defender rebranding](../includes/microsoft-defender-for-office.md)]

<span data-ttu-id="f6e44-104">**适用对象**</span><span class="sxs-lookup"><span data-stu-id="f6e44-104">**Applies to**</span></span>
- [<span data-ttu-id="f6e44-105">Exchange Online Protection</span><span class="sxs-lookup"><span data-stu-id="f6e44-105">Exchange Online Protection</span></span>](exchange-online-protection-overview.md)
- [<span data-ttu-id="f6e44-106">Microsoft Defender for Office 365 计划 1 和计划 2</span><span class="sxs-lookup"><span data-stu-id="f6e44-106">Microsoft Defender for Office 365 plan 1 and plan 2</span></span>](defender-for-office-365.md)
- [<span data-ttu-id="f6e44-107">Microsoft 365 Defender</span><span class="sxs-lookup"><span data-stu-id="f6e44-107">Microsoft 365 Defender</span></span>](../defender/microsoft-365-defender.md)

<span data-ttu-id="f6e44-108">在邮箱在 Exchange Online 或独立 Exchange Online Protection (EOP) 组织中没有 Exchange Online 邮箱的 Microsoft 365 组织中，EOP 使用反恶意软件策略来阻止有害的邮件，包括带有可执行附件的邮件。</span><span class="sxs-lookup"><span data-stu-id="f6e44-108">In Microsoft 365 organizations with mailboxes in Exchange Online or standalone Exchange Online Protection (EOP) organizations without Exchange Online mailboxes, EOP uses anti-malware policies to block harmful messages, including messages with executable attachments.</span></span> <span data-ttu-id="f6e44-109">有关详细信息，请参阅 EOP 中的反 [恶意软件保护](anti-malware-protection.md)。</span><span class="sxs-lookup"><span data-stu-id="f6e44-109">For more information, see [Anti-malware protection in EOP](anti-malware-protection.md).</span></span>

<span data-ttu-id="f6e44-110">若要进一步增强保护，可以使用邮件流规则 (传输规则) 标识和阻止包含可执行附件的邮件，如本文所述。</span><span class="sxs-lookup"><span data-stu-id="f6e44-110">To further enhance protection, you can use mail flow rules (also known as transport rules) to identify and block messages that contain executable attachments as described in this article.</span></span>

<span data-ttu-id="f6e44-111">例如，恶意软件爆发后，公司可以应用此具有时间限制的规则，以便受影响的用户可以在指定的时间长度后重新发送附件。</span><span class="sxs-lookup"><span data-stu-id="f6e44-111">For example, following a malware outbreak, a company could apply this rule with a time limit so that affected users can get back to sending attachments after a specified length of time.</span></span>

## <a name="what-do-you-need-to-know-before-you-begin"></a><span data-ttu-id="f6e44-112">开始前，有必要了解什么？</span><span class="sxs-lookup"><span data-stu-id="f6e44-112">What do you need to know before you begin?</span></span>

- <span data-ttu-id="f6e44-113">您需在 Exchange Online 或 Exchange Online Protection 中分配权限，然后才能执行本文中的过程。</span><span class="sxs-lookup"><span data-stu-id="f6e44-113">You need to be assigned permissions in Exchange Online or Exchange Online Protection before you can do the procedures in this article.</span></span> <span data-ttu-id="f6e44-114">具体来说，您需要传输 **规则** 角色，该角色默认分配给组织管理、合规性管理和 **记录** 管理角色组。</span><span class="sxs-lookup"><span data-stu-id="f6e44-114">Specifically, you need the **Transport Rules** role, which is assigned to the **Organization Management**, **Compliance Management**, and **Records Management** role groups by default.</span></span>

  <span data-ttu-id="f6e44-115">有关详细信息，请参阅下列主题：</span><span class="sxs-lookup"><span data-stu-id="f6e44-115">For more information, see the following topics:</span></span>

  - [<span data-ttu-id="f6e44-116">Exchange Online 中的权限</span><span class="sxs-lookup"><span data-stu-id="f6e44-116">Permissions in Exchange Online</span></span>](/exchange/permissions-exo/permissions-exo)
  - [<span data-ttu-id="f6e44-117">独立 EOP 中的权限</span><span class="sxs-lookup"><span data-stu-id="f6e44-117">Permissions in standalone EOP</span></span>](feature-permissions-in-eop.md)
  - [<span data-ttu-id="f6e44-118">使用 EAC 修改角色组的成员列表</span><span class="sxs-lookup"><span data-stu-id="f6e44-118">Use the EAC modify the list of members in role groups</span></span>](manage-admin-role-group-permissions-in-eop.md#use-the-eac-modify-the-list-of-members-in-role-groups)

- <span data-ttu-id="f6e44-119">若要在 Exchange Online 中打开 EAC，请参阅 [Exchange Online 中的 Exchange 管理中心](/Exchange/exchange-admin-center)。</span><span class="sxs-lookup"><span data-stu-id="f6e44-119">To open the EAC in Exchange Online, see [Exchange admin center in Exchange Online](/Exchange/exchange-admin-center).</span></span> <span data-ttu-id="f6e44-120">若要在独立 EOP 中打开 EAC，请参阅 [独立 EOP 中的 Exchange 管理中心](exchange-admin-center-in-exchange-online-protection-eop.md)。</span><span class="sxs-lookup"><span data-stu-id="f6e44-120">To open the EAC in standalone EOP, see [Exchange admin center in standalone EOP](exchange-admin-center-in-exchange-online-protection-eop.md).</span></span>

- <span data-ttu-id="f6e44-121">若要连接到 Exchange Online PowerShell，请参阅[连接到 Exchange Online PowerShell](/powershell/exchange/connect-to-exchange-online-powershell)。</span><span class="sxs-lookup"><span data-stu-id="f6e44-121">To connect to Exchange Online PowerShell, see [Connect to Exchange Online PowerShell](/powershell/exchange/connect-to-exchange-online-powershell).</span></span> <span data-ttu-id="f6e44-122">若要连接到独立 EOP PowerShell，请参阅[连接到 Exchange Online Protection PowerShell](/powershell/exchange/connect-to-exchange-online-protection-powershell)。</span><span class="sxs-lookup"><span data-stu-id="f6e44-122">To connect to standalone EOP PowerShell, see [Connect to Exchange Online Protection PowerShell](/powershell/exchange/connect-to-exchange-online-protection-powershell).</span></span>

- <span data-ttu-id="f6e44-123">有关 Exchange Online 和独立 EOP 中的邮件流规则详细信息，请参阅下列主题：</span><span class="sxs-lookup"><span data-stu-id="f6e44-123">For more information about mail flow rules in Exchange Online and standalone EOP, see the following topics:</span></span>

  - [<span data-ttu-id="f6e44-124">Exchange Online 中的邮件流规则（传输规则）</span><span class="sxs-lookup"><span data-stu-id="f6e44-124">Mail flow rules (transport rules) in Exchange Online</span></span>](/Exchange/security-and-compliance/mail-flow-rules/mail-flow-rules)

  - [<span data-ttu-id="f6e44-125">Exchange Online 中的邮件流规则 (和) 谓词</span><span class="sxs-lookup"><span data-stu-id="f6e44-125">Mail flow rule conditions and exceptions (predicates) in Exchange Online</span></span>](/Exchange/security-and-compliance/mail-flow-rules/conditions-and-exceptions)

  - [<span data-ttu-id="f6e44-126">Exchange Online 中的邮件流规则操作</span><span class="sxs-lookup"><span data-stu-id="f6e44-126">Mail flow rule actions in Exchange Online</span></span>](/Exchange/security-and-compliance/mail-flow-rules/mail-flow-rule-actions)

## <a name="use-the-eac-to-create-a-rule-that-blocks-messages-with-executable-attachments"></a><span data-ttu-id="f6e44-127">使用 EAC 创建阻止带有可执行附件的邮件的规则</span><span class="sxs-lookup"><span data-stu-id="f6e44-127">Use the EAC to create a rule that blocks messages with executable attachments</span></span>

1. <span data-ttu-id="f6e44-128">In the EAC, go to **Mail flow** \> **Rules**.</span><span class="sxs-lookup"><span data-stu-id="f6e44-128">In the EAC, go to **Mail flow** \> **Rules**.</span></span>

2. <span data-ttu-id="f6e44-129">单击 **添加** ![ 添加图标 ](../../media/ITPro-EAC-AddIcon.png) ，然后选择 **创建新规则**。</span><span class="sxs-lookup"><span data-stu-id="f6e44-129">Click **Add** ![Add icon](../../media/ITPro-EAC-AddIcon.png) and then select **Create a new rule**.</span></span>

3. <span data-ttu-id="f6e44-130">在打开的" **新规则**"窗口中，配置以下设置：</span><span class="sxs-lookup"><span data-stu-id="f6e44-130">In the **New rule** page that opens, configure the following settings:</span></span>

   - <span data-ttu-id="f6e44-131">**名称**：输入规则的唯一描述性名称。</span><span class="sxs-lookup"><span data-stu-id="f6e44-131">**Name**: Enter a unique, descriptive name for the rule.</span></span>

   - <span data-ttu-id="f6e44-132">单击“其他选项”。</span><span class="sxs-lookup"><span data-stu-id="f6e44-132">Click **More Options**.</span></span>

   - <span data-ttu-id="f6e44-133">**在 ：选择"** 任何 **附件具有可执行** \> **内容"时应用此规则**。</span><span class="sxs-lookup"><span data-stu-id="f6e44-133">**Apply this rule if**: Select **Any attachment** \> **has executable content**.</span></span>

   - <span data-ttu-id="f6e44-134">**执行以下操作：** 选择 **"阻止邮件** "，然后选择需要的操作：</span><span class="sxs-lookup"><span data-stu-id="f6e44-134">**Do the following**: Select **Block the message** and then choose the action you want:</span></span>

     - <span data-ttu-id="f6e44-135">拒绝邮件并包含说明：在出现的"指定拒绝原因"对话框中，输入您希望在未送达报告 (也称为 NDR 或退回邮件) 。</span><span class="sxs-lookup"><span data-stu-id="f6e44-135">**reject the message and include an explanation**: In the **Specify reject reason** dialog that appears, enter the text you want to appear in the non-delivery report (also known as an NDR or bounce message).</span></span> <span data-ttu-id="f6e44-136">使用的默认增强状态代码是 5.7.1。</span><span class="sxs-lookup"><span data-stu-id="f6e44-136">The default enhanced status code that's used is 5.7.1.</span></span>

     - <span data-ttu-id="f6e44-137">**拒绝具有增强** 状态代码的邮件：在出现的"输入增强状态代码"对话框中，输入要显示在 NDR 中的增强状态代码。</span><span class="sxs-lookup"><span data-stu-id="f6e44-137">**reject the message with the enhanced status code of**:  In the **Enter enhanced status code** dialog that appears, enter the enhanced status code that you want to appear in the NDR.</span></span> <span data-ttu-id="f6e44-138">有效值为 5.7.1 或 5.7.900 到 5.7.999。</span><span class="sxs-lookup"><span data-stu-id="f6e44-138">Valid values are 5.7.1 or a value from 5.7.900 to 5.7.999.</span></span> <span data-ttu-id="f6e44-139">默认拒绝文本为：传递未授权，邮件被拒绝。</span><span class="sxs-lookup"><span data-stu-id="f6e44-139">The default rejection text is: Delivery not authorized, message refused.</span></span>

     - <span data-ttu-id="f6e44-140">**拒绝邮件而不通知任何人**</span><span class="sxs-lookup"><span data-stu-id="f6e44-140">**reject the message without notifying anyone**</span></span>

4. <span data-ttu-id="f6e44-141">完成后，单击“保存”。</span><span class="sxs-lookup"><span data-stu-id="f6e44-141">When you're finished, click **Save**.</span></span> <span data-ttu-id="f6e44-142">您的附件阻止规则现在开始强制执行。</span><span class="sxs-lookup"><span data-stu-id="f6e44-142">Your attachment blocking rule is now in force.</span></span>

## <a name="use-powershell-to-create-a-rule-that-blocks-messages-with-executable-attachments"></a><span data-ttu-id="f6e44-143">使用 PowerShell 创建阻止带有可执行附件的邮件的规则</span><span class="sxs-lookup"><span data-stu-id="f6e44-143">Use PowerShell to create a rule that blocks messages with executable attachments</span></span>

<span data-ttu-id="f6e44-144">使用以下语法创建规则以阻止包含可执行附件的邮件：</span><span class="sxs-lookup"><span data-stu-id="f6e44-144">Use the following syntax to create a rule to blocks messages that contain executable attachments:</span></span>

```powershell
New-TransportRule -Name "<UniqueName>" -AttachmentHasExecutableContent $true [-RejectMessageEnhancedStatusCode <5.7.1 | 5.7.900 to 5.7.999>] [-RejectMessageReasonText "<Text>"] [-DeleteMessage $true]
```

<span data-ttu-id="f6e44-145">**注意**：</span><span class="sxs-lookup"><span data-stu-id="f6e44-145">**Notes**:</span></span>

- <span data-ttu-id="f6e44-146">如果使用不带 _RejectMessageReasonText_ 参数的 _RejectMessageEnhancedStatusCode_ 参数，则默认文本为：Delivery not authorized， message refused。</span><span class="sxs-lookup"><span data-stu-id="f6e44-146">If you use the _RejectMessageEnhancedStatusCode_ parameter without the _RejectMessageReasonText_ parameter, the default text is: Delivery not authorized, message refused.</span></span>

- <span data-ttu-id="f6e44-147">如果使用不带 _RejectMessageEnhancedStatusCode_ 参数的 _RejectMessageReasonText_ 参数，则默认代码为 5.7.1。</span><span class="sxs-lookup"><span data-stu-id="f6e44-147">If you use the _RejectMessageReasonText_ parameter without the _RejectMessageEnhancedStatusCode_ parameter, the default code is 5.7.1.</span></span>

<span data-ttu-id="f6e44-148">本示例创建一个名为"阻止可执行附件"的新规则，以静默方式删除包含可执行附件的邮件。</span><span class="sxs-lookup"><span data-stu-id="f6e44-148">This example creates a new rule named Block Executable Attachments that silently deletes messages that contain executable attachments.</span></span>

```powershell
New-TransportRule -Name "Block Executable Attachments" -AttachmentHasExecutableContent $true -DeleteMessage $true
```

<span data-ttu-id="f6e44-149">有关语法和参数的详细信息，请参阅 [New-TransportRule](/powershell/module/exchange/new-transportrule)。</span><span class="sxs-lookup"><span data-stu-id="f6e44-149">For detailed syntax and parameter information, see [New-TransportRule](/powershell/module/exchange/new-transportrule).</span></span>

## <a name="how-do-you-know-this-worked"></a><span data-ttu-id="f6e44-150">如何判断是否生效？</span><span class="sxs-lookup"><span data-stu-id="f6e44-150">How do you know this worked?</span></span>

<span data-ttu-id="f6e44-151">若要验证您是否已成功创建邮件流规则以阻止包含可执行附件的邮件，请执行下列任一步骤：</span><span class="sxs-lookup"><span data-stu-id="f6e44-151">To verify that you've successfully create a mail flow rule to block messages that contain executable attachments, do any of the following steps:</span></span>

- <span data-ttu-id="f6e44-152">在 EAC 中，转到"**邮件** 流""规则 \>  \> "选择规则单击" \> **编辑** ![ 编辑"图标 ](../../media/ITPro-EAC-EditIcon.png) ，然后验证设置。</span><span class="sxs-lookup"><span data-stu-id="f6e44-152">In the EAC, go to **Mail flow** \> **Rules** \> select the rule \> click **Edit** ![Edit icon](../../media/ITPro-EAC-EditIcon.png), and verify the settings.</span></span>

- <span data-ttu-id="f6e44-153">在 PowerShell 中，运行以下命令来验证设置：</span><span class="sxs-lookup"><span data-stu-id="f6e44-153">In PowerShell, run the following command to verify the settings:</span></span>

  ```powershell
  Get-TransportRule -Identity "<Rule Name>" | Format-List Name,AttachmentHasExecutableContent,RejectMessage*,DeleteMessage
  ```