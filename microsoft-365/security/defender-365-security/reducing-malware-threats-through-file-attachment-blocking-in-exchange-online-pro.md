---
title: 使用邮件流规则阻止带有可执行附件的邮件
f1.keywords:
- NOCSH
ms.author: chrisda
author: chrisda
manager: dansimp
ms.date: ''
audience: ITPro
ms.topic: how-to
localization_priority: Normal
ms.assetid: c4fb4a86-b772-49d0-8773-e8ee897e175d
ms.custom:
- seo-marvel-apr2020
description: 管理员可以了解如何创建邮件流规则 (传输规则) 包含可执行附件的邮件。
ms.technology: mdo
ms.prod: m365-security
ms.openlocfilehash: 012557b2e0e34cdafd33c2d4a8291283dbd5e35c
ms.sourcegitcommit: 956176ed7c8b8427fdc655abcd1709d86da9447e
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/23/2021
ms.locfileid: "51056179"
---
# <a name="use-mail-flow-rules-to-block-messages-with-executable-attachments-in-eop"></a>在 EOP 中使用邮件流规则阻止带可执行附件的邮件

[!INCLUDE [Microsoft 365 Defender rebranding](../includes/microsoft-defender-for-office.md)]

**适用对象**
- [Exchange Online Protection](exchange-online-protection-overview.md)
- [Microsoft Defender for Office 365 计划 1 和计划 2](defender-for-office-365.md)
- [Microsoft 365 Defender](../defender/microsoft-365-defender.md)

在邮箱在 Exchange Online 或独立 Exchange Online Protection (EOP) 组织中没有 Exchange Online 邮箱的 Microsoft 365 组织中，EOP 使用反恶意软件策略来阻止有害的邮件，包括带有可执行附件的邮件。 有关详细信息，请参阅 EOP 中的反 [恶意软件保护](anti-malware-protection.md)。

若要进一步增强保护，可以使用邮件流规则 (传输规则) 标识和阻止包含可执行附件的邮件，如本文所述。

例如，恶意软件爆发后，公司可以应用此具有时间限制的规则，以便受影响的用户可以在指定的时间长度后重新发送附件。

## <a name="what-do-you-need-to-know-before-you-begin"></a>开始前，有必要了解什么？

- 您需在 Exchange Online 或 Exchange Online Protection 中分配权限，然后才能执行本文中的过程。 具体来说，您需要传输 **规则** 角色，该角色默认分配给组织管理、合规性管理和 **记录** 管理角色组。

  有关详细信息，请参阅下列主题：

  - [Exchange Online 中的权限](/exchange/permissions-exo/permissions-exo)
  - [独立 EOP 中的权限](feature-permissions-in-eop.md)
  - [使用 EAC 修改角色组的成员列表](manage-admin-role-group-permissions-in-eop.md#use-the-eac-modify-the-list-of-members-in-role-groups)

- 若要在 Exchange Online 中打开 EAC，请参阅 [Exchange Online 中的 Exchange 管理中心](/Exchange/exchange-admin-center)。 若要在独立 EOP 中打开 EAC，请参阅 [独立 EOP 中的 Exchange 管理中心](exchange-admin-center-in-exchange-online-protection-eop.md)。

- 若要连接到 Exchange Online PowerShell，请参阅[连接到 Exchange Online PowerShell](/powershell/exchange/connect-to-exchange-online-powershell)。 若要连接到独立 EOP PowerShell，请参阅[连接到 Exchange Online Protection PowerShell](/powershell/exchange/connect-to-exchange-online-protection-powershell)。

- 有关 Exchange Online 和独立 EOP 中的邮件流规则详细信息，请参阅下列主题：

  - [Exchange Online 中的邮件流规则（传输规则）](/Exchange/security-and-compliance/mail-flow-rules/mail-flow-rules)

  - [Exchange Online 中的邮件流规则 (和) 谓词](/Exchange/security-and-compliance/mail-flow-rules/conditions-and-exceptions)

  - [Exchange Online 中的邮件流规则操作](/Exchange/security-and-compliance/mail-flow-rules/mail-flow-rule-actions)

## <a name="use-the-eac-to-create-a-rule-that-blocks-messages-with-executable-attachments"></a>使用 EAC 创建阻止带有可执行附件的邮件的规则

1. In the EAC, go to **Mail flow** \> **Rules**.

2. 单击 **添加** ![ 添加图标 ](../../media/ITPro-EAC-AddIcon.png) ，然后选择 **创建新规则**。

3. 在打开的" **新规则**"窗口中，配置以下设置：

   - **名称**：输入规则的唯一描述性名称。

   - 单击“其他选项”。

   - **在 ：选择"** 任何 **附件具有可执行** \> **内容"时应用此规则**。

   - **执行以下操作：** 选择 **"阻止邮件** "，然后选择需要的操作：

     - 拒绝邮件并包含说明：在出现的"指定拒绝原因"对话框中，输入您希望在未送达报告 (也称为 NDR 或退回邮件) 。 使用的默认增强状态代码是 5.7.1。

     - **拒绝具有增强** 状态代码的邮件：在出现的"输入增强状态代码"对话框中，输入要显示在 NDR 中的增强状态代码。 有效值为 5.7.1 或 5.7.900 到 5.7.999。 默认拒绝文本为：传递未授权，邮件被拒绝。

     - **拒绝邮件而不通知任何人**

4. 完成后，单击“保存”。 您的附件阻止规则现在开始强制执行。

## <a name="use-powershell-to-create-a-rule-that-blocks-messages-with-executable-attachments"></a>使用 PowerShell 创建阻止带有可执行附件的邮件的规则

使用以下语法创建规则以阻止包含可执行附件的邮件：

```powershell
New-TransportRule -Name "<UniqueName>" -AttachmentHasExecutableContent $true [-RejectMessageEnhancedStatusCode <5.7.1 | 5.7.900 to 5.7.999>] [-RejectMessageReasonText "<Text>"] [-DeleteMessage $true]
```

**注意**：

- 如果使用不带 _RejectMessageReasonText_ 参数的 _RejectMessageEnhancedStatusCode_ 参数，则默认文本为：Delivery not authorized， message refused。

- 如果使用不带 _RejectMessageEnhancedStatusCode_ 参数的 _RejectMessageReasonText_ 参数，则默认代码为 5.7.1。

本示例创建一个名为"阻止可执行附件"的新规则，以静默方式删除包含可执行附件的邮件。

```powershell
New-TransportRule -Name "Block Executable Attachments" -AttachmentHasExecutableContent $true -DeleteMessage $true
```

有关语法和参数的详细信息，请参阅 [New-TransportRule](/powershell/module/exchange/new-transportrule)。

## <a name="how-do-you-know-this-worked"></a>如何判断是否生效？

若要验证您是否已成功创建邮件流规则以阻止包含可执行附件的邮件，请执行下列任一步骤：

- 在 EAC 中，转到"**邮件** 流""规则 \>  \> "选择规则单击" \> **编辑** ![ 编辑"图标 ](../../media/ITPro-EAC-EditIcon.png) ，然后验证设置。

- 在 PowerShell 中，运行以下命令来验证设置：

  ```powershell
  Get-TransportRule -Identity "<Rule Name>" | Format-List Name,AttachmentHasExecutableContent,RejectMessage*,DeleteMessage
  ```