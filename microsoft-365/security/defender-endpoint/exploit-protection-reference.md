---
title: 漏洞保护参考
keywords: 缓解， 漏洞， 漏洞， 缓解， 攻击， 攻击， emet
description: 有关 Exploit Protection 功能如何工作的详细信息Windows 10
search.product: eADQiWindows 10XVcnh
ms.pagetype: security
ms.prod: m365-security
ms.mktglfcycl: manage
ms.sitesec: library
localization_priority: Normal
audience: ITPro
author: denisebmsft
ms.author: deniseb
ms.date: 01/06/2021
ms.reviewer: cjacks
manager: dansimp
ms.custom: asr
ms.technology: mde
ms.topic: article
ms.openlocfilehash: 7300ed2a4dc2623a8f936006ce7de3a5204712f0
ms.sourcegitcommit: 4fb1226d5875bf5b9b29252596855a6562cea9ae
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 06/08/2021
ms.locfileid: "52844535"
---
# <a name="exploit-protection-reference"></a><span data-ttu-id="ac58d-104">Exploit Protection 参考</span><span class="sxs-lookup"><span data-stu-id="ac58d-104">Exploit Protection Reference</span></span>

[!INCLUDE [Microsoft 365 Defender rebranding](../../includes/microsoft-defender.md)]


<span data-ttu-id="ac58d-105">**适用于：**</span><span class="sxs-lookup"><span data-stu-id="ac58d-105">**Applies to:**</span></span>
- [<span data-ttu-id="ac58d-106">Microsoft Defender for Endpoint</span><span class="sxs-lookup"><span data-stu-id="ac58d-106">Microsoft Defender for Endpoint</span></span>](https://go.microsoft.com/fwlink/?linkid=2154037)
- [<span data-ttu-id="ac58d-107">Microsoft 365 Defender</span><span class="sxs-lookup"><span data-stu-id="ac58d-107">Microsoft 365 Defender</span></span>](https://go.microsoft.com/fwlink/?linkid=2118804)

><span data-ttu-id="ac58d-108">想要体验 Microsoft Defender for Endpoint？</span><span class="sxs-lookup"><span data-stu-id="ac58d-108">Want to experience Microsoft Defender for Endpoint?</span></span> [<span data-ttu-id="ac58d-109">注册免费试用版。</span><span class="sxs-lookup"><span data-stu-id="ac58d-109">Sign up for a free trial.</span></span>](https://www.microsoft.com/microsoft-365/windows/microsoft-defender-atp?ocid=docs-wdatp-enablesiem-abovefoldlink)

<span data-ttu-id="ac58d-110">Exploit Protection 为 IT 部门在编译和分发软件Pro应用的高级保护。</span><span class="sxs-lookup"><span data-stu-id="ac58d-110">Exploit protection provides advanced protections for applications that the IT Pro can apply after the developer has compiled and distributed the software.</span></span>

<span data-ttu-id="ac58d-111">本文将帮助你了解 Exploit Protection 在策略级别和个别缓解级别的工作方式，以帮助你成功构建和应用 Exploit Protection 策略。</span><span class="sxs-lookup"><span data-stu-id="ac58d-111">This article helps you understand how exploit protection works, both at the policy level and at the individual mitigation level, to help you successfully build and apply Exploit Protection policies.</span></span>

## <a name="how-mitigations-are-applied"></a><span data-ttu-id="ac58d-112">如何应用缓解</span><span class="sxs-lookup"><span data-stu-id="ac58d-112">How mitigations are applied</span></span>

<span data-ttu-id="ac58d-113">Exploit Protection 缓解适用于每个应用程序。</span><span class="sxs-lookup"><span data-stu-id="ac58d-113">Exploit Protection mitigations are applied per application.</span></span>

<span data-ttu-id="ac58d-114">缓解通过为每个配置保护的程序的注册表项进行配置。</span><span class="sxs-lookup"><span data-stu-id="ac58d-114">Mitigations are configured via a registry entry for each program that you configure protections for.</span></span> <span data-ttu-id="ac58d-115">这些设置存储在每个程序 (HKEY_LOCAL_MACHINE \ SOFTWARE \ Microsoft \ Windows NT **\ CurrentVersion \ Image File Execution Options \ *ImageFileName* \ MitigationOptions**) 的 **MitigationOptions** 注册表项中。</span><span class="sxs-lookup"><span data-stu-id="ac58d-115">These settings are stored in the **MitigationOptions** registry entry for each program (**HKEY_LOCAL_MACHINE \ SOFTWARE \ Microsoft \ Windows NT \ CurrentVersion \ Image File Execution Options \ *ImageFileName* \ MitigationOptions**).</span></span> <span data-ttu-id="ac58d-116">它们在您重新启动程序后生效，并一直有效，直到您更改它们并再次重新启动该程序。</span><span class="sxs-lookup"><span data-stu-id="ac58d-116">They take effect when you restart the program and remain effective until you change them and restart the program again.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="ac58d-117">Image File Execution Options only allows you to specify a file name or path， not a version number， architecture， or any other differentiator.</span><span class="sxs-lookup"><span data-stu-id="ac58d-117">Image File Execution Options only allows you to specify a file name or path, and not a version number, architecture, or any other differentiator.</span></span> <span data-ttu-id="ac58d-118">注意将缓解目标定向到具有唯一名称或路径的应用，仅将其应用到已测试该版本和应用程序的该体系结构的设备上。</span><span class="sxs-lookup"><span data-stu-id="ac58d-118">Be careful to target mitigations to apps which have unique names or paths, applying them only on devices where you have tested that version and that architecture of the application.</span></span>

<span data-ttu-id="ac58d-119">如果使用 XML 配置文件（通过 PowerShell、组策略或 MDM）配置 Exploit Protection 缓解，在处理此 XML 配置文件时，将针对你配置各个注册表设置。</span><span class="sxs-lookup"><span data-stu-id="ac58d-119">If you configure exploit protection mitigations using an XML configuration file, either via PowerShell, Group Policy, or MDM, when processing this XML configuration file, individual registry settings will be configured for you.</span></span>

<span data-ttu-id="ac58d-120">当不再强制执行分发 XML 文件的策略时，不会自动删除此 XML 配置文件部署的设置。</span><span class="sxs-lookup"><span data-stu-id="ac58d-120">When the policy distributing the XML file is no longer enforced, settings deployed by this XML configuration file will not be automatically removed.</span></span> <span data-ttu-id="ac58d-121">若要删除 Exploit Protection 设置，请从干净Windows 10 XML 配置，并部署此新的 XML 文件。</span><span class="sxs-lookup"><span data-stu-id="ac58d-121">To remove Exploit Protection settings, export the XML configuration from a clean Windows 10 device, and deploy this new XML file.</span></span> <span data-ttu-id="ac58d-122">此外，Microsoft 还提供 XML 文件作为重置 exploit Protection Windows 安全中心基线的一部分。</span><span class="sxs-lookup"><span data-stu-id="ac58d-122">Alternately, Microsoft provides an XML file as part of the Windows Security Baselines for resetting Exploit Protection settings.</span></span>

<span data-ttu-id="ac58d-123">若要使用 PowerShell 重置 Exploit Protection 设置，可以使用以下命令：</span><span class="sxs-lookup"><span data-stu-id="ac58d-123">To reset exploit protection settings using PowerShell, you could use the following command:</span></span>

```powershell
Set-ProcessMitigation -PolicyFilePath EP-reset.xml
```
<span data-ttu-id="ac58d-124">下面是随EP-reset.xml比较基准Windows 安全中心分布的比较基准：</span><span class="sxs-lookup"><span data-stu-id="ac58d-124">Following is the EP-reset.xml distributed with the Windows Security Baselines:</span></span>
```xml
<?xml version="1.0" encoding="UTF-8"?>
<MitigationPolicy>
  <AppConfig Executable="ONEDRIVE.EXE">
    <DEP OverrideDEP="false" />
    <ASLR OverrideRelocateImages="false" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
    <ImageLoad OverrideBlockRemoteImages="false" />
  </AppConfig>
  <AppConfig Executable="firefox.exe">
    <DEP OverrideDEP="false" />
    <ASLR ForceRelocateImages="true" />
  </AppConfig>
  <AppConfig Executable="fltldr.exe">
    <DEP OverrideDEP="false" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
    <ImageLoad OverrideBlockRemoteImages="false" />
    <ChildProcess OverrideChildProcess="false" />
  </AppConfig>
  <AppConfig Executable="GROOVE.EXE">
    <DEP OverrideDEP="false" />
    <ASLR ForceRelocateImages="true" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
    <ImageLoad OverrideBlockRemoteImages="false" />
    <ChildProcess OverrideChildProcess="false" />
  </AppConfig>
  <AppConfig Executable="Acrobat.exe">
    <DEP OverrideDEP="false" />
    <ASLR ForceRelocateImages="true" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
  <AppConfig Executable="AcroRd32.exe">
    <DEP OverrideDEP="false" />
    <ASLR ForceRelocateImages="true" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
  <AppConfig Executable="chrome.exe">
    <DEP OverrideDEP="false" />
  </AppConfig>
  <AppConfig Executable="EXCEL.EXE">
    <DEP OverrideDEP="false" />
    <ASLR ForceRelocateImages="true" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
  <AppConfig Executable="iexplore.exe">
    <DEP OverrideDEP="false" />
    <ASLR ForceRelocateImages="true" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
  <AppConfig Executable="INFOPATH.EXE">
    <DEP OverrideDEP="false" />
    <ASLR ForceRelocateImages="true" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
  <AppConfig Executable="java.exe">
    <DEP OverrideDEP="false" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
  <AppConfig Executable="javaw.exe">
    <DEP OverrideDEP="false" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
  <AppConfig Executable="javaws.exe">
    <DEP OverrideDEP="false" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
  <AppConfig Executable="LYNC.EXE">
    <DEP OverrideDEP="false" />
    <ASLR ForceRelocateImages="true" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
  <AppConfig Executable="MSACCESS.EXE">
    <DEP OverrideDEP="false" />
    <ASLR ForceRelocateImages="true" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
  <AppConfig Executable="MSPUB.EXE">
    <DEP OverrideDEP="false" />
    <ASLR ForceRelocateImages="true" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
  <AppConfig Executable="OIS.EXE">
    <DEP OverrideDEP="false" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
  <AppConfig Executable="OUTLOOK.EXE">
    <DEP OverrideDEP="false" />
    <ASLR ForceRelocateImages="true" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
  <AppConfig Executable="plugin-container.exe">
    <DEP OverrideDEP="false" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
  <AppConfig Executable="POWERPNT.EXE">
    <DEP OverrideDEP="false" />
    <ASLR ForceRelocateImages="true" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
  <AppConfig Executable="PPTVIEW.EXE">
    <DEP OverrideDEP="false" />
    <ASLR ForceRelocateImages="true" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
  <AppConfig Executable="VISIO.EXE">
    <DEP OverrideDEP="false" />
    <ASLR ForceRelocateImages="true" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
  <AppConfig Executable="VPREVIEW.EXE">
    <DEP OverrideDEP="false" />
    <ASLR ForceRelocateImages="true" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
  <AppConfig Executable="WINWORD.EXE">
    <DEP OverrideDEP="false" />
    <ASLR ForceRelocateImages="true" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
  <AppConfig Executable="wmplayer.exe">
    <DEP OverrideDEP="false" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
  <AppConfig Executable="wordpad.exe">
    <DEP OverrideDEP="false" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
</MitigationPolicy>
```

## <a name="mitigation-reference"></a><span data-ttu-id="ac58d-125">缓解参考</span><span class="sxs-lookup"><span data-stu-id="ac58d-125">Mitigation Reference</span></span>

<span data-ttu-id="ac58d-126">以下各节详细介绍了每个 Exploit Protection 缓解所提供的保护、缓解的兼容性注意事项以及可用的配置选项。</span><span class="sxs-lookup"><span data-stu-id="ac58d-126">The following sections detail the protections provided by each exploit protection mitigation, the compatibility considerations for the mitigation, and the configuration options available.</span></span>

## <a name="arbitrary-code-guard"></a><span data-ttu-id="ac58d-127">任意代码保护</span><span class="sxs-lookup"><span data-stu-id="ac58d-127">Arbitrary code guard</span></span>

### <a name="description"></a><span data-ttu-id="ac58d-128">说明</span><span class="sxs-lookup"><span data-stu-id="ac58d-128">Description</span></span>

<span data-ttu-id="ac58d-129">任意代码防护可帮助防止恶意攻击者通过内存安全漏洞将所选择的代码加载到内存中，并能够执行该代码。</span><span class="sxs-lookup"><span data-stu-id="ac58d-129">Arbitrary code guard helps protect against a malicious attacker loading the code of their choice into memory through a memory safety vulnerability and being able to execute that code.</span></span>

<span data-ttu-id="ac58d-130">任意代码保护保护应用程序，防止在未加载（例如，来自 exe 本身或 dll (）的代码中执行动态生成的) 。</span><span class="sxs-lookup"><span data-stu-id="ac58d-130">Arbitrary code guard protects an application from executing dynamically generated code (code that is not loaded, for example, from the exe itself or a dll).</span></span> <span data-ttu-id="ac58d-131">任意代码保护通过阻止内存标记为可执行文件来工作。</span><span class="sxs-lookup"><span data-stu-id="ac58d-131">Arbitrary code guard works by preventing memory from being marked as executable.</span></span> <span data-ttu-id="ac58d-132">当应用程序尝试分配 [内存时](/windows/win32/api/memoryapi/nf-memoryapi-virtualalloc)，我们将检查保护标志。</span><span class="sxs-lookup"><span data-stu-id="ac58d-132">When an application attempts to [allocate memory](/windows/win32/api/memoryapi/nf-memoryapi-virtualalloc), we check the protection flags.</span></span> <span data-ttu-id="ac58d-133"> (内存可以使用读取、写入和/或执行保护标志进行分配。) 如果分配尝试包含执行保护标志，则内存分配失败，并返回[](/windows/win32/memory/memory-protection-constants)错误代码 (STATUS_DYNAMIC_CODE_BLOCKED) 。</span><span class="sxs-lookup"><span data-stu-id="ac58d-133">(Memory can be allocated with read, write, and/or execute protection flags.) If the allocation attempts to include the [*execute*](/windows/win32/memory/memory-protection-constants) protection flag, then the memory allocation fails and returns an error code (STATUS_DYNAMIC_CODE_BLOCKED).</span></span> <span data-ttu-id="ac58d-134">同样，如果应用程序尝试更改已分配[](/windows/win32/api/memoryapi/nf-memoryapi-virtualprotect)并包括执行保护标志的内存的保护标志，则权限更改将失败，[](/windows/win32/memory/memory-protection-constants)并返回错误代码 (STATUS_DYNAMIC_CODE_BLOCKED) 。</span><span class="sxs-lookup"><span data-stu-id="ac58d-134">Similarly, if an application attempts to [change the protection flags of memory](/windows/win32/api/memoryapi/nf-memoryapi-virtualprotect) that has already been allocated and includes the [*execute*](/windows/win32/memory/memory-protection-constants) protection flag, then the permission change fails and returns an error code (STATUS_DYNAMIC_CODE_BLOCKED).</span></span>

<span data-ttu-id="ac58d-135">通过阻止 *设置执行* 标志，Windows 10数据执行保护功能可以针对被设置为该内存并运行该代码的指令指针进行保护。</span><span class="sxs-lookup"><span data-stu-id="ac58d-135">By preventing the *execute* flag from being set, the data execution prevention feature of Windows 10 can then protect against the instruction pointer being set to that memory and running that code.</span></span>

### <a name="compatibility-considerations"></a><span data-ttu-id="ac58d-136">兼容性注意事项</span><span class="sxs-lookup"><span data-stu-id="ac58d-136">Compatibility considerations</span></span>

<span data-ttu-id="ac58d-137">任意代码保护会阻止将任何内存分配为可执行文件，这给 JIT 编译器等方法 (兼容性) 问题。</span><span class="sxs-lookup"><span data-stu-id="ac58d-137">Arbitrary code guard prevents allocating any memory as executable, which presents a compatibility issue with approaches such as Just-in-Time (JIT) compilers.</span></span> <span data-ttu-id="ac58d-138">例如，大多数新式浏览器都会将 JavaScript 编译为本机代码，以优化性能。</span><span class="sxs-lookup"><span data-stu-id="ac58d-138">Most modern browsers, for example, will compile JavaScript into native code in order to optimize performance.</span></span> <span data-ttu-id="ac58d-139">为了支持此缓解，需要重新检测它们，以将 JIT 编译移动到受保护进程之外。</span><span class="sxs-lookup"><span data-stu-id="ac58d-139">In order to support this mitigation, they will need to be rearchitected to move the JIT compilation outside of the protected process.</span></span> <span data-ttu-id="ac58d-140">其设计从脚本或其他中间语言动态生成代码的其他应用程序与此缓解类似不兼容。</span><span class="sxs-lookup"><span data-stu-id="ac58d-140">Other applications whose design dynamically generates code from scripts or other intermediate languages will be similarly incompatible with this mitigation.</span></span>

### <a name="configuration-options"></a><span data-ttu-id="ac58d-141">配置选项</span><span class="sxs-lookup"><span data-stu-id="ac58d-141">Configuration options</span></span>

<span data-ttu-id="ac58d-142">**允许线程退出** - 你可以配置缓解以允许单个线程选择退出此保护。</span><span class="sxs-lookup"><span data-stu-id="ac58d-142">**Allow thread opt-out** - You can configure the mitigation to allow an individual thread to opt-out of this protection.</span></span> <span data-ttu-id="ac58d-143">开发人员必须已编写了解此缓解的应用程序，并且已调用 [**SetThreadInformation**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-setthreadinformation) API，将 *ThreadInformation* 参数设置为 **ThreadDynamicCodePolicy，** 以便允许在此线程上执行动态代码。</span><span class="sxs-lookup"><span data-stu-id="ac58d-143">The developer must have written the application with awareness of this mitigation, and have called the [**SetThreadInformation**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-setthreadinformation) API with the *ThreadInformation* parameter set to **ThreadDynamicCodePolicy** in order to be allowed to execute dynamic code on this thread.</span></span>

<span data-ttu-id="ac58d-144">**仅审核** - 可以在审核模式下启用此缓解，以便衡量对应用程序的潜在兼容性影响。</span><span class="sxs-lookup"><span data-stu-id="ac58d-144">**Audit only** - You can enable this mitigation in audit mode in order to measure the potential compatibility impact on an application.</span></span> <span data-ttu-id="ac58d-145">然后，可以在事件查看器中或在 Defender for Endpoint 中使用高级搜寻 [来查看审核事件](/microsoft-365/security/defender/advanced-hunting-overview)。</span><span class="sxs-lookup"><span data-stu-id="ac58d-145">Audit events can then be viewed either in the event viewer or using Advanced Hunting in [Defender for Endpoint](/microsoft-365/security/defender/advanced-hunting-overview).</span></span>

## <a name="block-low-integrity-images"></a><span data-ttu-id="ac58d-146">阻止低完整性图像</span><span class="sxs-lookup"><span data-stu-id="ac58d-146">Block low integrity images</span></span>

### <a name="description"></a><span data-ttu-id="ac58d-147">说明</span><span class="sxs-lookup"><span data-stu-id="ac58d-147">Description</span></span>

<span data-ttu-id="ac58d-148">阻止低完整性图像会阻止应用程序加载不受信任的文件，通常是因为它们从沙盒浏览器从 Internet 下载。</span><span class="sxs-lookup"><span data-stu-id="ac58d-148">Block low integrity images prevents the application from loading files that are untrusted, typically because they have been downloaded from the internet from a sandboxed browser.</span></span>

<span data-ttu-id="ac58d-149">如果映像具有访问控制项 (ACE) 则此缓解将阻止映像加载) 该条目授予对低 IL 进程的访问权限，并且该进程没有信任标签 ACE。</span><span class="sxs-lookup"><span data-stu-id="ac58d-149">This mitigation will block image loads if the image has an Access Control Entry (ACE) which grants access to Low IL processes and which does not have a trust label ACE.</span></span> <span data-ttu-id="ac58d-150">它由内存管理器实现，它会阻止将文件映射到内存中。</span><span class="sxs-lookup"><span data-stu-id="ac58d-150">It is implemented by the memory manager, which blocks the file from being mapped into memory.</span></span> <span data-ttu-id="ac58d-151">如果应用程序尝试映射低完整性映像，它将触发STATUS_ACCESS_DENIED错误。</span><span class="sxs-lookup"><span data-stu-id="ac58d-151">If an application attempts to map a low integrity image, it will trigger a STATUS_ACCESS_DENIED error.</span></span> <span data-ttu-id="ac58d-152">有关完整性级别如何工作的详细信息，请参阅 [强制完整性控制](/windows/win32/secauthz/mandatory-integrity-control)。</span><span class="sxs-lookup"><span data-stu-id="ac58d-152">For details on how integrity levels work, see [Mandatory Integrity Control](/windows/win32/secauthz/mandatory-integrity-control).</span></span>

### <a name="compatibility-considerations"></a><span data-ttu-id="ac58d-153">兼容性注意事项</span><span class="sxs-lookup"><span data-stu-id="ac58d-153">Compatibility considerations</span></span>

<span data-ttu-id="ac58d-154">阻止低完整性映像将阻止应用程序加载从 Internet 下载的文件。</span><span class="sxs-lookup"><span data-stu-id="ac58d-154">Block low integrity images will prevent the application from loading files that were downloaded from the internet.</span></span> <span data-ttu-id="ac58d-155">如果应用程序工作流需要加载已下载的图像，则需要确保从高信任进程下载这些图像，或明确重新标记它们以应用此缓解。</span><span class="sxs-lookup"><span data-stu-id="ac58d-155">If your application workflow requires loading images that are downloaded, you will want to ensure that they are downloaded from a higher-trust process, or are explicitly relabeled in order to apply this mitigation.</span></span>

### <a name="configuration-options"></a><span data-ttu-id="ac58d-156">配置选项</span><span class="sxs-lookup"><span data-stu-id="ac58d-156">Configuration options</span></span>

<span data-ttu-id="ac58d-157">**仅审核** - 可以在审核模式下启用此缓解，以便衡量对应用程序的潜在兼容性影响。</span><span class="sxs-lookup"><span data-stu-id="ac58d-157">**Audit Only** - You can enable this mitigation in audit mode in order to measure the potential compatibility impact on an application.</span></span> <span data-ttu-id="ac58d-158">然后，可以在事件查看器中或在 Microsoft Defender for Endpoint 中使用高级搜寻查看 [审核事件](/microsoft-365/security/defender/advanced-hunting-overview)。</span><span class="sxs-lookup"><span data-stu-id="ac58d-158">Audit events can then be viewed either in the event viewer or using Advanced Hunting in [Microsoft Defender for Endpoint](/microsoft-365/security/defender/advanced-hunting-overview).</span></span>

## <a name="block-remote-images"></a><span data-ttu-id="ac58d-159">阻止远程图像</span><span class="sxs-lookup"><span data-stu-id="ac58d-159">Block remote images</span></span>

### <a name="description"></a><span data-ttu-id="ac58d-160">说明</span><span class="sxs-lookup"><span data-stu-id="ac58d-160">Description</span></span>

<span data-ttu-id="ac58d-161">阻止远程映像有助于防止应用程序加载在远程设备上托管的文件，例如 UNC 共享。</span><span class="sxs-lookup"><span data-stu-id="ac58d-161">Blocking remote images helps to prevent the application from loading files that are hosted on a remote device, such as a UNC share.</span></span> <span data-ttu-id="ac58d-162">阻止远程映像有助于防止将二进制文件加载到由攻击者控制的外部设备上的内存。</span><span class="sxs-lookup"><span data-stu-id="ac58d-162">Blocking remote images helps protect against loading binaries into memory that are on an external device controlled by the attacker.</span></span>

<span data-ttu-id="ac58d-163">如果图像确定位于远程设备上，此缓解将阻止映像加载。</span><span class="sxs-lookup"><span data-stu-id="ac58d-163">This mitigation will block image loads if the image is determined to be on a remote device.</span></span> <span data-ttu-id="ac58d-164">它由内存管理器实现，它会阻止将文件映射到内存中。</span><span class="sxs-lookup"><span data-stu-id="ac58d-164">It is implemented by the memory manager, which blocks the file from being mapped into memory.</span></span> <span data-ttu-id="ac58d-165">如果应用程序尝试映射远程文件，它将触发STATUS_ACCESS_DENIED错误。</span><span class="sxs-lookup"><span data-stu-id="ac58d-165">If an application attempts to map a remote file, it will trigger a STATUS_ACCESS_DENIED error.</span></span>

### <a name="compatibility-considerations"></a><span data-ttu-id="ac58d-166">兼容性注意事项</span><span class="sxs-lookup"><span data-stu-id="ac58d-166">Compatibility considerations</span></span>

<span data-ttu-id="ac58d-167">阻止远程图像将阻止应用程序从远程设备加载图像。</span><span class="sxs-lookup"><span data-stu-id="ac58d-167">Block remote images will prevent the application from loading images from remote devices.</span></span> <span data-ttu-id="ac58d-168">如果你的应用程序从远程设备加载文件或插件，它将与此缓解不兼容。</span><span class="sxs-lookup"><span data-stu-id="ac58d-168">If your application loads files or plug-ins from remote devices, then it will not be compatible with this mitigation.</span></span>

### <a name="configuration-options"></a><span data-ttu-id="ac58d-169">配置选项</span><span class="sxs-lookup"><span data-stu-id="ac58d-169">Configuration options</span></span>

<span data-ttu-id="ac58d-170">**仅审核** - 可以在审核模式下启用此缓解，以便衡量对应用程序的潜在兼容性影响。</span><span class="sxs-lookup"><span data-stu-id="ac58d-170">**Audit Only** - You can enable this mitigation in audit mode in order to measure the potential compatibility impact on an application.</span></span> <span data-ttu-id="ac58d-171">然后，可以在事件查看器中或在 Microsoft Defender for Endpoint 中使用高级搜寻查看 [审核事件](/microsoft-365/security/defender/advanced-hunting-overview)。</span><span class="sxs-lookup"><span data-stu-id="ac58d-171">Audit events can then be viewed either in the event viewer or using Advanced Hunting in [Microsoft Defender for Endpoint](/microsoft-365/security/defender/advanced-hunting-overview).</span></span>

## <a name="block-untrusted-fonts"></a><span data-ttu-id="ac58d-172">阻止不受信任的字体</span><span class="sxs-lookup"><span data-stu-id="ac58d-172">Block untrusted fonts</span></span>

### <a name="description"></a><span data-ttu-id="ac58d-173">说明</span><span class="sxs-lookup"><span data-stu-id="ac58d-173">Description</span></span>

<span data-ttu-id="ac58d-174">阻止不受信任的字体可以减少字体分析中缺陷的风险，从而导致攻击者能够在设备上运行代码。</span><span class="sxs-lookup"><span data-stu-id="ac58d-174">Block untrusted fonts mitigates the risk of a flaw in font parsing leading to the attacker being able to run code on the device.</span></span> <span data-ttu-id="ac58d-175">只有安装到 windows\fonts 目录中的字体将被加载供 GDI 处理。</span><span class="sxs-lookup"><span data-stu-id="ac58d-175">Only fonts that are installed into the windows\fonts directory will be loaded for processing by GDI.</span></span>

<span data-ttu-id="ac58d-176">此缓解措施在 GDI 中实现，用于验证文件的位置。</span><span class="sxs-lookup"><span data-stu-id="ac58d-176">This mitigation is implemented within GDI, which validates the location of the file.</span></span> <span data-ttu-id="ac58d-177">如果文件不在系统字体目录中，将不会加载该字体进行分析，并且该调用将失败。</span><span class="sxs-lookup"><span data-stu-id="ac58d-177">If the file is not in the system fonts directory, the font will not be loaded for parsing and that call will fail.</span></span>

<span data-ttu-id="ac58d-178">除了 Windows 10 1607 及更高版本中提供的内置缓解外，此缓解功能会将字体分析从内核中移到用户模式应用容器中。</span><span class="sxs-lookup"><span data-stu-id="ac58d-178">This mitigation is in addition to the built-in mitigation provided in Windows 10 1607 and later, which moves font parsing out of the kernel and into a user-mode app container.</span></span> <span data-ttu-id="ac58d-179">因此，基于字体分析的任何攻击都发生在沙盒和隔离的上下文中，这大大降低了风险。</span><span class="sxs-lookup"><span data-stu-id="ac58d-179">Any exploit based on font parsing, as a result, happens in a sandboxed and isolated context, which reduces the risk significantly.</span></span> <span data-ttu-id="ac58d-180">有关此缓解的详细信息，请参阅博客使用零[Windows 10攻击缓解进行强化](https://www.microsoft.com/security/blog/2017/01/13/hardening-windows-10-with-zero-day-exploit-mitigations/)。</span><span class="sxs-lookup"><span data-stu-id="ac58d-180">For details on this mitigation, see the blog [Hardening Windows 10 with zero-day exploit mitigations](https://www.microsoft.com/security/blog/2017/01/13/hardening-windows-10-with-zero-day-exploit-mitigations/).</span></span>

### <a name="compatibility-considerations"></a><span data-ttu-id="ac58d-181">兼容性注意事项</span><span class="sxs-lookup"><span data-stu-id="ac58d-181">Compatibility considerations</span></span>

<span data-ttu-id="ac58d-182">系统字体目录之外的字体的最常见用途是使用 [Web 字体](/typography/fonts/font-faq#web)。</span><span class="sxs-lookup"><span data-stu-id="ac58d-182">The most common use of fonts outside of the system fonts directory is with [web fonts](/typography/fonts/font-faq#web).</span></span> <span data-ttu-id="ac58d-183">新式浏览器（如 Microsoft Edge）DirectWrite GDI，并且不会受到影响。</span><span class="sxs-lookup"><span data-stu-id="ac58d-183">Modern browsers, such as Microsoft Edge, use DirectWrite instead of GDI, and are not impacted.</span></span> <span data-ttu-id="ac58d-184">但是，新 Microsoft Edge) 中的旧版浏览器（如 Internet Explorer 11 (和 IE 模式）可能会受到影响，特别是对于使用字体字形显示 UI 的应用程序（如 Office 365）。</span><span class="sxs-lookup"><span data-stu-id="ac58d-184">However, legacy browsers, such as Internet Explorer 11 (and IE mode in the new Microsoft Edge) can be impacted, particularly with applications such as Office 365, which use font glyphs to display UI.</span></span>

### <a name="configuration-options"></a><span data-ttu-id="ac58d-185">配置选项</span><span class="sxs-lookup"><span data-stu-id="ac58d-185">Configuration options</span></span>

<span data-ttu-id="ac58d-186">**仅审核** - 可以在审核模式下启用此缓解，以便衡量对应用程序的潜在兼容性影响。</span><span class="sxs-lookup"><span data-stu-id="ac58d-186">**Audit Only** - You can enable this mitigation in audit mode in order to measure the potential compatibility impact on an application.</span></span> <span data-ttu-id="ac58d-187">然后，可以在事件查看器中或在 Microsoft Defender for Endpoint 中使用高级搜寻查看 [审核事件](/microsoft-365/security/defender/advanced-hunting-overview)。</span><span class="sxs-lookup"><span data-stu-id="ac58d-187">Audit events can then be viewed either in the event viewer or using Advanced Hunting in [Microsoft Defender for Endpoint](/microsoft-365/security/defender/advanced-hunting-overview).</span></span>

## <a name="code-integrity-guard"></a><span data-ttu-id="ac58d-188">代码完整性防护</span><span class="sxs-lookup"><span data-stu-id="ac58d-188">Code integrity guard</span></span>

### <a name="description"></a><span data-ttu-id="ac58d-189">说明</span><span class="sxs-lookup"><span data-stu-id="ac58d-189">Description</span></span>

<span data-ttu-id="ac58d-190">代码完整性防护可确保加载到进程的所有二进制文件都由 Microsoft 进行数字签名。</span><span class="sxs-lookup"><span data-stu-id="ac58d-190">Code integrity guard ensures that all binaries loaded into a process are digitally signed by Microsoft.</span></span> <span data-ttu-id="ac58d-191">代码完整性防护包括[WHQL](/windows-hardware/drivers/install/whql-release-signature) (Windows硬件质量实验室) 签名，这将允许 WHQL 批准的驱动程序在进程中运行。</span><span class="sxs-lookup"><span data-stu-id="ac58d-191">Code integrity guard includes [WHQL](/windows-hardware/drivers/install/whql-release-signature) (Windows Hardware Quality Labs) signatures, which will allow WHQL-approved drivers to run within the process.</span></span>

<span data-ttu-id="ac58d-192">此缓解措施在内存管理器中实现，可阻止将二进制文件映射到内存。</span><span class="sxs-lookup"><span data-stu-id="ac58d-192">This mitigation is implemented within the memory manager, which blocks the binary from being mapped into memory.</span></span> <span data-ttu-id="ac58d-193">如果尝试加载未由 Microsoft 签名的二进制文件，则内存管理器将返回错误STATUS_INVALID_IMAGE_HASH。</span><span class="sxs-lookup"><span data-stu-id="ac58d-193">If you attempt to load a binary that is not signed by Microsoft, the memory manger will return the error STATUS_INVALID_IMAGE_HASH.</span></span> <span data-ttu-id="ac58d-194">通过阻止内存管理器级别，这可以防止进程加载的二进制文件和注入到进程中的二进制文件。</span><span class="sxs-lookup"><span data-stu-id="ac58d-194">By blocking at the memory manager level, this prevents both binaries loaded by the process and binaries injected into the process.</span></span>

### <a name="compatibility-considerations"></a><span data-ttu-id="ac58d-195">兼容性注意事项</span><span class="sxs-lookup"><span data-stu-id="ac58d-195">Compatibility considerations</span></span>

<span data-ttu-id="ac58d-196">此缓解功能专门阻止任何未由 Microsoft 签名的二进制文件。</span><span class="sxs-lookup"><span data-stu-id="ac58d-196">This mitigation specifically blocks any binary that is not signed by Microsoft.</span></span> <span data-ttu-id="ac58d-197">因此，除非该软件由 (分发，由) Microsoft Store 进行数字签名，并且选择了允许加载由 Microsoft Store 签名的图像的选项，否则它将与大多数第三方软件不兼容。</span><span class="sxs-lookup"><span data-stu-id="ac58d-197">As such, it will be incompatible with most third-party software, unless that software is distributed by (and digitally signed by) the Microsoft Store, and the option to allow loading of images signed by the Microsoft Store is selected.</span></span>

### <a name="configuration-options"></a><span data-ttu-id="ac58d-198">配置选项</span><span class="sxs-lookup"><span data-stu-id="ac58d-198">Configuration options</span></span>

<span data-ttu-id="ac58d-199">还允许加载 **由 Microsoft Store** 签名的图像 - Microsoft Store 分发的应用程序由 Microsoft Store 进行数字签名，添加此配置将允许应用程序加载通过应用商店认证过程的二进制文件。</span><span class="sxs-lookup"><span data-stu-id="ac58d-199">**Also allow loading of images signed by Microsoft Store** - Applications that are distributed by the Microsoft Store will be digitally signed by the Microsoft Store, and adding this configuration will allow binaries that have gone through the store certification process to be loaded by the application.</span></span>

<span data-ttu-id="ac58d-200">**仅审核** - 可以在审核模式下启用此缓解，以便衡量对应用程序的潜在兼容性影响。</span><span class="sxs-lookup"><span data-stu-id="ac58d-200">**Audit Only** - You can enable this mitigation in audit mode in order to measure the potential compatibility impact on an application.</span></span> <span data-ttu-id="ac58d-201">然后，可以在事件查看器中或在 Microsoft Defender for Endpoint 中使用高级搜寻查看 [审核事件](/microsoft-365/security/defender/advanced-hunting-overview)。</span><span class="sxs-lookup"><span data-stu-id="ac58d-201">Audit events can then be viewed either in the event viewer or using Advanced Hunting in [Microsoft Defender for Endpoint](/microsoft-365/security/defender/advanced-hunting-overview).</span></span>

## <a name="control-flow-guard-cfg"></a><span data-ttu-id="ac58d-202">控制流保护 (CFG) </span><span class="sxs-lookup"><span data-stu-id="ac58d-202">Control flow guard (CFG)</span></span>

### <a name="description"></a><span data-ttu-id="ac58d-203">说明</span><span class="sxs-lookup"><span data-stu-id="ac58d-203">Description</span></span>

<span data-ttu-id="ac58d-204">控制流 (CFG) 通过保护间接函数调用来降低攻击者使用内存损坏漏洞的风险。</span><span class="sxs-lookup"><span data-stu-id="ac58d-204">Control flow guard (CFG) mitigates the risk of attackers using memory corruption vulnerabilities by protecting indirect function calls.</span></span> <span data-ttu-id="ac58d-205">例如，攻击者可能会使用缓冲区溢出漏洞覆盖包含函数指针的内存，将函数指针替换为指向其选择的可执行代码 (该指针也可能已注入程序) 。</span><span class="sxs-lookup"><span data-stu-id="ac58d-205">For example, an attacker may user a buffer overflow vulnerability to overwrite memory containing a function pointer, and replace that function pointer with a pointer to executable code of their choice (which may also have been injected into the program).</span></span>

<span data-ttu-id="ac58d-206">此缓解功能是在编译时注入另一个检查。</span><span class="sxs-lookup"><span data-stu-id="ac58d-206">This mitigation is provided by injecting another check at compile time.</span></span> <span data-ttu-id="ac58d-207">在每个间接函数调用之前，会添加另一个指令，该指令在调用目标之前验证该目标是否是有效的调用目标。</span><span class="sxs-lookup"><span data-stu-id="ac58d-207">Before each indirect function call, another instructions are added which verify that the target is a valid call target before it is called.</span></span> <span data-ttu-id="ac58d-208">如果目标不是有效的呼叫目标，则应用程序将终止。</span><span class="sxs-lookup"><span data-stu-id="ac58d-208">If the target is not a valid call target, then the application is terminated.</span></span> <span data-ttu-id="ac58d-209">因此，只有使用 CFG 支持编译的应用程序可以从此缓解中获益。</span><span class="sxs-lookup"><span data-stu-id="ac58d-209">As such, only applications that are compiled with CFG support can benefit from this mitigation.</span></span>

<span data-ttu-id="ac58d-210">检查有效目标由Windows提供。</span><span class="sxs-lookup"><span data-stu-id="ac58d-210">The check for a valid target is provided by the Windows kernel.</span></span> <span data-ttu-id="ac58d-211">加载可执行文件时，间接调用目标的元数据在加载时提取并标记为有效的调用目标。</span><span class="sxs-lookup"><span data-stu-id="ac58d-211">When executable files are loaded, the metadata for indirect call targets is extracted at load time and marked as valid call targets.</span></span> <span data-ttu-id="ac58d-212">此外，当分配内存并标记为可执行 (（如针对生成的代码) ）时，这些内存位置也会标记为有效的调用目标，以支持 JIT 编译等机制。</span><span class="sxs-lookup"><span data-stu-id="ac58d-212">Additionally, when memory is allocated and marked as executable (such as for generated code), these memory locations are also marked as valid call targets, to support mechanisms such as JIT compilation.</span></span>

### <a name="compatibility-considerations"></a><span data-ttu-id="ac58d-213">兼容性注意事项</span><span class="sxs-lookup"><span data-stu-id="ac58d-213">Compatibility considerations</span></span>

<span data-ttu-id="ac58d-214">由于必须编译应用程序以支持 CFG，因此它们隐式声明其与 CFG 的兼容性。</span><span class="sxs-lookup"><span data-stu-id="ac58d-214">Since applications must be compiled to support CFG, they implicitly declare their compatibility with it.</span></span> <span data-ttu-id="ac58d-215">因此，大多数应用程序都应使用已启用此缓解功能。</span><span class="sxs-lookup"><span data-stu-id="ac58d-215">Most applications, therefore, should work with this mitigation enabled.</span></span> <span data-ttu-id="ac58d-216">由于这些检查已编译为二进制文件，因此可以应用的配置只是为了在内核中禁用Windows检查。</span><span class="sxs-lookup"><span data-stu-id="ac58d-216">Because these checks are compiled into the binary, the configuration you can apply is merely to disable checks within the Windows kernel.</span></span> <span data-ttu-id="ac58d-217">换句话说，缓解默认启用，但你可以将 Windows 内核配置为始终返回"是"（如果你稍后确定应用程序开发人员在测试中未发现兼容性问题，这应该很少见）。</span><span class="sxs-lookup"><span data-stu-id="ac58d-217">In other words, the mitigation is on by default, but you can configure the Windows kernel to always return "yes" if you later determine that there is a compatibility issue that the application developer did not discover in their testing, which should be rare.</span></span>

### <a name="configuration-options"></a><span data-ttu-id="ac58d-218">配置选项</span><span class="sxs-lookup"><span data-stu-id="ac58d-218">Configuration options</span></span>

<span data-ttu-id="ac58d-219">使用 **严格的 CFG** - 在严格模式下，必须针对 Control Flow Guard (编译加载到进程中的所有二进制文件，或者其中没有可执行代码（如资源 dll) ）才能加载。</span><span class="sxs-lookup"><span data-stu-id="ac58d-219">**Use strict CFG** - In strict mode, all binaries loaded into the process must be compiled for Control Flow Guard (or have no executable code in them - such as resource dlls) in order to be loaded.</span></span>

> [!Note]
> <span data-ttu-id="ac58d-220">**控制流保护** 没有审核模式。</span><span class="sxs-lookup"><span data-stu-id="ac58d-220">**Control flow guard** has no audit mode.</span></span> <span data-ttu-id="ac58d-221">在启用此缓解功能后编译二进制文件。</span><span class="sxs-lookup"><span data-stu-id="ac58d-221">Binaries are compiled with this mitigation enabled.</span></span>

## <a name="data-execution-prevention-dep"></a><span data-ttu-id="ac58d-222">数据执行保护 (DEP) </span><span class="sxs-lookup"><span data-stu-id="ac58d-222">Data Execution Prevention (DEP)</span></span>

### <a name="description"></a><span data-ttu-id="ac58d-223">说明</span><span class="sxs-lookup"><span data-stu-id="ac58d-223">Description</span></span>

<span data-ttu-id="ac58d-224">DEP (执行) 防止执行未明确分配为可执行文件的内存。</span><span class="sxs-lookup"><span data-stu-id="ac58d-224">Data execution prevention (DEP) prevents memory that was not explicitly allocated as executable from being executed.</span></span> <span data-ttu-id="ac58d-225">DEP 可帮助防止攻击者将恶意代码注入进程，例如通过缓冲区溢出，然后执行该代码。</span><span class="sxs-lookup"><span data-stu-id="ac58d-225">DEP helps protect against an attacker injecting malicious code into the process, such as through a buffer overflow, and then executing that code.</span></span>

<span data-ttu-id="ac58d-226">如果尝试将指令指针设置为未标记为可执行的内存地址，则处理器将在常规保护冲突 (引发异常) ，从而导致应用程序崩溃。</span><span class="sxs-lookup"><span data-stu-id="ac58d-226">If you attempt to set the instruction pointer to a memory address not marked as executable, the processor will throw an exception (general-protection violation), causing the application to crash.</span></span>

### <a name="compatibility-considerations"></a><span data-ttu-id="ac58d-227">兼容性注意事项</span><span class="sxs-lookup"><span data-stu-id="ac58d-227">Compatibility considerations</span></span>

<span data-ttu-id="ac58d-228">默认情况下，所有 x64 ARM、ARM 和 ARM-64 可执行文件都启用了 DEP，并且无法禁用它。</span><span class="sxs-lookup"><span data-stu-id="ac58d-228">All x64, ARM, and ARM-64 executables have DEP enabled by default, and it cannot be disabled.</span></span> <span data-ttu-id="ac58d-229">由于应用程序永远不会在没有 DEP 的情况下执行，因此假定兼容性。</span><span class="sxs-lookup"><span data-stu-id="ac58d-229">Since an application will have never been executed without DEP, compatibility is assumed.</span></span>

<span data-ttu-id="ac58d-230">默认情况下，所有 x86 (32) 都启用了 DEP，但可以按进程禁用 DEP。</span><span class="sxs-lookup"><span data-stu-id="ac58d-230">All x86 (32-bit) binaries have DEP enabled by default, but DEP can be disabled per process.</span></span> <span data-ttu-id="ac58d-231">一些旧的旧应用程序（通常是在 Windows XP SP2 之前开发的应用程序）可能与 DEP 不兼容。</span><span class="sxs-lookup"><span data-stu-id="ac58d-231">Some old legacy applications, typically applications developed prior to Windows XP SP2, might not be compatible with DEP.</span></span> <span data-ttu-id="ac58d-232">例如，JIT 编译) 或链接到较旧版本的 (（如动态生成代码的较早版本的 ATL) ）通常) 动态生成代码。 (</span><span class="sxs-lookup"><span data-stu-id="ac58d-232">Such applications typically generate code dynamically (for example, JIT compiling) or link to older libraries (such as older versions of ATL) which dynamically generate code.</span></span>

### <a name="configuration-options"></a><span data-ttu-id="ac58d-233">配置选项</span><span class="sxs-lookup"><span data-stu-id="ac58d-233">Configuration options</span></span>

<span data-ttu-id="ac58d-234">**启用 ATL Thunk 模拟** - 此配置选项禁用 ATL Thunk 模拟。</span><span class="sxs-lookup"><span data-stu-id="ac58d-234">**Enable ATL Thunk emulation** - This configuration option disables ATL Thunk emulation.</span></span> <span data-ttu-id="ac58d-235">ATL 是ActiveX模板库，旨在尽可能小且快速。</span><span class="sxs-lookup"><span data-stu-id="ac58d-235">ATL, the ActiveX Template Library, is designed to be as small and fast as possible.</span></span> <span data-ttu-id="ac58d-236">为了减小二进制大小，它将使用一种称为 *"thunking"的技术*。</span><span class="sxs-lookup"><span data-stu-id="ac58d-236">In order to reduce binary size, it would use a technique called *thunking*.</span></span> <span data-ttu-id="ac58d-237">图文通常被认为是在 32 位和 16 位应用程序之间交互，但此处没有用于 ATL 的 16 位组件。</span><span class="sxs-lookup"><span data-stu-id="ac58d-237">Thunking is typically thought of for interacting between 32-bit and 16-bit applications, but there are no 16-bit components to ATL here.</span></span> <span data-ttu-id="ac58d-238">相反，为了优化二进制大小，ATL 将在内存中存储与单词不一致的计算机代码 (创建较小的二进制) ，然后直接调用该代码。</span><span class="sxs-lookup"><span data-stu-id="ac58d-238">Rather, in order to optimize for binary size, ATL will store machine code in memory that is not word-aligned (creating a smaller binary), and then invoke that code directly.</span></span> <span data-ttu-id="ac58d-239">使用 Visual Studio 7.1 或 (Visual Studio 2003) 编译的 ATL 组件不会分配此内存作为可执行文件 - thunk 模拟可解决该兼容性问题。</span><span class="sxs-lookup"><span data-stu-id="ac58d-239">ATL components compiled with Visual Studio 7.1 or earlier (Visual Studio 2003) do not allocate this memory as executable - thunk emulation resolves that compatibility issue.</span></span> <span data-ttu-id="ac58d-240">具有二进制扩展模型 (如 Internet Explorer 11) 通常需要启用 ATL Thunk 模拟。</span><span class="sxs-lookup"><span data-stu-id="ac58d-240">Applications that have a binary extension model (such as Internet Explorer 11) will often need to have ATL Thunk emulation enabled.</span></span>

## <a name="disable-extension-points"></a><span data-ttu-id="ac58d-241">禁用扩展点</span><span class="sxs-lookup"><span data-stu-id="ac58d-241">Disable extension points</span></span>

### <a name="description"></a><span data-ttu-id="ac58d-242">说明</span><span class="sxs-lookup"><span data-stu-id="ac58d-242">Description</span></span>

<span data-ttu-id="ac58d-243">此缓解功能禁用应用程序的各种扩展点，这些扩展点可用于建立持久性或提升恶意内容的特权。</span><span class="sxs-lookup"><span data-stu-id="ac58d-243">This mitigation disables various extension points for an application, which might be used to establish persistence or elevate privileges of malicious content.</span></span>

<span data-ttu-id="ac58d-244">这包括：</span><span class="sxs-lookup"><span data-stu-id="ac58d-244">This includes:</span></span>

- <span data-ttu-id="ac58d-245">**AppInit DLL** - 只要进程启动，系统就会先将指定的 DLL 加载到新启动进程的上下文中，然后再调用其入口点函数。</span><span class="sxs-lookup"><span data-stu-id="ac58d-245">**AppInit DLLs** - Whenever a process starts, the system will load the specified DLL into to context of the newly started process before calling its entry point function.</span></span> <span data-ttu-id="ac58d-246">[有关 AppInit DLL 的详细信息，请参阅此处](/windows/win32/winmsg/about-window-classes#application-global-classes)。</span><span class="sxs-lookup"><span data-stu-id="ac58d-246">[Details on AppInit DLLs can be found here](/windows/win32/winmsg/about-window-classes#application-global-classes).</span></span> <span data-ttu-id="ac58d-247">应用此缓解后，不会加载 AppInit DLL。</span><span class="sxs-lookup"><span data-stu-id="ac58d-247">With this mitigation applied, AppInit DLLs are not loaded.</span></span> <span data-ttu-id="ac58d-248">从 Windows 7 开始，AppInit DLL 需要进行数字签名[，如此处所述](/windows/win32/win7appqual/appinit-dlls-in-windows-7-and-windows-server-2008-r2)。</span><span class="sxs-lookup"><span data-stu-id="ac58d-248">Beginning with Windows 7, AppInit DLLs need to be digitally signed, [as described here](/windows/win32/win7appqual/appinit-dlls-in-windows-7-and-windows-server-2008-r2).</span></span> <span data-ttu-id="ac58d-249">此外，从 Windows 8开始，如果启用 SecureBoot，将不会加载 AppInit [DLL，如此处所述](/windows/win32/dlls/secure-boot-and-appinit-dlls)。</span><span class="sxs-lookup"><span data-stu-id="ac58d-249">Additionally, beginning with Windows 8, AppInit DLLs will not be loaded if SecureBoot is enabled, [as described here](/windows/win32/dlls/secure-boot-and-appinit-dlls).</span></span>
- <span data-ttu-id="ac58d-250">**旧版 IME** - 输入法编辑器 (输入法) 输入法编辑器，使用户可以键入的字符数多于键盘上可以表示的字符数的语言。</span><span class="sxs-lookup"><span data-stu-id="ac58d-250">**Legacy IMEs** - An Input Method Editor (IME) allows a user to type text in a language that has more characters than can be represented on a keyboard.</span></span> <span data-ttu-id="ac58d-251">第三方能够创建 IIM。</span><span class="sxs-lookup"><span data-stu-id="ac58d-251">Third parties are able to create IMEs.</span></span> <span data-ttu-id="ac58d-252">恶意 IME 可能会从此输入捕获获取凭据或其他敏感信息。</span><span class="sxs-lookup"><span data-stu-id="ac58d-252">A malicious IME might obtain credentials or other sensitive information from this input capture.</span></span> <span data-ttu-id="ac58d-253">某些 IIM（称为传统 IIM）仅适用于Windows桌面应用，而非 UWP 应用。</span><span class="sxs-lookup"><span data-stu-id="ac58d-253">Some IMEs, referred to as Legacy IMEs, will only work on Windows Desktop apps, and not UWP apps.</span></span> <span data-ttu-id="ac58d-254">此缓解还会阻止此旧版 IME 加载到指定的桌面Windows中。</span><span class="sxs-lookup"><span data-stu-id="ac58d-254">This mitigation will also prevent this legacy IME from loading into the specified Windows Desktop app.</span></span>
- <span data-ttu-id="ac58d-255">**Windows事件挂钩**- 应用程序可以调用 [SetWinEventHook API](/windows/win32/api/winuser/nf-winuser-setwineventhook)来注册对事件发生的关注。</span><span class="sxs-lookup"><span data-stu-id="ac58d-255">**Windows Event Hooks** - An application can call the [SetWinEventHook API](/windows/win32/api/winuser/nf-winuser-setwineventhook) to register interest in an event taking place.</span></span> <span data-ttu-id="ac58d-256">DLL 已指定，可以注入到进程中。</span><span class="sxs-lookup"><span data-stu-id="ac58d-256">A DLL is specified and can be injected into the process.</span></span> <span data-ttu-id="ac58d-257">此缓解将强制将挂钩张贴到注册进程，而不是通过注入的 DLL 在进程内运行。</span><span class="sxs-lookup"><span data-stu-id="ac58d-257">This mitigation forces the hook to be posted to the registering process rather than running in-process through an injected DLL.</span></span>

### <a name="compatibility-considerations"></a><span data-ttu-id="ac58d-258">兼容性注意事项</span><span class="sxs-lookup"><span data-stu-id="ac58d-258">Compatibility considerations</span></span>

<span data-ttu-id="ac58d-259">这些扩展点中的大多数相对很少使用，因此兼容性影响通常很小，尤其是在单个应用程序级别。</span><span class="sxs-lookup"><span data-stu-id="ac58d-259">Most of these extension points are relatively infrequently used, so compatibility impact is typically small, particularly at an individual application level.</span></span> <span data-ttu-id="ac58d-260">一个考虑事项是用户是否正在使用第三方旧版 IIM，这些 IES 将不能与受保护的应用程序一起使用。</span><span class="sxs-lookup"><span data-stu-id="ac58d-260">The one consideration is if users are using third-party Legacy IMEs that will not work with the protected application.</span></span>

### <a name="configuration-options"></a><span data-ttu-id="ac58d-261">配置选项</span><span class="sxs-lookup"><span data-stu-id="ac58d-261">Configuration options</span></span>

<span data-ttu-id="ac58d-262">没有用于此缓解的配置选项。</span><span class="sxs-lookup"><span data-stu-id="ac58d-262">There are no configuration options for this mitigation.</span></span>

> [!Note]
> <span data-ttu-id="ac58d-263">**禁用扩展点** 没有审核模式。</span><span class="sxs-lookup"><span data-stu-id="ac58d-263">**Disable extension points** has no audit mode.</span></span>

## <a name="disable-win32k-system-calls"></a><span data-ttu-id="ac58d-264">禁用 Win32k 系统调用</span><span class="sxs-lookup"><span data-stu-id="ac58d-264">Disable Win32k system calls</span></span>

### <a name="description"></a><span data-ttu-id="ac58d-265">说明</span><span class="sxs-lookup"><span data-stu-id="ac58d-265">Description</span></span>

<span data-ttu-id="ac58d-266">Win32k.sys攻击者提供了广泛的攻击面。</span><span class="sxs-lookup"><span data-stu-id="ac58d-266">Win32k.sys provides a broad attack surface for an attacker.</span></span> <span data-ttu-id="ac58d-267">作为内核模式组件，它通常作为沙盒应用程序的转义矢量进行定向。</span><span class="sxs-lookup"><span data-stu-id="ac58d-267">As a kernel-mode component, it is frequently targeted as an escape vector for applications that are sandboxed.</span></span> <span data-ttu-id="ac58d-268">此缓解措施win32k.sys线程自行转换为 GUI 线程，从而阻止调用到 GUI 线程，然后向该线程提供调用 Win32k 函数的访问权限。</span><span class="sxs-lookup"><span data-stu-id="ac58d-268">This mitigation prevents calls into win32k.sys by blocking a thread from converting itself into a GUI thread, which is then given access to invoke Win32k functions.</span></span> <span data-ttu-id="ac58d-269">线程创建时为非 GUI，但在首次调用线程时win32k.sys，或者通过 API 调用 [IsGuiThread 转换](/windows/win32/api/winuser/nf-winuser-isguithread)。</span><span class="sxs-lookup"><span data-stu-id="ac58d-269">A thread is non-GUI when created, but converted on first call to win32k.sys, or through an API call to [IsGuiThread](/windows/win32/api/winuser/nf-winuser-isguithread).</span></span>

### <a name="compatibility-considerations"></a><span data-ttu-id="ac58d-270">兼容性注意事项</span><span class="sxs-lookup"><span data-stu-id="ac58d-270">Compatibility considerations</span></span>

<span data-ttu-id="ac58d-271">此缓解针对的是专用非 UI 进程的进程。</span><span class="sxs-lookup"><span data-stu-id="ac58d-271">This mitigation is designed for processes that are dedicated non-UI processes.</span></span> <span data-ttu-id="ac58d-272">例如，许多新式浏览器将使用进程隔离并合并非 UI 进程。</span><span class="sxs-lookup"><span data-stu-id="ac58d-272">For example, many modern browsers will use process isolation and incorporate non-UI processes.</span></span> <span data-ttu-id="ac58d-273">使用单个进程显示 GUI 的任何应用程序都将受到此缓解的影响。</span><span class="sxs-lookup"><span data-stu-id="ac58d-273">Any application that displays a GUI using a single process will be impacted by this mitigation.</span></span>

### <a name="configuration-options"></a><span data-ttu-id="ac58d-274">配置选项</span><span class="sxs-lookup"><span data-stu-id="ac58d-274">Configuration options</span></span>

<span data-ttu-id="ac58d-275">**仅审核** - 可以在审核模式下启用此缓解，以便衡量对应用程序的潜在兼容性影响。</span><span class="sxs-lookup"><span data-stu-id="ac58d-275">**Audit Only** - You can enable this mitigation in audit mode in order to measure the potential compatibility impact on an application.</span></span> <span data-ttu-id="ac58d-276">然后，可以在事件查看器中或在 Microsoft Defender for Endpoint 中使用高级搜寻查看 [审核事件](/microsoft-365/security/defender/advanced-hunting-overview)。</span><span class="sxs-lookup"><span data-stu-id="ac58d-276">Audit events can then be viewed either in the event viewer or using Advanced Hunting in [Microsoft Defender for Endpoint](/microsoft-365/security/defender/advanced-hunting-overview).</span></span>

## <a name="do-not-allow-child-processes"></a><span data-ttu-id="ac58d-277">不允许子进程</span><span class="sxs-lookup"><span data-stu-id="ac58d-277">Do not allow child processes</span></span>

### <a name="description"></a><span data-ttu-id="ac58d-278">说明</span><span class="sxs-lookup"><span data-stu-id="ac58d-278">Description</span></span>

<span data-ttu-id="ac58d-279">此缓解阻止应用程序创建新的子应用程序。</span><span class="sxs-lookup"><span data-stu-id="ac58d-279">This mitigation prevents an application from creating new child applications.</span></span> <span data-ttu-id="ac58d-280">攻击者使用的一种常见技术是在具有恶意输入的设备上启动受信任的进程 (称为"离开陆地"攻击) 这通常需要在设备上启动另一个应用程序。</span><span class="sxs-lookup"><span data-stu-id="ac58d-280">A common technique used by adversaries is to initiate a trusted process on the device with malicious input (a "living off the land" attack), which often requires launching another application on the device.</span></span> <span data-ttu-id="ac58d-281">如果应用程序启动子进程没有任何合理原因，此缓解功能将缓解潜在的攻击途径。</span><span class="sxs-lookup"><span data-stu-id="ac58d-281">If there are no legitimate reasons why an application would launch a child process, this mitigation mitigates that potential attack vector.</span></span> <span data-ttu-id="ac58d-282">通过设置进程令牌上的属性来应用缓解，这将阻止为包含错误消息的子进程创建STATUS_CHILD_PROCESS_BLOCKED。</span><span class="sxs-lookup"><span data-stu-id="ac58d-282">The mitigation is applied by setting a property on the process token, which blocks creating a token for the child process with the error message STATUS_CHILD_PROCESS_BLOCKED.</span></span>

### <a name="compatibility-considerations"></a><span data-ttu-id="ac58d-283">兼容性注意事项</span><span class="sxs-lookup"><span data-stu-id="ac58d-283">Compatibility considerations</span></span>

<span data-ttu-id="ac58d-284">如果你的应用程序出于任何原因启动子应用程序，例如支持启动浏览器或外部浏览器的超链接，或者在计算机上启动其他实用程序，则此功能将因应用的此缓解功能而中断。</span><span class="sxs-lookup"><span data-stu-id="ac58d-284">If your application launches child applications for any reason, such as supporting hyperlinks that launch a browser or an external browser, or which launch other utilities on the computer, this functionality will be broken with this mitigation applied.</span></span>

### <a name="configuration-options"></a><span data-ttu-id="ac58d-285">配置选项</span><span class="sxs-lookup"><span data-stu-id="ac58d-285">Configuration options</span></span>

<span data-ttu-id="ac58d-286">**仅审核** - 可以在审核模式下启用此缓解，以便衡量对应用程序的潜在兼容性影响。</span><span class="sxs-lookup"><span data-stu-id="ac58d-286">**Audit Only** - You can enable this mitigation in audit mode in order to measure the potential compatibility impact on an application.</span></span> <span data-ttu-id="ac58d-287">然后，可以在事件查看器中或在 Microsoft Defender for Endpoint 中使用高级搜寻查看 [审核事件](/microsoft-365/security/defender/advanced-hunting-overview)。</span><span class="sxs-lookup"><span data-stu-id="ac58d-287">Audit events can then be viewed either in the event viewer or using Advanced Hunting in [Microsoft Defender for Endpoint](/microsoft-365/security/defender/advanced-hunting-overview).</span></span>

## <a name="export-address-filtering"></a><span data-ttu-id="ac58d-288">导出地址筛选</span><span class="sxs-lookup"><span data-stu-id="ac58d-288">Export address filtering</span></span>

### <a name="description"></a><span data-ttu-id="ac58d-289">说明</span><span class="sxs-lookup"><span data-stu-id="ac58d-289">Description</span></span>

<span data-ttu-id="ac58d-290">使用 EAF (导出地址) 可以减少恶意代码查看所有已加载模块的导出地址表以查找包含用于攻击的有用 API 的模块的风险。</span><span class="sxs-lookup"><span data-stu-id="ac58d-290">Export address filtering (EAF) mitigates the risk of malicious code looking at the export address table of all loaded modules to find modules that contain useful APIs for their attack.</span></span> <span data-ttu-id="ac58d-291">这是 shellcode 使用的常见策略。</span><span class="sxs-lookup"><span data-stu-id="ac58d-291">This is a common tactic used by shellcode.</span></span> <span data-ttu-id="ac58d-292">为了降低此类攻击的风险，此缓解措施可保护三个经常受到攻击的模块：</span><span class="sxs-lookup"><span data-stu-id="ac58d-292">In order to mitigate the risk of such an attack, this mitigation protects three commonly attacked modules:</span></span>

- <span data-ttu-id="ac58d-293">ntdll.dll</span><span class="sxs-lookup"><span data-stu-id="ac58d-293">ntdll.dll</span></span>
- <span data-ttu-id="ac58d-294">kernelbase.dll</span><span class="sxs-lookup"><span data-stu-id="ac58d-294">kernelbase.dll</span></span>
- <span data-ttu-id="ac58d-295">kernel32.dll</span><span class="sxs-lookup"><span data-stu-id="ac58d-295">kernel32.dll</span></span>

<span data-ttu-id="ac58d-296">缓解保护 [导出目录中指向导出地址 [表 的内存页面](/windows/win32/debug/pe-format#export-address-table)。</span><span class="sxs-lookup"><span data-stu-id="ac58d-296">The mitigation protects the memory page in the [export directory that points to the [export address table](/windows/win32/debug/pe-format#export-address-table).</span></span> <span data-ttu-id="ac58d-297">此内存页将应用 [PAGE_GUARD](/windows/win32/memory/creating-guard-pages) 保护。</span><span class="sxs-lookup"><span data-stu-id="ac58d-297">This memory page will have the [PAGE_GUARD](/windows/win32/memory/creating-guard-pages) protection applied to it.</span></span> <span data-ttu-id="ac58d-298">当有人尝试访问此内存时，它将生成STATUS_GUARD_PAGE_VIOLATION。</span><span class="sxs-lookup"><span data-stu-id="ac58d-298">When someone tries to access this memory, it will generate a STATUS_GUARD_PAGE_VIOLATION.</span></span> <span data-ttu-id="ac58d-299">缓解处理此异常，如果访问指令未通过验证，则进程将终止。</span><span class="sxs-lookup"><span data-stu-id="ac58d-299">The mitigation handles this exception, and if the accessing instruction doesn't pass validation, the process will be terminated.</span></span>

### <a name="compatibility-considerations"></a><span data-ttu-id="ac58d-300">兼容性注意事项</span><span class="sxs-lookup"><span data-stu-id="ac58d-300">Compatibility considerations</span></span>

<span data-ttu-id="ac58d-301">此缓解主要是调试程序、沙盒应用程序、使用 DRM 的应用程序或实现反调试技术的应用程序等应用程序的问题。</span><span class="sxs-lookup"><span data-stu-id="ac58d-301">This mitigation is primarily an issue for applications such as debuggers, sandboxed applications, applications using DRM, or applications that implement anti-debugging technology.</span></span>

### <a name="configuration-options"></a><span data-ttu-id="ac58d-302">配置选项</span><span class="sxs-lookup"><span data-stu-id="ac58d-302">Configuration options</span></span>

<span data-ttu-id="ac58d-303">**验证通常被** 攻击滥用的模块的访问 - 此选项（也称为 EAF+）可添加针对其他经常受到攻击的模块的保护：</span><span class="sxs-lookup"><span data-stu-id="ac58d-303">**Validate access for modules that are commonly abused by exploits** - This option, also known as EAF+, adds protections for other commonly attacked modules:</span></span>

- `mshtml.dll`
- `flash*.ocx`
- `jscript*.ocx`
- `vbscript.dll`
- `vgx.dll`
- `mozjs.dll`
- `xul.dll`
- `acrord32.dll`
- `acrofx32.dll`
- `acroform.api`

<span data-ttu-id="ac58d-304">此外，通过启用 EAF+，此缓解功能将 PAGE_GUARD 保护添加到包含"MZ"标头（PE 文件中 [DOS](/windows/win32/debug/pe-format#ms-dos-stub-image-only)标头的前两个字节）的页面，这是 shellcode 可以查找以标识内存中可能感兴趣的模块的已知内存内容的另一个方面。</span><span class="sxs-lookup"><span data-stu-id="ac58d-304">Additionally, by enabling EAF+, this mitigation adds the PAGE_GUARD protection to the page containing the "MZ" header, the first two bytes of the [DOS header in a PE file](/windows/win32/debug/pe-format#ms-dos-stub-image-only), which is another aspect of known memory content which shellcode can look for to identify modules potentially of interest in memory.</span></span>

<span data-ttu-id="ac58d-305">**仅审核** - 可以在审核模式下启用此缓解，以便衡量对应用程序的潜在兼容性影响。</span><span class="sxs-lookup"><span data-stu-id="ac58d-305">**Audit Only** - You can enable this mitigation in audit mode in order to measure the potential compatibility impact on an application.</span></span> <span data-ttu-id="ac58d-306">然后，可以在事件查看器中或在 Microsoft Defender for Endpoint 中使用高级搜寻查看 [审核事件](/microsoft-365/security/defender/advanced-hunting-overview)。</span><span class="sxs-lookup"><span data-stu-id="ac58d-306">Audit events can then be viewed either in the event viewer or using Advanced Hunting in [Microsoft Defender for Endpoint](/microsoft-365/security/defender/advanced-hunting-overview).</span></span>

## <a name="force-randomization-for-images-mandatory-aslr"></a><span data-ttu-id="ac58d-307">强制图像随机化 (强制 ASLR) </span><span class="sxs-lookup"><span data-stu-id="ac58d-307">Force randomization for images (Mandatory ASLR)</span></span>

### <a name="description"></a><span data-ttu-id="ac58d-308">说明</span><span class="sxs-lookup"><span data-stu-id="ac58d-308">Description</span></span>

<span data-ttu-id="ac58d-309">地址空间布局随机化 (ASLR) 通过使用他们对系统内存布局的知识来降低攻击者的风险，以便执行进程内存中已存在且已标记为可执行的代码。</span><span class="sxs-lookup"><span data-stu-id="ac58d-309">Address Space Layout Randomization (ASLR) mitigates the risk of an attacker using their knowledge of the memory layout of the system in order to execute code that is already present in process memory and already marked as executable.</span></span> <span data-ttu-id="ac58d-310">这可以减少攻击者使用技术（如返回到库式攻击）的风险，其中攻击者设置上下文，然后修改返回地址，以使用适合攻击者目的的上下文执行现有代码。</span><span class="sxs-lookup"><span data-stu-id="ac58d-310">This can mitigate the risk of an attacker using techniques such as return-to-libc attacks, where the adversary sets the context and then modifies the return address to execute existing code with context that suits the adversary's purpose.</span></span>

<span data-ttu-id="ac58d-311">强制 ASLR 强制对进程内的所有 DLL 进行重基。</span><span class="sxs-lookup"><span data-stu-id="ac58d-311">Mandatory ASLR forces a rebase of all DLLs within the process.</span></span> <span data-ttu-id="ac58d-312">开发人员可以使用 /DYNAMICBASE 链接器选项启用 [ASLR，](/cpp/build/reference/dynamicbase-use-address-space-layout-randomization?view=vs-2019&preserve-view=true) 此缓解功能也具有相同的效果。</span><span class="sxs-lookup"><span data-stu-id="ac58d-312">A developer can enable ASLR using the [/DYNAMICBASE](/cpp/build/reference/dynamicbase-use-address-space-layout-randomization?view=vs-2019&preserve-view=true) linker option, and this mitigation has the same effect.</span></span>

<span data-ttu-id="ac58d-313">当内存管理器将映像映射到进程时，强制 ASLR 将强制重定位未选择加入 ASLR 的 DLL 和 EXES。</span><span class="sxs-lookup"><span data-stu-id="ac58d-313">When the memory manager is mapping in the image into the process, Mandatory ASLR will forcibly rebase DLLs and EXEs that have not opted in to ASLR.</span></span> <span data-ttu-id="ac58d-314">但请注意，这种重定基址没有向性，因此可放置在内存中的可预测位置。</span><span class="sxs-lookup"><span data-stu-id="ac58d-314">Note, however, that this rebasing has no entropy, and can therefore be placed at a predictable location in memory.</span></span> <span data-ttu-id="ac58d-315">对于二进制文件的重定基址和随机化位置，此缓解应该与从下而上 ASLR (随机内存分配[) 。 ](#randomize-memory-allocations-bottom-up-aslr)</span><span class="sxs-lookup"><span data-stu-id="ac58d-315">For rebased and randomized location of binaries, this mitigation should be paired with [Randomize memory allocations (Bottom-up ASLR)](#randomize-memory-allocations-bottom-up-aslr).</span></span>

### <a name="compatibility-considerations"></a><span data-ttu-id="ac58d-316">兼容性注意事项</span><span class="sxs-lookup"><span data-stu-id="ac58d-316">Compatibility considerations</span></span>

<span data-ttu-id="ac58d-317">ASLR 的这种兼容性影响通常局限于使用编译器构建的、假定二进制文件基地址或去除基本重定位信息的较旧应用程序。</span><span class="sxs-lookup"><span data-stu-id="ac58d-317">This compatibility impact of ASLR is typically constrained to older applications that were built using compilers that made assumptions about the base address of a binary file or have stripped out base relocation information.</span></span> <span data-ttu-id="ac58d-318">当执行流尝试跳转到内存中的预期位置而非实际位置时，这可能会导致不可预知的错误。</span><span class="sxs-lookup"><span data-stu-id="ac58d-318">This can lead to unpredictable errors as the execution flow attempts to jump to the expected, rather than the actual, location in memory.</span></span>

### <a name="configuration-options"></a><span data-ttu-id="ac58d-319">配置选项</span><span class="sxs-lookup"><span data-stu-id="ac58d-319">Configuration options</span></span>

<span data-ttu-id="ac58d-320">**不允许去除图像** - 此选项阻止加载已去除重定位信息的图像。</span><span class="sxs-lookup"><span data-stu-id="ac58d-320">**Do not allow stripped images** - This option blocks the loading of images that have had relocation information stripped.</span></span> <span data-ttu-id="ac58d-321">the Windows PE file format contains absolute addresses， and the compiler also generates a [base重定位 table that the loader can use to find all relative memory references and their offset， so they can be updated if the binary does not load at its preferred base address.</span><span class="sxs-lookup"><span data-stu-id="ac58d-321">The Windows PE file format contains absolute addresses, and the compiler also generates a [base relocation table that the loader can use to find all relative memory references and their offset, so they can be updated if the binary does not load at its preferred base address.</span></span> <span data-ttu-id="ac58d-322">一些较旧的应用程序在生产内部版本上去除此信息，因此无法重定这些二进制文件的基础。</span><span class="sxs-lookup"><span data-stu-id="ac58d-322">Some older applications strip out this information in production builds, and therefore these binaries cannot be rebased.</span></span> <span data-ttu-id="ac58d-323">此缓解阻止此类二进制文件 (，而不是允许它们以首选基地址或) 。</span><span class="sxs-lookup"><span data-stu-id="ac58d-323">This mitigation blocks such binaries from being loaded (instead of allowing them to load at their preferred base address).</span></span>

> [!Note]
> <span data-ttu-id="ac58d-324">**强制图像随机化 (强制 ASLR)** 没有审核模式。</span><span class="sxs-lookup"><span data-stu-id="ac58d-324">**Force randomization for images (Mandatory ASLR)** has no audit mode.</span></span>

## <a name="import-address-filtering-iaf"></a><span data-ttu-id="ac58d-325">在 IAF (导入) </span><span class="sxs-lookup"><span data-stu-id="ac58d-325">Import address filtering (IAF)</span></span>

### <a name="description"></a><span data-ttu-id="ac58d-326">说明</span><span class="sxs-lookup"><span data-stu-id="ac58d-326">Description</span></span>

<span data-ttu-id="ac58d-327">导入地址筛选 (IAF) 缓解功能通过修改导入地址表 (IAT) 以在调用该函数时重定向到攻击者选择的任意代码，帮助降低恶意更改应用程序控制流的风险。</span><span class="sxs-lookup"><span data-stu-id="ac58d-327">The import address filtering (IAF) mitigation helps mitigate the risk of an adversary changing the control flow of an application by modifying the import address table (IAT) to redirect to arbitrary code of the attacker's choice when that function is called.</span></span> <span data-ttu-id="ac58d-328">攻击者可能使用这种方法劫持控制，或截获、检查和潜在阻止对敏感 API 的调用。</span><span class="sxs-lookup"><span data-stu-id="ac58d-328">An attacker could use this approach to hijack control, or to intercept, inspect, and potentially block calls to sensitive APIs.</span></span>

<span data-ttu-id="ac58d-329">所有受保护的 API 的内存页都将应用[PAGE_GUARD保护。](/windows/win32/memory/creating-guard-pages)</span><span class="sxs-lookup"><span data-stu-id="ac58d-329">The memory pages for all protected APIs will have the [PAGE_GUARD](/windows/win32/memory/creating-guard-pages) protection applied to them.</span></span> <span data-ttu-id="ac58d-330">当有人尝试访问此内存时，它将生成STATUS_GUARD_PAGE_VIOLATION。</span><span class="sxs-lookup"><span data-stu-id="ac58d-330">When someone tries to access this memory, it will generate a STATUS_GUARD_PAGE_VIOLATION.</span></span> <span data-ttu-id="ac58d-331">缓解处理此异常，如果访问指令未通过验证，则进程将终止。</span><span class="sxs-lookup"><span data-stu-id="ac58d-331">The mitigation handles this exception, and if the accessing instruction doesn't pass validation, the process will be terminated.</span></span>

<span data-ttu-id="ac58d-332">此缓解功能可保护以下Windows API：</span><span class="sxs-lookup"><span data-stu-id="ac58d-332">This mitigation protects the following Windows APIs:</span></span>

- `GetProcAddress`
- `GetProcAddressForCaller`
- `LoadLibraryA`
- `LoadLibraryExA`
- `LoadLibraryW`
- `LoadLibraryExW`
- `LdrGetProcedureAddress`
- `LdrGetProcedureAddressEx`
- `LdrGetProcedureAddressForCaller`
- `LdrLoadDll`
- `VirtualProtect`
- `VirtualProtectEx`
- `VirtualAlloc`
- `VirtualAllocEx`
- `NtAllocateVirtualMemory`
- `NtProtectVirtualMemory`
- `CreateProcessA`
- `CreateProcessW`
- `WinExec`
- `CreateProcessAsUserA`
- `CreateProcessAsUserW`
- `GetModuleHandleA`
- `GetModuleHandleW`
- `RtlDecodePointer`
- `DecodePointer`

### <a name="compatibility-considerations"></a><span data-ttu-id="ac58d-333">兼容性注意事项</span><span class="sxs-lookup"><span data-stu-id="ac58d-333">Compatibility considerations</span></span>

<span data-ttu-id="ac58d-334">执行 API 拦截的合法应用程序可能会通过此缓解检测到，并会导致某些应用程序崩溃。</span><span class="sxs-lookup"><span data-stu-id="ac58d-334">Legitimate applications that perform API interception may be detected by this mitigation and cause some applications to crash.</span></span> <span data-ttu-id="ac58d-335">示例包括安全软件和应用程序兼容性填充程序。</span><span class="sxs-lookup"><span data-stu-id="ac58d-335">Examples include security software and application compatibility shims.</span></span>

### <a name="configuration-options"></a><span data-ttu-id="ac58d-336">配置选项</span><span class="sxs-lookup"><span data-stu-id="ac58d-336">Configuration options</span></span>

<span data-ttu-id="ac58d-337">**仅审核** - 可以在审核模式下启用此缓解，以便衡量对应用程序的潜在兼容性影响。</span><span class="sxs-lookup"><span data-stu-id="ac58d-337">**Audit Only** - You can enable this mitigation in audit mode in order to measure the potential compatibility impact on an application.</span></span> <span data-ttu-id="ac58d-338">然后，可以在事件查看器中或在 Microsoft Defender for Endpoint 中使用高级搜寻查看 [审核事件](/microsoft-365/security/defender/advanced-hunting-overview)。</span><span class="sxs-lookup"><span data-stu-id="ac58d-338">Audit events can then be viewed either in the event viewer or using Advanced Hunting in [Microsoft Defender for Endpoint](/microsoft-365/security/defender/advanced-hunting-overview).</span></span>

## <a name="randomize-memory-allocations-bottom-up-aslr"></a><span data-ttu-id="ac58d-339">从下向上 ASLR (随机分配) </span><span class="sxs-lookup"><span data-stu-id="ac58d-339">Randomize memory allocations (Bottom-up ASLR)</span></span>

### <a name="description"></a><span data-ttu-id="ac58d-340">说明</span><span class="sxs-lookup"><span data-stu-id="ac58d-340">Description</span></span>

<span data-ttu-id="ac58d-341">随机内存分配 (从下向上的 ASLR) 向重定位添加向向重定位，因此它们的位置是随机的，因此不太可预测。</span><span class="sxs-lookup"><span data-stu-id="ac58d-341">Randomize memory allocations (Bottom-up ASLR) adds entropy to relocations, so their location is randomized and therefore less predictable.</span></span> <span data-ttu-id="ac58d-342">此缓解要求强制 ASLR 生效。</span><span class="sxs-lookup"><span data-stu-id="ac58d-342">This mitigation requires Mandatory ASLR to take effect.</span></span>

<span data-ttu-id="ac58d-343">32 位地址空间的大小对可添加的全向性设置实际约束，因此 64 位应用程序使攻击者更难猜测内存中的位置。</span><span class="sxs-lookup"><span data-stu-id="ac58d-343">The size of the 32-bit address space places practical constraints on the entropy that can be added, and therefore 64-bit applications make it more difficult for an attacker to guess a location in memory.</span></span>

### <a name="compatibility-considerations"></a><span data-ttu-id="ac58d-344">兼容性注意事项</span><span class="sxs-lookup"><span data-stu-id="ac58d-344">Compatibility considerations</span></span>

<span data-ttu-id="ac58d-345">与强制 ASLR 和重基 (大多数) 也与下向上 ASLR 的其他各向性兼容。</span><span class="sxs-lookup"><span data-stu-id="ac58d-345">Most applications that are compatible with Mandatory ASLR (rebasing) are also compatible with the other entropy of Bottom-up ASLR.</span></span> <span data-ttu-id="ac58d-346">如果一些应用程序将本地指针保存在 32 位变量中 (预期基地址低于 4 GB) ，则它们可能有指针截断问题，因此与高向异性选项 (可禁用) 不兼容。</span><span class="sxs-lookup"><span data-stu-id="ac58d-346">Some applications may have pointer-truncation issues if they are saving local pointers in 32-bit variables (expecting a base address below 4 GB), and thus will be incompatible with the high entropy option (which can be disabled).</span></span>

### <a name="configuration-options"></a><span data-ttu-id="ac58d-347">配置选项</span><span class="sxs-lookup"><span data-stu-id="ac58d-347">Configuration options</span></span>

<span data-ttu-id="ac58d-348">请勿使用高向异性 **-** 此选项禁止使用高向异性 ASLR，这会将 24 位的 24 位 1 TB 的方差 () 添加到 64 位应用程序的下向上分配中。</span><span class="sxs-lookup"><span data-stu-id="ac58d-348">**Don't use high entropy** - this option disables the use of high-entropy ASLR, which adds 24 bits of entropy (1 TB of variance) into the bottom-up allocation for 64-bit applications.</span></span>

> [!Note]
> <span data-ttu-id="ac58d-349">**在无审核模式 (下向上 ASLR)** 随机分配内存。</span><span class="sxs-lookup"><span data-stu-id="ac58d-349">**Randomize memory allocations (Bottom-up ASLR)** has no audit mode.</span></span>

## <a name="simulate-execution-simexec"></a><span data-ttu-id="ac58d-350">模拟 SimExec (执行) </span><span class="sxs-lookup"><span data-stu-id="ac58d-350">Simulate execution (SimExec)</span></span>

### <a name="description"></a><span data-ttu-id="ac58d-351">说明</span><span class="sxs-lookup"><span data-stu-id="ac58d-351">Description</span></span>

<span data-ttu-id="ac58d-352">模拟执行 (SimExec) 是 32 位应用程序的缓解措施。</span><span class="sxs-lookup"><span data-stu-id="ac58d-352">Simulate execution (SimExec) is a mitigation for 32-bit applications only.</span></span> <span data-ttu-id="ac58d-353">这有助于验证对敏感 API 的调用是否将返回到合法的调用方函数。</span><span class="sxs-lookup"><span data-stu-id="ac58d-353">This helps validate that calls to sensitive APIs will return to legitimate caller functions.</span></span> <span data-ttu-id="ac58d-354">它通过截获对敏感 API 的调用，然后通过浏览查找 RET 指令的编码程序集语言指令来模拟这些 API 的执行，该指令应返回到调用方。</span><span class="sxs-lookup"><span data-stu-id="ac58d-354">It does this by intercepting calls into sensitive APIs, and then simulating the execution of those APIs by walking through the encoded assembly language instructions looking for the RET instruction, which should return to the caller.</span></span> <span data-ttu-id="ac58d-355">然后检查该函数，在内存中向后移动以查找前面的 CALL 指令，以确定函数和 CALL 指令是否匹配，以及 RET 是否已被截获。</span><span class="sxs-lookup"><span data-stu-id="ac58d-355">It then inspects that function and walks backwards in memory to find the preceding CALL instruction to determine whether the function and CALL instruction match, and that the RET hasn't been intercepted.</span></span>

<span data-ttu-id="ac58d-356">此缓解截获的 API 包括：</span><span class="sxs-lookup"><span data-stu-id="ac58d-356">The APIs intercepted by this mitigation are:</span></span>

- `LoadLibraryA`
- `LoadLibraryW`
- `LoadLibraryExA`
- `LoadLibraryExW`
- `LdrLoadDll`
- `VirtualAlloc`
- `VirtualAllocEx`
- `NtAllocateVirtualMemory`
- `VirtualProtect`
- `VirtualProtectEx`
- `NtProtectVirtualMemory`
- `HeapCreate`
- `RtlCreateHeap`
- `CreateProcessA`
- `CreateProcessW`
- `CreateProcessInternalA`
- `CreateProcessInternalW`
- `NtCreateUserProcess`
- `NtCreateProcess`
- `NtCreateProcessEx`
- `CreateRemoteThread`
- `CreateRemoteThreadEx`
- `NtCreateThreadEx`
- `WriteProcessMemory`
- `NtWriteVirtualMemory`
- `WinExec`
- `CreateFileMappingA`
- `CreateFileMappingW`
- `CreateFileMappingNumaW`
- `NtCreateSection`
- `MapViewOfFile`
- `MapViewOfFileEx`
- `MapViewOfFileFromApp`
- `LdrGetProcedureAddressForCaller`

<span data-ttu-id="ac58d-357">如果检测到 ROP 小部件，则进程将终止。</span><span class="sxs-lookup"><span data-stu-id="ac58d-357">If a ROP gadget is detected, the process is terminated.</span></span>

### <a name="compatibility-considerations"></a><span data-ttu-id="ac58d-358">兼容性注意事项</span><span class="sxs-lookup"><span data-stu-id="ac58d-358">Compatibility considerations</span></span>

<span data-ttu-id="ac58d-359">执行 API 拦截的应用程序（尤其是安全软件）可能会导致此缓解出现兼容性问题。</span><span class="sxs-lookup"><span data-stu-id="ac58d-359">Applications that perform API interception, particularly security software, can cause compatibility problems with this mitigation.</span></span>

<span data-ttu-id="ac58d-360">此缓解与任意代码防护缓解不兼容。</span><span class="sxs-lookup"><span data-stu-id="ac58d-360">This mitigation is incompatible with the Arbitrary Code Guard mitigation.</span></span>

### <a name="configuration-options"></a><span data-ttu-id="ac58d-361">配置选项</span><span class="sxs-lookup"><span data-stu-id="ac58d-361">Configuration options</span></span>

<span data-ttu-id="ac58d-362">**仅审核** - 可以在审核模式下启用此缓解，以便衡量对应用程序的潜在兼容性影响。</span><span class="sxs-lookup"><span data-stu-id="ac58d-362">**Audit Only** - You can enable this mitigation in audit mode in order to measure the potential compatibility impact on an application.</span></span> <span data-ttu-id="ac58d-363">然后，可以在事件查看器中或在 Microsoft Defender for Endpoint 中使用高级搜寻查看 [审核事件](/microsoft-365/security/defender/advanced-hunting-overview)。</span><span class="sxs-lookup"><span data-stu-id="ac58d-363">Audit events can then be viewed either in the event viewer or using Advanced Hunting in [Microsoft Defender for Endpoint](/microsoft-365/security/defender/advanced-hunting-overview).</span></span>

## <a name="validate-api-invocation-callercheck"></a><span data-ttu-id="ac58d-364">验证 CallerCheck (API) </span><span class="sxs-lookup"><span data-stu-id="ac58d-364">Validate API invocation (CallerCheck)</span></span>

### <a name="description"></a><span data-ttu-id="ac58d-365">说明</span><span class="sxs-lookup"><span data-stu-id="ac58d-365">Description</span></span>

<span data-ttu-id="ac58d-366">Validate API invocation (CallerCheck) is a mitigation for return-oriented programming (ROP) techniques that validates that sensitive APIS were called from a valid caller.</span><span class="sxs-lookup"><span data-stu-id="ac58d-366">Validate API invocation (CallerCheck) is a mitigation for return-oriented programming (ROP) techniques that validates that sensitive APIs were called from a valid caller.</span></span> <span data-ttu-id="ac58d-367">此缓解将检查传递的返回地址，然后启发式反汇编以查找返回地址上方的调用，以确定调用目标是否与传入函数的参数匹配。</span><span class="sxs-lookup"><span data-stu-id="ac58d-367">This mitigation inspects the passed return address, and then heuristically disassembles backwards to find a call above the return address to determine if the call target matches the parameter passed into the function.</span></span>

<span data-ttu-id="ac58d-368">此缓解截获的 API 包括：</span><span class="sxs-lookup"><span data-stu-id="ac58d-368">The APIs intercepted by this mitigation are:</span></span>

- `LoadLibraryA`
- `LoadLibraryW`
- `LoadLibraryExA`
- `LoadLibraryExW`
- `LdrLoadDll`
- `VirtualAlloc`
- `VirtualAllocEx`
- `NtAllocateVirtualMemory`
- `VirtualProtect`
- `VirtualProtectEx`
- `NtProtectVirtualMemory`
- `HeapCreate`
- `RtlCreateHeap`
- `CreateProcessA`
- `CreateProcessW`
- `CreateProcessInternalA`
- `CreateProcessInternalW`
- `NtCreateUserProcess`
- `NtCreateProcess`
- `NtCreateProcessEx`
- `CreateRemoteThread`
- `CreateRemoteThreadEx`
- `NtCreateThreadEx`
- `WriteProcessMemory`
- `NtWriteVirtualMemory`
- `WinExec`
- `CreateFileMappingA`
- `CreateFileMappingW`
- `CreateFileMappingNumaW`
- `NtCreateSection`
- `MapViewOfFile`
- `MapViewOfFileEx`
- `MapViewOfFileFromApp`
- `LdrGetProcedureAddressForCaller`

<span data-ttu-id="ac58d-369">如果检测到 ROP 小部件，则进程将终止。</span><span class="sxs-lookup"><span data-stu-id="ac58d-369">If a ROP gadget is detected, the process is terminated.</span></span>

### <a name="compatibility-considerations"></a><span data-ttu-id="ac58d-370">兼容性注意事项</span><span class="sxs-lookup"><span data-stu-id="ac58d-370">Compatibility considerations</span></span>

<span data-ttu-id="ac58d-371">执行 API 拦截的应用程序（尤其是安全软件）可能会导致此缓解出现兼容性问题。</span><span class="sxs-lookup"><span data-stu-id="ac58d-371">Applications that perform API interception, particularly security software, can cause compatibility problems with this mitigation.</span></span>

<span data-ttu-id="ac58d-372">此缓解与任意代码防护缓解不兼容。</span><span class="sxs-lookup"><span data-stu-id="ac58d-372">This mitigation is incompatible with the Arbitrary Code Guard mitigation.</span></span>

### <a name="configuration-options"></a><span data-ttu-id="ac58d-373">配置选项</span><span class="sxs-lookup"><span data-stu-id="ac58d-373">Configuration options</span></span>

<span data-ttu-id="ac58d-374">**仅审核** - 可以在审核模式下启用此缓解，以便衡量对应用程序的潜在兼容性影响。</span><span class="sxs-lookup"><span data-stu-id="ac58d-374">**Audit Only** - You can enable this mitigation in audit mode in order to measure the potential compatibility impact on an application.</span></span> <span data-ttu-id="ac58d-375">然后，可以在事件查看器中或在 Microsoft Defender for Endpoint 中使用高级搜寻查看 [审核事件](/microsoft-365/security/defender/advanced-hunting-overview)。</span><span class="sxs-lookup"><span data-stu-id="ac58d-375">Audit events can then be viewed either in the event viewer or using Advanced Hunting in [Microsoft Defender for Endpoint](/microsoft-365/security/defender/advanced-hunting-overview).</span></span>

## <a name="validate-exception-chains-sehop"></a><span data-ttu-id="ac58d-376">验证 SEHOP (异常) </span><span class="sxs-lookup"><span data-stu-id="ac58d-376">Validate exception chains (SEHOP)</span></span>

### <a name="description"></a><span data-ttu-id="ac58d-377">说明</span><span class="sxs-lookup"><span data-stu-id="ac58d-377">Description</span></span>

<span data-ttu-id="ac58d-378">验证异常链 (SEHOP) *是 SEH* 覆盖利用技术 (异常处理程序) 缓解措施。</span><span class="sxs-lookup"><span data-stu-id="ac58d-378">Validate exception chains (SEHOP) is a mitigation against the *Structured Exception Handler (SEH) overwrite* exploitation technique.</span></span> <span data-ttu-id="ac58d-379">[结构化异常](/windows/win32/debug/structured-exception-handling) 处理是应用程序可以请求处理特定异常的过程。</span><span class="sxs-lookup"><span data-stu-id="ac58d-379">[Structured exception handling](/windows/win32/debug/structured-exception-handling) is the process by which an application can ask to handle a particular exception.</span></span> <span data-ttu-id="ac58d-380">异常处理程序链接在一起，因此，如果一个异常处理程序选择不处理特定异常，则它可以传递到链中的下一个异常处理程序，直到一个异常处理程序决定处理它。</span><span class="sxs-lookup"><span data-stu-id="ac58d-380">Exception handlers are chained together, so that if one exception handler chooses not to handle a particular exception, it can be passed on to the next exception handler in the chain until one decides to handle it.</span></span> <span data-ttu-id="ac58d-381">由于处理程序列表是动态的，因此它存储在堆栈上。</span><span class="sxs-lookup"><span data-stu-id="ac58d-381">Because the list of handler is dynamic, it is stored on the stack.</span></span> <span data-ttu-id="ac58d-382">攻击者可以使用堆栈溢出漏洞，然后使用指向攻击者选择的代码的指针覆盖异常处理程序。</span><span class="sxs-lookup"><span data-stu-id="ac58d-382">An attacker can use a stack overflow vulnerability to then overwrite the exception handler with a pointer to the code of the attacker's choice.</span></span>

<span data-ttu-id="ac58d-383">此缓解依赖于 SEH 的设计，其中每个 SEH 条目都包含指向异常处理程序的指针，以及指向异常链中下一个处理程序的指针。</span><span class="sxs-lookup"><span data-stu-id="ac58d-383">This mitigation relies on the design of SEH, where each SEH entry contains both a pointer to the exception handler, as well as a pointer to the next handler in the exception chain.</span></span> <span data-ttu-id="ac58d-384">此缓解由异常调度程序调用，该调度程序在调用异常时验证 SEH 链。</span><span class="sxs-lookup"><span data-stu-id="ac58d-384">This mitigation is called by the exception dispatcher, which validates the SEH chain when an exception is invoked.</span></span> <span data-ttu-id="ac58d-385">它验证：</span><span class="sxs-lookup"><span data-stu-id="ac58d-385">It verifies that:</span></span>

- <span data-ttu-id="ac58d-386">所有异常链记录都位于堆栈边界内</span><span class="sxs-lookup"><span data-stu-id="ac58d-386">All exception chain records are within the stack boundaries</span></span>
- <span data-ttu-id="ac58d-387">所有例外记录都对齐</span><span class="sxs-lookup"><span data-stu-id="ac58d-387">All exception records are aligned</span></span>
- <span data-ttu-id="ac58d-388">没有指向堆栈的异常处理程序指针</span><span class="sxs-lookup"><span data-stu-id="ac58d-388">No exception handler pointers are pointing to the stack</span></span>
- <span data-ttu-id="ac58d-389">没有向后指针</span><span class="sxs-lookup"><span data-stu-id="ac58d-389">There are no backward pointers</span></span>
- <span data-ttu-id="ac58d-390">异常链以已知的最终异常处理程序结束</span><span class="sxs-lookup"><span data-stu-id="ac58d-390">The exception chain ends at a known final exception handler</span></span>

<span data-ttu-id="ac58d-391">如果这些验证失败，则异常处理将中止，并且不会处理异常。</span><span class="sxs-lookup"><span data-stu-id="ac58d-391">If these validations fail, then exception handling is aborted, and the exception will not be handled.</span></span>

### <a name="compatibility-considerations"></a><span data-ttu-id="ac58d-392">兼容性注意事项</span><span class="sxs-lookup"><span data-stu-id="ac58d-392">Compatibility considerations</span></span>

<span data-ttu-id="ac58d-393">SEHOP 的兼容性问题相对较少。</span><span class="sxs-lookup"><span data-stu-id="ac58d-393">Compatibility issues with SEHOP are relatively rare.</span></span> <span data-ttu-id="ac58d-394">应用程序对损坏异常链具有依赖关系的情况并不常见。</span><span class="sxs-lookup"><span data-stu-id="ac58d-394">It's uncommon for an application to take a dependency on corrupting the exception chain.</span></span> <span data-ttu-id="ac58d-395">但是，某些应用程序受计时的细微变化影响，这可能表现为在应用程序中显示潜在多线程 Bug 的竞争条件。</span><span class="sxs-lookup"><span data-stu-id="ac58d-395">However, some applications are impacted by the subtle changes in timing, which may manifest as a race condition that reveals a latent multi-threading bug in the application.</span></span>

### <a name="configuration-options"></a><span data-ttu-id="ac58d-396">配置选项</span><span class="sxs-lookup"><span data-stu-id="ac58d-396">Configuration options</span></span>

> [!Note]
> <span data-ttu-id="ac58d-397">**验证没有 (SEHOP)** 异常链。</span><span class="sxs-lookup"><span data-stu-id="ac58d-397">**Validate exception chains (SEHOP)** has no audit mode.</span></span>

## <a name="validate-handle-usage"></a><span data-ttu-id="ac58d-398">验证句柄使用情况</span><span class="sxs-lookup"><span data-stu-id="ac58d-398">Validate handle usage</span></span>

### <a name="description"></a><span data-ttu-id="ac58d-399">说明</span><span class="sxs-lookup"><span data-stu-id="ac58d-399">Description</span></span>

<span data-ttu-id="ac58d-400">*验证句柄* 使用是一种缓解措施，可帮助防止攻击者使用现有句柄访问受保护的对象。</span><span class="sxs-lookup"><span data-stu-id="ac58d-400">*Validate handle usage* is a mitigation that helps protect against an attacker using an existing handle to access a protected object.</span></span> <span data-ttu-id="ac58d-401">[句柄](/windows/win32/sysinfo/handles-and-objects)是一个对受保护对象的引用。</span><span class="sxs-lookup"><span data-stu-id="ac58d-401">A [handle](/windows/win32/sysinfo/handles-and-objects) is a reference to a protected object.</span></span> <span data-ttu-id="ac58d-402">如果应用程序代码引用了无效的句柄，这可能表示攻击者试图使用它之前记录的句柄 (但哪个应用程序引用计数不会注意到) 。</span><span class="sxs-lookup"><span data-stu-id="ac58d-402">If application code is referencing an invalid handle, that could indicate that an adversary is attempting to use a handle it has previously recorded (but which application reference counting wouldn't be aware of).</span></span> <span data-ttu-id="ac58d-403">如果应用程序尝试使用无效对象，而不只是返回 null，则应用程序将在应用程序 (STATUS_INVALID_HANDLE) 。</span><span class="sxs-lookup"><span data-stu-id="ac58d-403">If the application attempts to use an invalid object, instead of simply returning null, the application will raise an exception (STATUS_INVALID_HANDLE).</span></span>

<span data-ttu-id="ac58d-404">此缓解将自动应用于Windows应用商店应用程序。</span><span class="sxs-lookup"><span data-stu-id="ac58d-404">This mitigation is automatically applied to Windows Store applications.</span></span>

### <a name="compatibility-considerations"></a><span data-ttu-id="ac58d-405">兼容性注意事项</span><span class="sxs-lookup"><span data-stu-id="ac58d-405">Compatibility considerations</span></span>

<span data-ttu-id="ac58d-406">未准确跟踪引用的应用程序（未在异常处理程序中包装这些操作）可能会受到此缓解的影响。</span><span class="sxs-lookup"><span data-stu-id="ac58d-406">Applications that were not accurately tracking handle references, and which were not wrapping these operations in exception handlers, will potentially be impacted by this mitigation.</span></span>

### <a name="configuration-options"></a><span data-ttu-id="ac58d-407">配置选项</span><span class="sxs-lookup"><span data-stu-id="ac58d-407">Configuration options</span></span>

> [!Note]
> <span data-ttu-id="ac58d-408">**验证句柄使用情况** 没有审核模式。</span><span class="sxs-lookup"><span data-stu-id="ac58d-408">**Validate handle usage** has no audit mode.</span></span>

## <a name="validate-heap-integrity"></a><span data-ttu-id="ac58d-409">验证堆完整性</span><span class="sxs-lookup"><span data-stu-id="ac58d-409">Validate heap integrity</span></span>

### <a name="description"></a><span data-ttu-id="ac58d-410">说明</span><span class="sxs-lookup"><span data-stu-id="ac58d-410">Description</span></span>

<span data-ttu-id="ac58d-411">验证 *堆完整性* 缓解增加了Windows堆缓解的保护级别，因为如果检测到堆损坏，应用程序将终止。</span><span class="sxs-lookup"><span data-stu-id="ac58d-411">The *validate heap integrity* mitigation increases the protection level of heap mitigations in Windows, by causing the application to terminate if a heap corruption is detected.</span></span> <span data-ttu-id="ac58d-412">缓解包括：</span><span class="sxs-lookup"><span data-stu-id="ac58d-412">The mitigations include:</span></span>

- <span data-ttu-id="ac58d-413">阻止释放 HEAP 句柄</span><span class="sxs-lookup"><span data-stu-id="ac58d-413">Preventing a HEAP handle from being freed</span></span>
- <span data-ttu-id="ac58d-414">对扩展块标头执行另一个堆分配验证</span><span class="sxs-lookup"><span data-stu-id="ac58d-414">Performing another validation on extended block headers for heap allocations</span></span>
- <span data-ttu-id="ac58d-415">验证堆分配是否尚未标记为使用中</span><span class="sxs-lookup"><span data-stu-id="ac58d-415">Verifying that heap allocations are not already flagged as in-use</span></span>
- <span data-ttu-id="ac58d-416">向最大分配、堆段和超过最小大小的子类别添加保护页面</span><span class="sxs-lookup"><span data-stu-id="ac58d-416">Adding guard pages to large allocations, heap segments, and subsegments above a minimum size</span></span>

### <a name="compatibility-considerations"></a><span data-ttu-id="ac58d-417">兼容性注意事项</span><span class="sxs-lookup"><span data-stu-id="ac58d-417">Compatibility considerations</span></span>

<span data-ttu-id="ac58d-418">此缓解已默认应用于 64 位应用程序和面向 Vista 或更高版本的 32 Windows应用程序。</span><span class="sxs-lookup"><span data-stu-id="ac58d-418">This mitigation is already applied by default for 64-bit applications and for 32-bit applications targeting Windows Vista or later.</span></span> <span data-ttu-id="ac58d-419">来自 Windows XP 或更早版本的旧版应用程序风险最大，但兼容性问题很少见。</span><span class="sxs-lookup"><span data-stu-id="ac58d-419">Legacy applications from Windows XP or earlier are most at-risk, though compatibility issues are rare.</span></span>

### <a name="configuration-options"></a><span data-ttu-id="ac58d-420">配置选项</span><span class="sxs-lookup"><span data-stu-id="ac58d-420">Configuration options</span></span>

> [!Note]
> <span data-ttu-id="ac58d-421">**验证堆完整性** 没有审核模式。</span><span class="sxs-lookup"><span data-stu-id="ac58d-421">**Validate heap integrity** has no audit mode.</span></span>

## <a name="validate-image-dependency-integrity"></a><span data-ttu-id="ac58d-422">验证图像依赖关系完整性</span><span class="sxs-lookup"><span data-stu-id="ac58d-422">Validate image dependency integrity</span></span>

### <a name="description"></a><span data-ttu-id="ac58d-423">说明</span><span class="sxs-lookup"><span data-stu-id="ac58d-423">Description</span></span>

<span data-ttu-id="ac58d-424">验证 *图像依赖缓解* 可帮助防止尝试用代码替换由二进制文件静态链接的 dll Windows攻击。</span><span class="sxs-lookup"><span data-stu-id="ac58d-424">The *validate image dependency* mitigation helps protect against attacks that attempt to substitute code for dlls that are statically linked by Windows binaries.</span></span> <span data-ttu-id="ac58d-425">DLL 技术滥用加载器的搜索机制注入恶意代码，该代码可用于使恶意代码在提升的上下文中运行。</span><span class="sxs-lookup"><span data-stu-id="ac58d-425">The technique of DLL planting abuses the loader's search mechanism to inject malicious code, which can be used to get malicious code running in an elevated context.</span></span> <span data-ttu-id="ac58d-426">当加载程序加载Windows签名的二进制文件，然后加载二进制文件依赖的任何 dll 时，将验证这些二进制文件以确保它们也以 Windows 二进制文件的身份进行数字签名。</span><span class="sxs-lookup"><span data-stu-id="ac58d-426">When the loader is loading a Windows signed binary, and then loads up any dlls that the binary depends on, these binaries will be verified to ensure that they are also digitally signed as a Windows binary.</span></span> <span data-ttu-id="ac58d-427">如果它们未通过签名检查，将不会加载 dll，并且将引发异常，并返回 STATUS_INVALID_IMAGE_HASH。</span><span class="sxs-lookup"><span data-stu-id="ac58d-427">If they fail the signature check, the dll will not be loaded, and will throw an exception, returning a status of STATUS_INVALID_IMAGE_HASH.</span></span>

### <a name="compatibility-considerations"></a><span data-ttu-id="ac58d-428">兼容性注意事项</span><span class="sxs-lookup"><span data-stu-id="ac58d-428">Compatibility considerations</span></span>

<span data-ttu-id="ac58d-429">兼容性问题并不常见。</span><span class="sxs-lookup"><span data-stu-id="ac58d-429">Compatibility issues are uncommon.</span></span> <span data-ttu-id="ac58d-430">依赖于将二进制文件Windows本地专用版本的应用程序将受到影响，并且存在一个在多线程应用程序中显示细微计时 Bug 的较小风险。</span><span class="sxs-lookup"><span data-stu-id="ac58d-430">Applications that depend on replacing Windows binaries with local private versions will be impacted, and there is also a small risk of revealing subtle timing bugs in multi-threaded applications.</span></span>

### <a name="configuration-options"></a><span data-ttu-id="ac58d-431">配置选项</span><span class="sxs-lookup"><span data-stu-id="ac58d-431">Configuration options</span></span>

<span data-ttu-id="ac58d-432">**仅审核** - 可以在审核模式下启用此缓解，以便衡量对应用程序的潜在兼容性影响。</span><span class="sxs-lookup"><span data-stu-id="ac58d-432">**Audit Only** - You can enable this mitigation in audit mode in order to measure the potential compatibility impact on an application.</span></span> <span data-ttu-id="ac58d-433">然后，可以在事件查看器中或在 Microsoft Defender for Endpoint 中使用高级搜寻查看 [审核事件](/microsoft-365/security/defender/advanced-hunting-overview)。</span><span class="sxs-lookup"><span data-stu-id="ac58d-433">Audit events can then be viewed either in the event viewer or using Advanced Hunting in [Microsoft Defender for Endpoint](/microsoft-365/security/defender/advanced-hunting-overview).</span></span>

## <a name="validate-stack-integrity-stackpivot"></a><span data-ttu-id="ac58d-434">验证 StackPivot (堆栈) </span><span class="sxs-lookup"><span data-stu-id="ac58d-434">Validate stack integrity (StackPivot)</span></span>

### <a name="description"></a><span data-ttu-id="ac58d-435">说明</span><span class="sxs-lookup"><span data-stu-id="ac58d-435">Description</span></span>

<span data-ttu-id="ac58d-436">*StackPivot ()* 缓解验证堆栈完整性有助于抵御 Stack Pivot 攻击，这是攻击者在堆内存中创建假堆栈的 ROP 攻击，然后欺骗应用程序返回到控制执行流的虚假堆栈。</span><span class="sxs-lookup"><span data-stu-id="ac58d-436">The *validate stack integrity (StackPivot)* mitigation helps protect against the Stack Pivot attack, a ROP attack where an attacker creates a fake stack in heap memory, and then tricks the application into returning into the fake stack that controls the flow of execution.</span></span>

<span data-ttu-id="ac58d-437">此缓解将截获Windows API，并检查堆栈指针的值。</span><span class="sxs-lookup"><span data-stu-id="ac58d-437">This mitigation intercepts many Windows APIs, and inspects the value of the stack pointer.</span></span> <span data-ttu-id="ac58d-438">如果堆栈指针的地址不在堆栈的底部和顶部之间，则记录事件，如果未在审核模式下，则进程将终止。</span><span class="sxs-lookup"><span data-stu-id="ac58d-438">If the address of the stack pointer does not fall between the bottom and the top of the stack, then an event is recorded and, if not in audit mode, the process will be terminated.</span></span>

<span data-ttu-id="ac58d-439">此缓解截获的 API 包括：</span><span class="sxs-lookup"><span data-stu-id="ac58d-439">The APIs intercepted by this mitigation are:</span></span>

- `LoadLibraryA`
- `LoadLibraryW`
- `LoadLibraryExA`
- `LoadLibraryExW`
- `LdrLoadDll`
- `VirtualAlloc`
- `VirtualAllocEx`
- `NtAllocateVirtualMemory`
- `VirtualProtect`
- `VirtualProtectEx`
- `NtProtectVirtualMemory`
- `HeapCreate`
- `RtlCreateHeap`
- `CreateProcessA`
- `CreateProcessW`
- `CreateProcessInternalA`
- `CreateProcessInternalW`
- `NtCreateUserProcess`
- `NtCreateProcess`
- `NtCreateProcessEx`
- `CreateRemoteThread`
- `CreateRemoteThreadEx`
- `NtCreateThreadEx`
- `WriteProcessMemory`
- `NtWriteVirtualMemory`
- `WinExec`
- `CreateFileMappingA`
- `CreateFileMappingW`
- `CreateFileMappingNumaW`
- `NtCreateSection`
- `MapViewOfFile`
- `MapViewOfFileEx`
- `MapViewOfFileFromApp`
- `LdrGetProcedureAddressForCaller`

### <a name="compatibility-considerations"></a><span data-ttu-id="ac58d-440">兼容性注意事项</span><span class="sxs-lookup"><span data-stu-id="ac58d-440">Compatibility considerations</span></span>

<span data-ttu-id="ac58d-441">使用虚假堆栈的应用程序将受到影响，并且存在一个在多线程应用程序中显示细微计时 Bug 的较小风险。</span><span class="sxs-lookup"><span data-stu-id="ac58d-441">Applications that are using fake stacks will be impacted, and there is also a small risk of revealing subtle timing bugs in multi-threaded applications.</span></span>
<span data-ttu-id="ac58d-442">执行 API 拦截的应用程序（尤其是安全软件）可能会导致此缓解出现兼容性问题。</span><span class="sxs-lookup"><span data-stu-id="ac58d-442">Applications that perform API interception, particularly security software, can cause compatibility problems with this mitigation.</span></span>

<span data-ttu-id="ac58d-443">此缓解与任意代码防护缓解不兼容。</span><span class="sxs-lookup"><span data-stu-id="ac58d-443">This mitigation is incompatible with the Arbitrary Code Guard mitigation.</span></span>

### <a name="configuration-options"></a><span data-ttu-id="ac58d-444">配置选项</span><span class="sxs-lookup"><span data-stu-id="ac58d-444">Configuration options</span></span>

<span data-ttu-id="ac58d-445">**仅审核** - 可以在审核模式下启用此缓解，以便衡量对应用程序的潜在兼容性影响。</span><span class="sxs-lookup"><span data-stu-id="ac58d-445">**Audit Only** - You can enable this mitigation in audit mode in order to measure the potential compatibility impact on an application.</span></span> <span data-ttu-id="ac58d-446">然后，可以在事件查看器中或在 Microsoft Defender for Endpoint 中使用高级搜寻查看 [审核事件](/microsoft-365/security/defender/advanced-hunting-overview)。</span><span class="sxs-lookup"><span data-stu-id="ac58d-446">Audit events can then be viewed either in the event viewer or using Advanced Hunting in [Microsoft Defender for Endpoint](/microsoft-365/security/defender/advanced-hunting-overview).</span></span>
