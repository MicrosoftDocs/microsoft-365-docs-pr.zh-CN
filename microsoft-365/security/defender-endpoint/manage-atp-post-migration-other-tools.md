---
title: 使用 PowerShell、WMI 和 MPCmdRun.exe
description: 了解如何使用 PowerShell、WMI 和 MPCmdRun.exe
keywords: 迁移后， 管理， 操作， 维护， 利用率， PowerShell， WMI， MPCmdRun.exe， Microsoft Defender for Endpoint， edr
search.product: eADQiWindows 10XVcnh
search.appverid: met150
ms.prod: m365-security
ms.technology: mde
ms.mktglfcycl: deploy
ms.sitesec: library
ms.pagetype: security
ms.author: deniseb
author: denisebmsft
localization_priority: Normal
manager: dansimp
audience: ITPro
ms.collection:
- M365-security-compliance
- m365solution-scenario
ms.topic: article
ms.date: 09/22/2020
ms.reviewer: chventou
ms.openlocfilehash: 98b192551a351b58709185022cf311174052592b
ms.sourcegitcommit: a8d8cee7df535a150985d6165afdfddfdf21f622
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/21/2021
ms.locfileid: "51934454"
---
# <a name="manage-microsoft-defender-for-endpoint-with-powershell-wmi-and-mpcmdrunexe"></a><span data-ttu-id="52d11-104">使用 PowerShell、WMI 和 MPCmdRun.exe</span><span class="sxs-lookup"><span data-stu-id="52d11-104">Manage Microsoft Defender for Endpoint with PowerShell, WMI, and MPCmdRun.exe</span></span>

[!INCLUDE [Microsoft 365 Defender rebranding](../../includes/microsoft-defender.md)]

<span data-ttu-id="52d11-105">**适用于：**</span><span class="sxs-lookup"><span data-stu-id="52d11-105">**Applies to:**</span></span>
- [<span data-ttu-id="52d11-106">Microsoft Defender for Endpoint</span><span class="sxs-lookup"><span data-stu-id="52d11-106">Microsoft Defender for Endpoint</span></span>](https://go.microsoft.com/fwlink/p/?linkid=2154037)
- [<span data-ttu-id="52d11-107">Microsoft 365 Defender</span><span class="sxs-lookup"><span data-stu-id="52d11-107">Microsoft 365 Defender</span></span>](https://go.microsoft.com/fwlink/?linkid=2118804)

> <span data-ttu-id="52d11-108">想要体验 Microsoft Defender for Endpoint？</span><span class="sxs-lookup"><span data-stu-id="52d11-108">Want to experience Microsoft Defender for Endpoint?</span></span> [<span data-ttu-id="52d11-109">注册免费试用版。</span><span class="sxs-lookup"><span data-stu-id="52d11-109">Sign up for a free trial.</span></span>](https://www.microsoft.com/microsoft-365/windows/microsoft-defender-atp?ocid=docs-wdatp-exposedapis-abovefoldlink)

> [!NOTE]
> <span data-ttu-id="52d11-110">我们建议使用 [Microsoft Endpoint Manager](https://docs.microsoft.com/mem) 来管理组织针对设备的威胁防护功能 (也称为终结点) 。</span><span class="sxs-lookup"><span data-stu-id="52d11-110">We recommend using [Microsoft Endpoint Manager](https://docs.microsoft.com/mem) to manage your organization's threat protection features for devices (also referred to as endpoints).</span></span> <span data-ttu-id="52d11-111">Endpoint Manager 包括[Microsoft Intune 和](https://docs.microsoft.com/mem/intune/fundamentals/what-is-intune) [Microsoft Endpoint Configuration Manager。](https://docs.microsoft.com/mem/configmgr/core/understand/introduction)</span><span class="sxs-lookup"><span data-stu-id="52d11-111">Endpoint Manager includes [Microsoft Intune](https://docs.microsoft.com/mem/intune/fundamentals/what-is-intune) and [Microsoft Endpoint Configuration Manager](https://docs.microsoft.com/mem/configmgr/core/understand/introduction).</span></span> 
> - [<span data-ttu-id="52d11-112">详细了解终结点管理器</span><span class="sxs-lookup"><span data-stu-id="52d11-112">Learn more about Endpoint Manager</span></span>](https://docs.microsoft.com/mem/endpoint-manager-overview)
> - [<span data-ttu-id="52d11-113">使用 Configuration Manager 和 Intune 在 Windows 10 设备上共同管理 Microsoft Defender for Endpoint</span><span class="sxs-lookup"><span data-stu-id="52d11-113">Co-manage Microsoft Defender for Endpoint on Windows 10 devices with Configuration Manager and Intune</span></span>](manage-atp-post-migration-intune.md)
> - [<span data-ttu-id="52d11-114">使用 Intune 管理 Microsoft Defender for Endpoint</span><span class="sxs-lookup"><span data-stu-id="52d11-114">Manage Microsoft Defender for Endpoint with Intune</span></span>](manage-atp-post-migration-intune.md) 

<span data-ttu-id="52d11-115">可以使用 [PowerShell、Windows](#configure-microsoft-defender-for-endpoint-with-powershell)  [Management Instrumentation](#configure-microsoft-defender-for-endpoint-with-windows-management-instrumentation-wmi) (WMI) 和 Microsoft 恶意软件保护命令行实用程序管理设备上一些 [Microsoft](#configure-microsoft-defender-for-endpoint-with-microsoft-malware-protection-command-line-utility-mpcmdrunexe) Defender 防病毒 (MPCmdRun.exe) 。</span><span class="sxs-lookup"><span data-stu-id="52d11-115">You can manage some Microsoft Defender Antivirus settings on devices with [PowerShell](#configure-microsoft-defender-for-endpoint-with-powershell),  [Windows Management Instrumentation](#configure-microsoft-defender-for-endpoint-with-windows-management-instrumentation-wmi) (WMI), and the [Microsoft Malware Protection Command Line Utility](#configure-microsoft-defender-for-endpoint-with-microsoft-malware-protection-command-line-utility-mpcmdrunexe) (MPCmdRun.exe).</span></span> <span data-ttu-id="52d11-116">例如，你可以管理一些 Microsoft Defender 防病毒设置。</span><span class="sxs-lookup"><span data-stu-id="52d11-116">For example, you can manage some Microsoft Defender Antivirus settings.</span></span> <span data-ttu-id="52d11-117">在某些情况下，你可以自定义攻击面减少规则和 Exploit Protection 设置。</span><span class="sxs-lookup"><span data-stu-id="52d11-117">And, in some cases, you can customize your attack surface reduction rules and exploit protection settings.</span></span> 

> [!IMPORTANT]
> <span data-ttu-id="52d11-118">使用 PowerShell、WMI 或 MCPmdRun.exe配置配置设置可能会覆盖使用 Intune 或 Configuration Manager 配置配置功能。</span><span class="sxs-lookup"><span data-stu-id="52d11-118">Threat protection features that you configure by using PowerShell, WMI, or MCPmdRun.exe can be overwritten by configuration settings that are deployed with Intune or Configuration Manager.</span></span>

## <a name="configure-microsoft-defender-for-endpoint-with-powershell"></a><span data-ttu-id="52d11-119">使用 PowerShell 配置 Microsoft Defender for Endpoint</span><span class="sxs-lookup"><span data-stu-id="52d11-119">Configure Microsoft Defender for Endpoint with PowerShell</span></span>

<span data-ttu-id="52d11-120">可以使用 PowerShell 管理 Microsoft Defender 防病毒、Exploit Protection 和攻击面减少规则。</span><span class="sxs-lookup"><span data-stu-id="52d11-120">You can use PowerShell to manage Microsoft Defender Antivirus, exploit protection, and your attack surface reduction rules.</span></span>

|<span data-ttu-id="52d11-121">任务</span><span class="sxs-lookup"><span data-stu-id="52d11-121">Task</span></span>  |<span data-ttu-id="52d11-122">了解详细信息的资源</span><span class="sxs-lookup"><span data-stu-id="52d11-122">Resources to learn more</span></span>  |
|---------|---------|
|<span data-ttu-id="52d11-123">**管理 Microsoft Defender 防病毒**</span><span class="sxs-lookup"><span data-stu-id="52d11-123">**Manage Microsoft Defender Antivirus**</span></span> <br/><br/><span data-ttu-id="52d11-124">*查看反恶意软件保护的状态、配置防病毒扫描的首选项&更新，以及对防病毒保护进行其他更改。*</span><span class="sxs-lookup"><span data-stu-id="52d11-124">*View status of antimalware protection, configure preferences for antivirus scans & updates, and make other changes to your antivirus protection.*</span></span>    |[<span data-ttu-id="52d11-125">使用 PowerShell cmdlet 配置和管理 Microsoft Defender 防病毒</span><span class="sxs-lookup"><span data-stu-id="52d11-125">Use PowerShell cmdlets to configure and manage Microsoft Defender Antivirus</span></span>](https://docs.microsoft.com/windows/security/threat-protection/microsoft-defender-antivirus/use-powershell-cmdlets-microsoft-defender-antivirus)  <br/><br/>[<span data-ttu-id="52d11-126">使用 PowerShell cmdlet 启用云保护</span><span class="sxs-lookup"><span data-stu-id="52d11-126">Use PowerShell cmdlets to enable cloud-delivered protection</span></span>](https://docs.microsoft.com/windows/security/threat-protection/microsoft-defender-antivirus/enable-cloud-protection-microsoft-defender-antivirus#use-powershell-cmdlets-to-enable-cloud-delivered-protection)       |
|<span data-ttu-id="52d11-127">**配置 Exploit Protection** 以缓解组织设备上的威胁</span><span class="sxs-lookup"><span data-stu-id="52d11-127">**Configure exploit protection** to mitigate threats on your organization's devices</span></span><br/><br/> <span data-ttu-id="52d11-128">*我们建议首先在审核模式下 [使用](https://docs.microsoft.com/microsoft-365/security/defender-endpoint/evaluate-exploit-protection#powershell) Exploit Protection。这样，你可以了解 Exploit Protection 如何影响组织使用的应用。*</span><span class="sxs-lookup"><span data-stu-id="52d11-128">*We recommend using exploit protection in [audit mode](https://docs.microsoft.com/microsoft-365/security/defender-endpoint/evaluate-exploit-protection#powershell) at first. That way, you can see how exploit protection affects apps your organization is using.*</span></span>     | [<span data-ttu-id="52d11-129">自定义漏洞保护</span><span class="sxs-lookup"><span data-stu-id="52d11-129">Customize exploit protection</span></span>](https://docs.microsoft.com/microsoft-365/security/defender-endpoint/customize-exploit-protection)<br/><br/>[<span data-ttu-id="52d11-130">用于 Exploit Protection 的 PowerShell cmdlet</span><span class="sxs-lookup"><span data-stu-id="52d11-130">PowerShell cmdlets for exploit protection</span></span>](https://docs.microsoft.com/microsoft-365/security/defender-endpoint/customize-exploit-protection#powershell-reference)        |
|<span data-ttu-id="52d11-131">**使用** PowerShell 配置攻击面减少规则</span><span class="sxs-lookup"><span data-stu-id="52d11-131">**Configure attack surface reduction rules** with PowerShell</span></span> <br/><br/><span data-ttu-id="52d11-132">*可以使用 PowerShell 从攻击面减少规则中排除文件和文件夹。*</span><span class="sxs-lookup"><span data-stu-id="52d11-132">*You can use PowerShell to exclude files and folders from attack surface reduction rules.*</span></span> |[<span data-ttu-id="52d11-133">自定义攻击面减少规则：使用 PowerShell 排除文件夹中&文件</span><span class="sxs-lookup"><span data-stu-id="52d11-133">Customize attack surface reduction rules: Use PowerShell to exclude files & folders</span></span>](https://docs.microsoft.com/microsoft-365/security/defender-endpoint/customize-attack-surface-reduction#use-powershell-to-exclude-files-and-folders)<br/><br/><span data-ttu-id="52d11-134">另请参阅 [Antio Vasconcelo 的图形](https://github.com/anvascon/MDATP_PoSh_Scripts/tree/master/ASR%20GUI)用户界面工具，以使用 PowerShell 设置攻击面减少规则。</span><span class="sxs-lookup"><span data-stu-id="52d11-134">Also, see [António Vasconcelo's graphical user interface tool for setting attack surface reduction rules with PowerShell](https://github.com/anvascon/MDATP_PoSh_Scripts/tree/master/ASR%20GUI).</span></span> |
|<span data-ttu-id="52d11-135">**使用** PowerShell 启用网络保护</span><span class="sxs-lookup"><span data-stu-id="52d11-135">**Enable Network Protection** with PowerShell</span></span> <br/><br/><span data-ttu-id="52d11-136">*可以使用 PowerShell 启用网络保护。*</span><span class="sxs-lookup"><span data-stu-id="52d11-136">*You can use PowerShell to enable Network Protection.*</span></span> |[<span data-ttu-id="52d11-137">使用 PowerShell 打开网络保护</span><span class="sxs-lookup"><span data-stu-id="52d11-137">Turn on Network Protection with PowerShell</span></span>](https://docs.microsoft.com/microsoft-365/security/defender-endpoint/enable-network-protection#powershell) |
|<span data-ttu-id="52d11-138">**配置受控文件夹访问权限** 以防范勒索软件</span><span class="sxs-lookup"><span data-stu-id="52d11-138">**Configure controlled folder access** to protect against ransomware</span></span> <br/><br/><span data-ttu-id="52d11-139">*[受控文件夹访问权限](https://docs.microsoft.com/microsoft-365/security/defender-endpoint/controlled-folders) 也称为反反somware保护。*</span><span class="sxs-lookup"><span data-stu-id="52d11-139">*[Controlled folder access](https://docs.microsoft.com/microsoft-365/security/defender-endpoint/controlled-folders) is also referred to as antiransomware protection.*</span></span> |[<span data-ttu-id="52d11-140">使用 PowerShell 启用受控文件夹访问权限</span><span class="sxs-lookup"><span data-stu-id="52d11-140">Enable controlled folder access with PowerShell</span></span>](https://docs.microsoft.com/microsoft-365/security/defender-endpoint/enable-controlled-folders#powershell) |
|<span data-ttu-id="52d11-141">**配置 Microsoft Defender 防火墙** 以阻止未经授权的网络流量流入或流出组织的设备</span><span class="sxs-lookup"><span data-stu-id="52d11-141">**Configure Microsoft Defender Firewall** to block unauthorized network traffic flowing into or out of your organization's devices</span></span> |[<span data-ttu-id="52d11-142">使用高级安全管理 Microsoft Defender 防火墙Windows PowerShell</span><span class="sxs-lookup"><span data-stu-id="52d11-142">Microsoft Defender Firewall with Advanced Security Administration using Windows PowerShell</span></span>](https://docs.microsoft.com/windows/security/threat-protection/windows-firewall/windows-firewall-with-advanced-security-administration-with-windows-powershell) |
|<span data-ttu-id="52d11-143">**配置加密和 BitLocker** 以保护运行 Windows 的组织设备上的信息</span><span class="sxs-lookup"><span data-stu-id="52d11-143">**Configure encryption and BitLocker** to protect information on your organization's devices running Windows</span></span> |[<span data-ttu-id="52d11-144">BitLocker PowerShell 参考指南</span><span class="sxs-lookup"><span data-stu-id="52d11-144">BitLocker PowerShell reference guide</span></span>](https://docs.microsoft.com/powershell/module/bitlocker/?view=win10-ps&preserve-view=true) |

## <a name="configure-microsoft-defender-for-endpoint-with-windows-management-instrumentation-wmi"></a><span data-ttu-id="52d11-145">使用 Windows Management Instrumentation (WMI 配置 Microsoft Defender for Endpoint) </span><span class="sxs-lookup"><span data-stu-id="52d11-145">Configure Microsoft Defender for Endpoint with Windows Management Instrumentation (WMI)</span></span>

<span data-ttu-id="52d11-146">WMI 是一个脚本界面，允许您检索、修改和更新设置。</span><span class="sxs-lookup"><span data-stu-id="52d11-146">WMI is a scripting interface that allows you to retrieve, modify, and update settings.</span></span> <span data-ttu-id="52d11-147">若要了解更多信息，请参阅[使用 WMI。](https://docs.microsoft.com/windows/win32/wmisdk/using-wmi)</span><span class="sxs-lookup"><span data-stu-id="52d11-147">To learn more, see [Using WMI](https://docs.microsoft.com/windows/win32/wmisdk/using-wmi).</span></span> 

|<span data-ttu-id="52d11-148">任务</span><span class="sxs-lookup"><span data-stu-id="52d11-148">Task</span></span>  |<span data-ttu-id="52d11-149">了解详细信息的资源</span><span class="sxs-lookup"><span data-stu-id="52d11-149">Resources to learn more</span></span>  |
|---------|---------|
|<span data-ttu-id="52d11-150">**在设备上启用** 云保护</span><span class="sxs-lookup"><span data-stu-id="52d11-150">**Enable cloud-delivered protection** on a device</span></span>    |[<span data-ttu-id="52d11-151">使用 Windows Management Instruction (WMI) 启用云保护</span><span class="sxs-lookup"><span data-stu-id="52d11-151">Use Windows Management Instruction (WMI) to enable cloud-delivered protection</span></span>](https://docs.microsoft.com/windows/security/threat-protection/microsoft-defender-antivirus/enable-cloud-protection-microsoft-defender-antivirus#use-windows-management-instruction-wmi-to-enable-cloud-delivered-protection)       |
|<span data-ttu-id="52d11-152">**检索、修改和更新** Microsoft Defender 防病毒设置</span><span class="sxs-lookup"><span data-stu-id="52d11-152">**Retrieve, modify, and update settings** for Microsoft Defender Antivirus</span></span>     | [<span data-ttu-id="52d11-153">使用 WMI 配置和管理 Microsoft Defender 防病毒</span><span class="sxs-lookup"><span data-stu-id="52d11-153">Use WMI to configure and manage Microsoft Defender Antivirus</span></span>](https://docs.microsoft.com/windows/security/threat-protection/microsoft-defender-antivirus/use-wmi-microsoft-defender-antivirus)<br/><br/>[<span data-ttu-id="52d11-154">查看可用 WMI 类和示例脚本的列表</span><span class="sxs-lookup"><span data-stu-id="52d11-154">Review the list of available WMI classes and example scripts</span></span>](https://docs.microsoft.com/previous-versions/windows/desktop/defender/windows-defender-wmiv2-apis-portal) <br/><br/><span data-ttu-id="52d11-155">另请参阅已存档的 [Windows Defender WMIv2 提供程序参考信息](https://docs.microsoft.com/previous-versions/windows/desktop/defender/windows-defender-wmiv2-apis-portal?redirectedfrom=MSDN)</span><span class="sxs-lookup"><span data-stu-id="52d11-155">Also see the archived [Windows Defender WMIv2 Provider reference information](https://docs.microsoft.com/previous-versions/windows/desktop/defender/windows-defender-wmiv2-apis-portal?redirectedfrom=MSDN)</span></span>   |


## <a name="configure-microsoft-defender-for-endpoint-with-microsoft-malware-protection-command-line-utility-mpcmdrunexe"></a><span data-ttu-id="52d11-156">使用 Microsoft 恶意软件防护实用程序配置 Microsoft Defender Command-Line终结点 (MPCmdRun.exe) </span><span class="sxs-lookup"><span data-stu-id="52d11-156">Configure Microsoft Defender for Endpoint with Microsoft Malware Protection Command-Line Utility (MPCmdRun.exe)</span></span>

<span data-ttu-id="52d11-157">在单台设备上，可以使用 mpcmdrun.exe 命令行工具运行扫描、启动诊断跟踪、检查安全智能更新等。</span><span class="sxs-lookup"><span data-stu-id="52d11-157">On an individual device, you can run a scan, start diagnostic tracing, check for security intelligence updates, and more using the mpcmdrun.exe command-line tool.</span></span> <span data-ttu-id="52d11-158">可以在 中查找此实用工具 `%ProgramFiles%\Windows Defender\MpCmdRun.exe` 。</span><span class="sxs-lookup"><span data-stu-id="52d11-158">You can find the utility in `%ProgramFiles%\Windows Defender\MpCmdRun.exe`.</span></span> <span data-ttu-id="52d11-159">从命令提示符运行它。</span><span class="sxs-lookup"><span data-stu-id="52d11-159">Run it from a command prompt.</span></span>

|<span data-ttu-id="52d11-160">任务</span><span class="sxs-lookup"><span data-stu-id="52d11-160">Task</span></span>  |<span data-ttu-id="52d11-161">了解详细信息的资源</span><span class="sxs-lookup"><span data-stu-id="52d11-161">Resources to learn more</span></span>  |
|---------|---------|
|<span data-ttu-id="52d11-162">**管理 Microsoft Defender 防病毒**</span><span class="sxs-lookup"><span data-stu-id="52d11-162">**Manage Microsoft Defender Antivirus**</span></span>  |[<span data-ttu-id="52d11-163">配置和管理 Microsoft Defender 防病毒mpcmdrun.exe</span><span class="sxs-lookup"><span data-stu-id="52d11-163">Configure and manage Microsoft Defender Antivirus with mpcmdrun.exe</span></span>](https://docs.microsoft.com/windows/security/threat-protection/microsoft-defender-antivirus/command-line-arguments-microsoft-defender-antivirus)        |

## <a name="configure-your-microsoft-defender-security-center"></a><span data-ttu-id="52d11-164">配置 Microsoft Defender 安全中心</span><span class="sxs-lookup"><span data-stu-id="52d11-164">Configure your Microsoft Defender Security Center</span></span>

<span data-ttu-id="52d11-165">如果尚未配置，请配置 Microsoft **Defender** 安全中心 () 以查看警报、配置威胁防护功能以及查看有关组织整体安全状况 [https://securitycenter.windows.com](https://securitycenter.windows.com) 的详细信息。</span><span class="sxs-lookup"><span data-stu-id="52d11-165">If you haven't already done so, **configure your Microsoft Defender Security Center** ([https://securitycenter.windows.com](https://securitycenter.windows.com)) to view alerts, configure threat protection features, and view detailed information about your organization's overall security posture.</span></span> 

<span data-ttu-id="52d11-166">还可以配置最终用户是否可以在 Microsoft Defender 安全中心看到的功能以及这些功能。</span><span class="sxs-lookup"><span data-stu-id="52d11-166">You can also configure whether and what features end users can see in the Microsoft Defender Security Center.</span></span>

- [<span data-ttu-id="52d11-167">Microsoft Defender 安全中心概述</span><span class="sxs-lookup"><span data-stu-id="52d11-167">Overview of the Microsoft Defender Security Center</span></span>](https://docs.microsoft.com/microsoft-365/security/defender-endpoint/use)

- [<span data-ttu-id="52d11-168">终结点保护：Microsoft Defender 安全中心</span><span class="sxs-lookup"><span data-stu-id="52d11-168">Endpoint protection: Microsoft Defender Security Center</span></span>](https://docs.microsoft.com/mem/intune/protect/endpoint-protection-windows-10#microsoft-defender-security-center)


## <a name="next-steps"></a><span data-ttu-id="52d11-169">后续步骤</span><span class="sxs-lookup"><span data-stu-id="52d11-169">Next steps</span></span>

- [<span data-ttu-id="52d11-170">获取威胁和漏洞管理的概述</span><span class="sxs-lookup"><span data-stu-id="52d11-170">Get an overview of threat and vulnerability management</span></span>](https://docs.microsoft.com/microsoft-365/security/defender-endpoint/next-gen-threat-and-vuln-mgt)

- [<span data-ttu-id="52d11-171">访问 Microsoft Defender 安全中心安全操作仪表板</span><span class="sxs-lookup"><span data-stu-id="52d11-171">Visit the Microsoft Defender Security Center security operations dashboard</span></span>](https://docs.microsoft.com/microsoft-365/security/defender-endpoint/security-operations-dashboard)

- [<span data-ttu-id="52d11-172">使用 Intune 管理 Microsoft Defender for Endpoint</span><span class="sxs-lookup"><span data-stu-id="52d11-172">Manage Microsoft Defender for Endpoint with Intune</span></span>](manage-atp-post-migration-intune.md)
