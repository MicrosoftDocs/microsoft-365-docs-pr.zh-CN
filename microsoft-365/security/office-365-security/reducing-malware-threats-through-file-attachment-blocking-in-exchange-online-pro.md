---
title: 使用邮件流规则阻止包含可执行附件的邮件
f1.keywords:
- NOCSH
ms.author: chrisda
author: chrisda
manager: dansimp
ms.date: ''
audience: ITPro
ms.topic: how-to
ms.service: O365-seccomp
localization_priority: Normal
ms.assetid: c4fb4a86-b772-49d0-8773-e8ee897e175d
ms.custom:
- seo-marvel-apr2020
description: 管理员可以了解如何创建邮件流规则 (传输规则) 以阻止包含可执行附件的邮件。
ms.openlocfilehash: 0d641b5e8e93f4cd65a4ae22f1d99df41bf5fc9c
ms.sourcegitcommit: c083602dda3cdcb5b58cb8aa070d77019075f765
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 09/22/2020
ms.locfileid: "48197231"
---
# <a name="use-mail-flow-rules-to-block-messages-with-executable-attachments-in-eop"></a><span data-ttu-id="5af1b-103">在 EOP 中使用邮件流规则阻止带可执行附件的邮件</span><span class="sxs-lookup"><span data-stu-id="5af1b-103">Use mail flow rules to block messages with executable attachments in EOP</span></span>

[!INCLUDE [Microsoft 365 Defender rebranding](../includes/microsoft-defender-for-office.md)]


<span data-ttu-id="5af1b-104">在使用 Exchange Online 或独立 Exchange online Protection 中的邮箱的 Microsoft 365 组织中 (EOP) 不含 Exchange Online 邮箱的组织中，EOP 使用反恶意软件策略阻止有害邮件，包括具有可执行附件的邮件。</span><span class="sxs-lookup"><span data-stu-id="5af1b-104">In Microsoft 365 organizations with mailboxes in Exchange Online or standalone Exchange Online Protection (EOP) organizations without Exchange Online mailboxes, EOP uses anti-malware policies to block harmful messages, including messages with executable attachments.</span></span> <span data-ttu-id="5af1b-105">有关详细信息，请参阅 [EOP 中的反恶意软件保护](anti-malware-protection.md)。</span><span class="sxs-lookup"><span data-stu-id="5af1b-105">For more information, see [Anti-malware protection in EOP](anti-malware-protection.md).</span></span>

<span data-ttu-id="5af1b-106">若要进一步增强保护，可以使用邮件流规则 (也称为传输规则) 来标识和阻止包含可执行附件的邮件，如本主题中所述。</span><span class="sxs-lookup"><span data-stu-id="5af1b-106">To further enhance protection, you can use mail flow rules (also known as transport rules) to identify and block messages that contain executable attachments as described in this topic.</span></span>

<span data-ttu-id="5af1b-107">例如，在恶意软件爆发之后，公司可以将此规则应用于时间限制，以便受影响的用户可以在指定的一段时间后返回发送附件。</span><span class="sxs-lookup"><span data-stu-id="5af1b-107">For example, following a malware outbreak, a company could apply this rule with a time limit so that affected users can get back to sending attachments after a specified length of time.</span></span>

## <a name="what-do-you-need-to-know-before-you-begin"></a><span data-ttu-id="5af1b-108">开始前，有必要了解什么？</span><span class="sxs-lookup"><span data-stu-id="5af1b-108">What do you need to know before you begin?</span></span>

- <span data-ttu-id="5af1b-109">您需要先分配权限，然后才能执行这些过程：</span><span class="sxs-lookup"><span data-stu-id="5af1b-109">You need to be assigned permissions before you can do these procedures:</span></span>

  - <span data-ttu-id="5af1b-110">在 Exchange Online 中，请参阅在 Exchange Online 中的 [功能权限](https://docs.microsoft.com/Exchange/permissions-exo/feature-permissions)中的 "邮件流" 条目。</span><span class="sxs-lookup"><span data-stu-id="5af1b-110">In Exchange Online, see the "Mail flow" entry in [Feature Permissions in Exchange Online](https://docs.microsoft.com/Exchange/permissions-exo/feature-permissions).</span></span>
  
  - <span data-ttu-id="5af1b-111">在独立 EOP 中，您需要 "传输规则" 角色，默认情况下该角色分配给 OrganizationManagement、ComplianceManagement 和 Ecm.recordsmanagement 角色。</span><span class="sxs-lookup"><span data-stu-id="5af1b-111">In standalone EOP, you need the Transport Rules role, which is assigned to the OrganizationManagement, ComplianceManagement, and RecordsManagement roles by default.</span></span> <span data-ttu-id="5af1b-112">有关详细信息，请参阅 [独立 EOP 中的权限](feature-permissions-in-eop.md) 和 [使用 EAC 修改角色组中的成员列表](manage-admin-role-group-permissions-in-eop.md#use-the-eac-modify-the-list-of-members-in-role-groups)。</span><span class="sxs-lookup"><span data-stu-id="5af1b-112">For more information, see [Permissions in standalone EOP](feature-permissions-in-eop.md) and [Use the EAC modify the list of members in role groups](manage-admin-role-group-permissions-in-eop.md#use-the-eac-modify-the-list-of-members-in-role-groups).</span></span>

- <span data-ttu-id="5af1b-113">若要在 Exchange Online 中打开 EAC，请参阅 exchange [online 中的 exchange 管理中心](https://docs.microsoft.com/Exchange/exchange-admin-center)。</span><span class="sxs-lookup"><span data-stu-id="5af1b-113">To open the EAC in Exchange Online, see [Exchange admin center in Exchange Online](https://docs.microsoft.com/Exchange/exchange-admin-center).</span></span> <span data-ttu-id="5af1b-114">若要在独立 EOP 中打开 EAC，请参阅 [独立 EOP 中的 Exchange 管理中心](exchange-admin-center-in-exchange-online-protection-eop.md)。</span><span class="sxs-lookup"><span data-stu-id="5af1b-114">To open the EAC in standalone EOP, see [Exchange admin center in standalone EOP](exchange-admin-center-in-exchange-online-protection-eop.md).</span></span>

- <span data-ttu-id="5af1b-115">若要连接到 Exchange Online PowerShell，请参阅[连接到 Exchange Online PowerShell](https://docs.microsoft.com/powershell/exchange/connect-to-exchange-online-powershell)。</span><span class="sxs-lookup"><span data-stu-id="5af1b-115">To connect to Exchange Online PowerShell, see [Connect to Exchange Online PowerShell](https://docs.microsoft.com/powershell/exchange/connect-to-exchange-online-powershell).</span></span> <span data-ttu-id="5af1b-116">若要连接到独立 EOP PowerShell，请参阅[连接到 Exchange Online Protection PowerShell](https://docs.microsoft.com/powershell/exchange/connect-to-exchange-online-protection-powershell)。</span><span class="sxs-lookup"><span data-stu-id="5af1b-116">To connect to standalone EOP PowerShell, see [Connect to Exchange Online Protection PowerShell](https://docs.microsoft.com/powershell/exchange/connect-to-exchange-online-protection-powershell).</span></span>

- <span data-ttu-id="5af1b-117">有关 Exchange Online 和独立 EOP 中的邮件流规则的详细信息，请参阅下列主题：</span><span class="sxs-lookup"><span data-stu-id="5af1b-117">For more information about mail flow rules in Exchange Online and standalone EOP, see the following topics:</span></span>

  - [<span data-ttu-id="5af1b-118">Exchange Online 中的邮件流规则（传输规则）</span><span class="sxs-lookup"><span data-stu-id="5af1b-118">Mail flow rules (transport rules) in Exchange Online</span></span>](https://docs.microsoft.com/Exchange/security-and-compliance/mail-flow-rules/mail-flow-rules)

  - [<span data-ttu-id="5af1b-119">Exchange Online 中) 的邮件流规则条件和例外 (谓词</span><span class="sxs-lookup"><span data-stu-id="5af1b-119">Mail flow rule conditions and exceptions (predicates) in Exchange Online</span></span>](https://docs.microsoft.com/Exchange/security-and-compliance/mail-flow-rules/conditions-and-exceptions)

  - [<span data-ttu-id="5af1b-120">Exchange Online 中的邮件流规则操作</span><span class="sxs-lookup"><span data-stu-id="5af1b-120">Mail flow rule actions in Exchange Online</span></span>](https://docs.microsoft.com/Exchange/security-and-compliance/mail-flow-rules/mail-flow-rule-actions)

## <a name="use-the-eac-to-create-a-rule-that-blocks-messages-with-executable-attachments"></a><span data-ttu-id="5af1b-121">使用 EAC 创建阻止包含可执行附件的邮件的规则</span><span class="sxs-lookup"><span data-stu-id="5af1b-121">Use the EAC to create a rule that blocks messages with executable attachments</span></span>

1. <span data-ttu-id="5af1b-122">In the EAC, go to **Mail flow** \> **Rules**.</span><span class="sxs-lookup"><span data-stu-id="5af1b-122">In the EAC, go to **Mail flow** \> **Rules**.</span></span>

2. <span data-ttu-id="5af1b-123">单击 " **添加**" "添加" ![ 图标 ](../../media/ITPro-EAC-AddIcon.png) ，然后选择 " **创建新规则**"。</span><span class="sxs-lookup"><span data-stu-id="5af1b-123">Click **Add** ![Add icon](../../media/ITPro-EAC-AddIcon.png) and then select **Create a new rule**.</span></span>

3. <span data-ttu-id="5af1b-124">在打开的" **新规则**"窗口中，配置以下设置：</span><span class="sxs-lookup"><span data-stu-id="5af1b-124">In the **New rule** page that opens, configure the following settings:</span></span>

   - <span data-ttu-id="5af1b-125">**名称**：输入规则的唯一描述性名称。</span><span class="sxs-lookup"><span data-stu-id="5af1b-125">**Name**: Enter a unique, descriptive name for the rule.</span></span>

   - <span data-ttu-id="5af1b-126">单击“其他选项”\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="5af1b-126">Click **More Options**.</span></span>

   - <span data-ttu-id="5af1b-127">**在以下情况应用此规则**：选择 **任何附件** \> **具有可执行内容**。</span><span class="sxs-lookup"><span data-stu-id="5af1b-127">**Apply this rule if**: Select **Any attachment** \> **has executable content**.</span></span>

   - <span data-ttu-id="5af1b-128">**执行下列**操作：选择 " **阻止邮件** "，然后选择所需的操作：</span><span class="sxs-lookup"><span data-stu-id="5af1b-128">**Do the following**: Select **Block the message** and then choose the action you want:</span></span>

     - <span data-ttu-id="5af1b-129">**拒绝邮件并提供说明**：在出现的 " **指定拒绝原因** " 对话框中，输入要在未送达报告中显示的文本 (也称为 "NDR" 或 "退回邮件") 。</span><span class="sxs-lookup"><span data-stu-id="5af1b-129">**reject the message and include an explanation**: In the **Specify reject reason** dialog that appears, enter the text you want to appear in the non-delivery report (also known as an NDR or bounce message).</span></span> <span data-ttu-id="5af1b-130">使用的默认增强状态代码是 5.7.1。</span><span class="sxs-lookup"><span data-stu-id="5af1b-130">The default enhanced status code that's used is 5.7.1.</span></span>

     - <span data-ttu-id="5af1b-131">**拒绝具有增强状态代码的邮件**：在出现的 " **输入增强状态代码** " 对话框中，输入要在 NDR 中显示的增强状态代码。</span><span class="sxs-lookup"><span data-stu-id="5af1b-131">**reject the message with the enhanced status code of**:  In the **Enter enhanced status code** dialog that appears, enter the enhanced status code that you want to appear in the NDR.</span></span> <span data-ttu-id="5af1b-132">有效值为5.7.1 或从5.7.900 到5.7.999 的值。</span><span class="sxs-lookup"><span data-stu-id="5af1b-132">Valid values are 5.7.1 or a value from 5.7.900 to 5.7.999.</span></span> <span data-ttu-id="5af1b-133">默认拒绝文本为：传递未获得授权，邮件被拒绝。</span><span class="sxs-lookup"><span data-stu-id="5af1b-133">The default rejection text is: Delivery not authorized, message refused.</span></span>

     - <span data-ttu-id="5af1b-134">**在不通知任何人的情况下拒绝邮件**</span><span class="sxs-lookup"><span data-stu-id="5af1b-134">**reject the message without notifying anyone**</span></span>

4. <span data-ttu-id="5af1b-135">完成时，请单击“保存”\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="5af1b-135">When you're finished, click **Save**.</span></span> <span data-ttu-id="5af1b-136">您的附件阻止规则现在开始强制执行。</span><span class="sxs-lookup"><span data-stu-id="5af1b-136">Your attachment blocking rule is now in force.</span></span>

## <a name="use-powershell-to-create-a-rule-that-blocks-messages-with-executable-attachments"></a><span data-ttu-id="5af1b-137">使用 PowerShell 创建阻止包含可执行附件的邮件的规则</span><span class="sxs-lookup"><span data-stu-id="5af1b-137">Use PowerShell to create a rule that blocks messages with executable attachments</span></span>

<span data-ttu-id="5af1b-138">使用以下语法创建规则以阻止包含可执行附件的邮件：</span><span class="sxs-lookup"><span data-stu-id="5af1b-138">Use the following syntax to create a rule to blocks messages that contain executable attachments:</span></span>

```powershell
New-TransportRule -Name "<UniqueName>" -AttachmentHasExecutableContent $true [-RejectMessageEnhancedStatusCode <5.7.1 | 5.7.900 to 5.7.999>] [-RejectMessageReasonText "<Text>"] [-DeleteMessage $true]
```

<span data-ttu-id="5af1b-139">**注意**：</span><span class="sxs-lookup"><span data-stu-id="5af1b-139">**Notes**:</span></span>

- <span data-ttu-id="5af1b-140">如果使用不带_RejectMessageReasonText_参数的_RejectMessageEnhancedStatusCode_参数，则默认文本为：传递未获得授权，邮件拒绝。</span><span class="sxs-lookup"><span data-stu-id="5af1b-140">If you use the _RejectMessageEnhancedStatusCode_ parameter without the _RejectMessageReasonText_ parameter, the default text is: Delivery not authorized, message refused.</span></span>

- <span data-ttu-id="5af1b-141">如果在不使用_RejectMessageEnhancedStatusCode_参数的情况下使用_RejectMessageReasonText_参数，则默认代码为5.7.1。</span><span class="sxs-lookup"><span data-stu-id="5af1b-141">If you use the _RejectMessageReasonText_ parameter without the _RejectMessageEnhancedStatusCode_ parameter, the default code is 5.7.1.</span></span>

<span data-ttu-id="5af1b-142">本示例创建一个名为 "阻止可执行附件" 的新规则，该规则会自动删除包含可执行附件的邮件。</span><span class="sxs-lookup"><span data-stu-id="5af1b-142">This example creates a new rule named Block Executable Attachments that silently deletes messages that contain executable attachments.</span></span>

```powershell
New-TransportRule -Name "Block Executable Attachments" -AttachmentHasExecutableContent $true -DeleteMessage $true
```

<span data-ttu-id="5af1b-143">有关语法和参数的详细信息，请参阅 [New-TransportRule](https://docs.microsoft.com/powershell/module/exchange/new-transportrule)。</span><span class="sxs-lookup"><span data-stu-id="5af1b-143">For detailed syntax and parameter information, see [New-TransportRule](https://docs.microsoft.com/powershell/module/exchange/new-transportrule).</span></span>

## <a name="how-do-you-know-this-worked"></a><span data-ttu-id="5af1b-144">如何判断是否生效？</span><span class="sxs-lookup"><span data-stu-id="5af1b-144">How do you know this worked?</span></span>

<span data-ttu-id="5af1b-145">若要验证是否已成功创建邮件流规则以阻止包含可执行附件的邮件，请执行以下任一步骤：</span><span class="sxs-lookup"><span data-stu-id="5af1b-145">To verify that you've successfully create a mail flow rule to block messages that contain executable attachments, do any of the following steps:</span></span>

- <span data-ttu-id="5af1b-146">在 EAC 中，转到 " **邮件流** \> **规则**"。 \> 选择该规则 \> ，然后单击 " **编辑** ![ 编辑 ](../../media/ITPro-EAC-EditIcon.png) " 图标，并验证设置。</span><span class="sxs-lookup"><span data-stu-id="5af1b-146">In the EAC, go to **Mail flow** \> **Rules** \> select the rule \> click **Edit** ![Edit icon](../../media/ITPro-EAC-EditIcon.png), and verify the settings.</span></span>

- <span data-ttu-id="5af1b-147">在 PowerShell 中，运行以下命令来验证设置：</span><span class="sxs-lookup"><span data-stu-id="5af1b-147">In PowerShell, run the following command to verify the settings:</span></span>

  ```powershell
  Get-TransportRule -Identity "<Rule Name>" | Format-List Name,AttachmentHasExecutableContent,RejectMessage*,DeleteMessage
  ```
